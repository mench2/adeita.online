(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Mn=!1,Dn=(t,e)=>t===e,In=Symbol("solid-track"),Je={equals:Dn};let nn=an;const ue=1,Xe=2,sn={owned:null,cleanups:null,context:null,owner:null};var I=null;let at=null,Fn=null,P=null,V=null,ie=null,nt=0;function ze(t,e){const n=P,i=I,s=t.length===0,o=e===void 0?i:e,r=s?sn:{owned:null,cleanups:null,context:o?o.context:null,owner:o},a=s?t:()=>t(()=>le(()=>Ie(r)));I=r,P=null;try{return Ee(a,!0)}finally{P=n,I=i}}function C(t,e){e=e?Object.assign({},Je,e):Je;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},i=s=>(typeof s=="function"&&(s=s(n.value)),rn(n,s));return[on.bind(n),i]}function U(t,e,n){const i=Tt(t,e,!1,ue);Ve(i)}function ne(t,e,n){nn=Un;const i=Tt(t,e,!1,ue);i.user=!0,ie?ie.push(i):Ve(i)}function re(t,e,n){n=n?Object.assign({},Je,n):Je;const i=Tt(t,e,!0,0);return i.observers=null,i.observerSlots=null,i.comparator=n.equals||void 0,Ve(i),on.bind(i)}function De(t){return Ee(t,!1)}function le(t){if(P===null)return t();const e=P;P=null;try{return t()}finally{P=e}}function qe(t){ne(()=>le(t))}function ke(t){return I===null||(I.cleanups===null?I.cleanups=[t]:I.cleanups.push(t)),t}function on(){if(this.sources&&this.state)if(this.state===ue)Ve(this);else{const t=V;V=null,Ee(()=>et(this),!1),V=t}if(P){const t=this.observers?this.observers.length:0;P.sources?(P.sources.push(this),P.sourceSlots.push(t)):(P.sources=[this],P.sourceSlots=[t]),this.observers?(this.observers.push(P),this.observerSlots.push(P.sources.length-1)):(this.observers=[P],this.observerSlots=[P.sources.length-1])}return this.value}function rn(t,e,n){let i=t.value;return(!t.comparator||!t.comparator(i,e))&&(t.value=e,t.observers&&t.observers.length&&Ee(()=>{for(let s=0;s<t.observers.length;s+=1){const o=t.observers[s],r=at&&at.running;r&&at.disposed.has(o),(r?!o.tState:!o.state)&&(o.pure?V.push(o):ie.push(o),o.observers&&cn(o)),r||(o.state=ue)}if(V.length>1e6)throw V=[],new Error},!1)),e}function Ve(t){if(!t.fn)return;Ie(t);const e=nt;qn(t,t.value,e)}function qn(t,e,n){let i;const s=I,o=P;P=I=t;try{i=t.fn(e)}catch(r){return t.pure&&(t.state=ue,t.owned&&t.owned.forEach(Ie),t.owned=null),t.updatedAt=n+1,ln(r)}finally{P=o,I=s}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?rn(t,i):t.value=i,t.updatedAt=n)}function Tt(t,e,n,i=ue,s){const o={fn:t,state:i,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:I,context:I?I.context:null,pure:n};return I===null||I!==sn&&(I.owned?I.owned.push(o):I.owned=[o]),o}function Ze(t){if(t.state===0)return;if(t.state===Xe)return et(t);if(t.suspense&&le(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<nt);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===ue)Ve(t);else if(t.state===Xe){const i=V;V=null,Ee(()=>et(t,e[0]),!1),V=i}}function Ee(t,e){if(V)return t();let n=!1;e||(V=[]),ie?n=!0:ie=[],nt++;try{const i=t();return Vn(n),i}catch(i){n||(ie=null),V=null,ln(i)}}function Vn(t){if(V&&(an(V),V=null),t)return;const e=ie;ie=null,e.length&&Ee(()=>nn(e),!1)}function an(t){for(let e=0;e<t.length;e++)Ze(t[e])}function Un(t){let e,n=0;for(e=0;e<t.length;e++){const i=t[e];i.user?t[n++]=i:Ze(i)}for(e=0;e<n;e++)Ze(t[e])}function et(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const i=t.sources[n];if(i.sources){const s=i.state;s===ue?i!==e&&(!i.updatedAt||i.updatedAt<nt)&&Ze(i):s===Xe&&et(i,e)}}}function cn(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=Xe,n.pure?V.push(n):ie.push(n),n.observers&&cn(n))}}function Ie(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),i=t.sourceSlots.pop(),s=n.observers;if(s&&s.length){const o=s.pop(),r=n.observerSlots.pop();i<s.length&&(o.sourceSlots[r]=i,s[i]=o,n.observerSlots[i]=r)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ie(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ie(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function Qn(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function ln(t,e=I){throw Qn(t)}const Wn=Symbol("fallback");function Dt(t){for(let e=0;e<t.length;e++)t[e]()}function Hn(t,e,n={}){let i=[],s=[],o=[],r=0,a=e.length>1?[]:null;return ke(()=>Dt(o)),()=>{let c=t()||[],u=c.length,p,f;return c[In],le(()=>{let w,T,b,$,F,S,l,h,y;if(u===0)r!==0&&(Dt(o),o=[],i=[],s=[],r=0,a&&(a=[])),n.fallback&&(i=[Wn],s[0]=ze(A=>(o[0]=A,n.fallback())),r=1);else if(r===0){for(s=new Array(u),f=0;f<u;f++)i[f]=c[f],s[f]=ze(_);r=u}else{for(b=new Array(u),$=new Array(u),a&&(F=new Array(u)),S=0,l=Math.min(r,u);S<l&&i[S]===c[S];S++);for(l=r-1,h=u-1;l>=S&&h>=S&&i[l]===c[h];l--,h--)b[h]=s[l],$[h]=o[l],a&&(F[h]=a[l]);for(w=new Map,T=new Array(h+1),f=h;f>=S;f--)y=c[f],p=w.get(y),T[f]=p===void 0?-1:p,w.set(y,f);for(p=S;p<=l;p++)y=i[p],f=w.get(y),f!==void 0&&f!==-1?(b[f]=s[p],$[f]=o[p],a&&(F[f]=a[p]),f=T[f],w.set(y,f)):o[p]();for(f=S;f<u;f++)f in b?(s[f]=b[f],o[f]=$[f],a&&(a[f]=F[f],a[f](f))):s[f]=ze(_);s=s.slice(0,r=u),i=c.slice(0)}return s});function _(w){if(o[f]=w,a){const[T,b]=C(f);return a[f]=b,e(c[f],T)}return e(c[f])}}}function O(t,e){return le(()=>t(e||{}))}const zn=t=>`Stale read from <${t}>.`;function Gn(t){const e="fallback"in t&&{fallback:()=>t.fallback};return re(Hn(()=>t.each,t.children,e||void 0))}function Z(t){const e=t.keyed,n=re(()=>t.when,void 0,void 0),i=e?n:re(n,void 0,{equals:(s,o)=>!s==!o});return re(()=>{const s=i();if(s){const o=t.children;return typeof o=="function"&&o.length>0?le(()=>o(e?s:()=>{if(!le(i))throw zn("Show");return n()})):o}return t.fallback},void 0,void 0)}const Se=t=>re(()=>t());function jn(t,e,n){let i=n.length,s=e.length,o=i,r=0,a=0,c=e[s-1].nextSibling,u=null;for(;r<s||a<o;){if(e[r]===n[a]){r++,a++;continue}for(;e[s-1]===n[o-1];)s--,o--;if(s===r){const p=o<i?a?n[a-1].nextSibling:n[o-a]:c;for(;a<o;)t.insertBefore(n[a++],p)}else if(o===a)for(;r<s;)(!u||!u.has(e[r]))&&e[r].remove(),r++;else if(e[r]===n[o-1]&&n[a]===e[s-1]){const p=e[--s].nextSibling;t.insertBefore(n[a++],e[r++].nextSibling),t.insertBefore(n[--o],p),e[s]=n[o]}else{if(!u){u=new Map;let f=a;for(;f<o;)u.set(n[f],f++)}const p=u.get(e[r]);if(p!=null)if(a<p&&p<o){let f=r,_=1,w;for(;++f<s&&f<o&&!((w=u.get(e[f]))==null||w!==p+_);)_++;if(_>p-a){const T=e[r];for(;a<p;)t.insertBefore(n[a++],T)}else t.replaceChild(n[a++],e[r++])}else r++;else e[r++].remove()}}}const It="_$DX_DELEGATE";function Kn(t,e,n,i={}){let s;return ze(o=>{s=o,e===document?t():E(e,t(),e.firstChild?null:void 0,n)},i.owner),()=>{s(),e.textContent=""}}function M(t,e,n,i){let s;const o=()=>{const a=document.createElement("template");return a.innerHTML=t,a.content.firstChild},r=()=>(s||(s=o())).cloneNode(!0);return r.cloneNode=r,r}function me(t,e=window.document){const n=e[It]||(e[It]=new Set);for(let i=0,s=t.length;i<s;i++){const o=t[i];n.has(o)||(n.add(o),e.addEventListener(o,Jn))}}function un(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function te(t,e){e==null?t.removeAttribute("class"):t.className=e}function Y(t,e,n,i){Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n}function Yn(t,e,n){if(!e)return n?un(t,"style"):e;const i=t.style;if(typeof e=="string")return i.cssText=e;typeof n=="string"&&(i.cssText=n=void 0),n||(n={}),e||(e={});let s,o;for(o in n)e[o]==null&&i.removeProperty(o),delete n[o];for(o in e)s=e[o],s!==n[o]&&(i.setProperty(o,s),n[o]=s);return n}function Ft(t,e,n){n!=null?t.style.setProperty(e,n):t.style.removeProperty(e)}function pe(t,e,n){return le(()=>t(e,n))}function E(t,e,n,i){if(n!==void 0&&!i&&(i=[]),typeof e!="function")return tt(t,e,i,n);U(s=>tt(t,e(),s,n),i)}function Jn(t){let e=t.target;const n=`$$${t.type}`,i=t.target,s=t.currentTarget,o=c=>Object.defineProperty(t,"target",{configurable:!0,value:c}),r=()=>{const c=e[n];if(c&&!e.disabled){const u=e[`${n}Data`];if(u!==void 0?c.call(e,u,t):c.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&o(e.host),!0},a=()=>{for(;r()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const c=t.composedPath();o(c[0]);for(let u=0;u<c.length-2&&(e=c[u],!!r());u++){if(e._$host){e=e._$host,a();break}if(e.parentNode===s)break}}else a();o(i)}function tt(t,e,n,i,s){for(;typeof n=="function";)n=n();if(e===n)return n;const o=typeof e,r=i!==void 0;if(t=r&&n[0]&&n[0].parentNode||t,o==="string"||o==="number"){if(o==="number"&&(e=e.toString(),e===n))return n;if(r){let a=n[0];a&&a.nodeType===3?a.data!==e&&(a.data=e):a=document.createTextNode(e),n=ye(t,n,i,a)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||o==="boolean")n=ye(t,n,i);else{if(o==="function")return U(()=>{let a=e();for(;typeof a=="function";)a=a();n=tt(t,a,n,i)}),()=>n;if(Array.isArray(e)){const a=[],c=n&&Array.isArray(n);if(ft(a,e,n,s))return U(()=>n=tt(t,a,n,i,!0)),()=>n;if(a.length===0){if(n=ye(t,n,i),r)return n}else c?n.length===0?qt(t,a,i):jn(t,n,a):(n&&ye(t),qt(t,a));n=a}else if(e.nodeType){if(Array.isArray(n)){if(r)return n=ye(t,n,i,e);ye(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function ft(t,e,n,i){let s=!1;for(let o=0,r=e.length;o<r;o++){let a=e[o],c=n&&n[t.length],u;if(!(a==null||a===!0||a===!1))if((u=typeof a)=="object"&&a.nodeType)t.push(a);else if(Array.isArray(a))s=ft(t,a,c)||s;else if(u==="function")if(i){for(;typeof a=="function";)a=a();s=ft(t,Array.isArray(a)?a:[a],Array.isArray(c)?c:[c])||s}else t.push(a),s=!0;else{const p=String(a);c&&c.nodeType===3&&c.data===p?t.push(c):t.push(document.createTextNode(p))}}return s}function qt(t,e,n=null){for(let i=0,s=e.length;i<s;i++)t.insertBefore(e[i],n)}function ye(t,e,n,i){if(n===void 0)return t.textContent="";const s=i||document.createTextNode("");if(e.length){let o=!1;for(let r=e.length-1;r>=0;r--){const a=e[r];if(s!==a){const c=a.parentNode===t;!o&&!r?c?t.replaceChild(s,a):t.insertBefore(s,n):c&&a.remove()}else o=!0}}else t.insertBefore(s,n);return[s]}const fe=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||window.matchMedia("(max-width: 768px)").matches,Fe=/Android/i.test(navigator.userAgent),se=/iPhone|iPad|iPod/i.test(navigator.userAgent),ae=/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent),Xn=/Chrome/i.test(navigator.userAgent),it=/Firefox/i.test(navigator.userAgent),dn=/Edg/i.test(navigator.userAgent),Zn=/Windows/i.test(navigator.userAgent),ei=/Macintosh|Mac OS X/i.test(navigator.userAgent),J=typeof window<"u"&&!!window.Telegram&&!!window.Telegram.WebApp;console.log("Platform detection:",{mobile:fe,android:Fe,ios:se,safari:ae,chrome:Xn,firefox:it,edge:dn,windows:Zn,macos:ei,telegram:J});const hn=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}],ti=[{urls:"turn:95.81.117.141:3478",username:"adeita",credential:"TeFmLD44bTHMQeyuWgyFcB0fuRnuS3QklMb3ObxHPQM="},{urls:"turns:95.81.117.141:5349",username:"adeita",credential:"TeFmLD44bTHMQeyuWgyFcB0fuRnuS3QklMb3ObxHPQM="},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turns:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"}],ni=[...hn,...ti];function ii(t){return t?(console.log("ðŸ”’ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ STUN)"),hn):(console.log("ðŸŒ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€ (STUN + TURN)"),ni)}const Vt={high:{width:1920,height:1080,frameRate:30},medium:{width:1280,height:720,frameRate:30},low:{width:640,height:480,frameRate:15}};function si(t,e=!1){let n=10;t>=4?n=3:t>=3&&(n=5);let i={iceServers:ii(e),iceCandidatePoolSize:n,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",iceTransportPolicy:"all",iceConnectionReceivingTimeout:t>=4?15e3:2e4,iceBackupCandidatePairPingInterval:2e3,continualGatheringPolicy:t>=4?"gather_once":"gather_continually",sdpSemantics:"unified-plan",iceGatheringTimeout:t>=4?1e4:15e3};return(se||ae)&&(i.iceCandidatePoolSize=5,i.iceConnectionReceivingTimeout=25e3,i.iceGatheringTimeout=2e4),Fe&&J&&(i.iceCandidatePoolSize=8,i.iceConnectionReceivingTimeout=18e3),it&&(i.iceCandidatePoolSize=12,i.iceConnectionReceivingTimeout=22e3),i}async function oi(t){try{const n=(await navigator.mediaDevices.enumerateDevices()).filter(c=>c.kind==="videoinput");if(n.length===0)return null;const i=t==="environment"?["back","rear","environment"]:["front","user"],s=t==="environment"?["front","user"]:["back","rear","environment"],o=c=>n.find(u=>(u.label||"").toLowerCase().includes(c[0])||(u.label||"").toLowerCase().includes(c[1])||(u.label||"").toLowerCase().includes(c[2]||"")),r=o(i);if(r)return r.deviceId;const a=o(s);return a?a.deviceId:n[0].deviceId}catch(e){return console.warn("enumerateDevices failed:",e),null}}let ve=null,Ue=null;function q(t=""){const e=document.getElementById("nameModal");if(e&&getComputedStyle(e).display!=="none"&&e.offsetParent!==null)return;ve&&(ve.remove(),ve=null),Ue&&(clearTimeout(Ue),Ue=null);const n=document.createElement("div");n.className="copy-popover";const i=document.createElement("div");i.className="check",i.textContent="âœ“";const s=document.createElement("div");s.className="label",s.textContent=t,n.appendChild(i),n.appendChild(s),document.body.appendChild(n),ve=n;const o=document.getElementById("callControls"),r=o?o.getBoundingClientRect():null,a=n.getBoundingClientRect(),c=Math.max(8,(window.innerWidth-a.width)/2),u=r?Math.max(8,r.top-16-a.height):Math.max(8,window.innerHeight-110-a.height);n.style.left=c+"px",n.style.top=u+"px",requestAnimationFrame(()=>n.classList.add("show")),Ue=setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>{n.remove(),ve===n&&(ve=null)},150)},1800)}const[L,At]=C(new Map);function ri(t,e){De(()=>{const n=new Map(L());n.set(t,e),At(n)})}function ai(t){De(()=>{const e=L().get(t);if(e){e.qualityInterval&&clearInterval(e.qualityInterval),e._disconnectTimer&&clearTimeout(e._disconnectTimer);try{e.pc.close()}catch(i){console.warn("Error closing peer connection:",i)}}const n=new Map(L());n.delete(t),At(n)})}function st(t){return L().get(t)}function Oe(t){return L().has(t)}function pt(){return Array.from(L().keys())}function ci(){De(()=>{for(const[t,e]of L().entries()){e.qualityInterval&&clearInterval(e.qualityInterval),e._disconnectTimer&&clearTimeout(e._disconnectTimer);try{e.pc.close()}catch(n){console.warn(`Error closing peer ${t}:`,n)}}At(new Map)})}const[W,_e]=C(""),[Ut,he]=C(!1),[ct,fn]=C(""),[xt,pn]=C(new Map),[gt,gn]=C([]),[li,Qt]=C(!0),[Be,mt]=C(null),[Re,yt]=C(!1),[ui,mn]=C(null),[di,H]=C(!1),[Wt,Le]=C(""),[js,Ne]=C(0),[Ht,ge]=C(null),[$t,Me]=C(!1),[zt,yn]=C(!1),[oe,vt]=C(!1),[vn,hi]=C("auto"),[wt,fi]=C(!1),[Ks,Gt]=C(!1);function pi(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let n=0;n<8;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function Rt(t,e,n=!1){const i={id:Date.now()+Math.random(),author:t,text:e,timestamp:new Date,isOwn:n};return gn([...gt(),i]),i}function gi(t){return t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}function mi(t,e){const n=new Map(xt());n.set(t,e),pn(n)}function wn(t){const e=new Map(xt());e.delete(t),pn(e)}class jt{audioContext=null;sourceNode=null;gainNode=null;filterNode=null;dynamicsCompressor=null;destination=null;originalStream=null;constructor(){}async processStream(e){if(!e||e.getAudioTracks().length===0)return console.warn("No audio tracks to process"),e;try{return this.audioContext=new AudioContext({sampleRate:48e3}),this.originalStream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode.type="highpass",this.filterNode.frequency.value=200,this.filterNode.Q.value=.7,this.dynamicsCompressor=this.audioContext.createDynamicsCompressor(),this.dynamicsCompressor.threshold.value=-50,this.dynamicsCompressor.knee.value=40,this.dynamicsCompressor.ratio.value=12,this.dynamicsCompressor.attack.value=.003,this.dynamicsCompressor.release.value=.25,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1.2,this.destination=this.audioContext.createMediaStreamDestination(),this.sourceNode.connect(this.filterNode).connect(this.dynamicsCompressor).connect(this.gainNode).connect(this.destination),console.log("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾"),this.destination.stream}catch(n){return console.error("Failed to process audio stream:",n),e}}cleanup(){try{this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.filterNode&&(this.filterNode.disconnect(),this.filterNode=null),this.dynamicsCompressor&&(this.dynamicsCompressor.disconnect(),this.dynamicsCompressor=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.destination&&(this.destination.disconnect(),this.destination=null),this.audioContext&&this.audioContext.state!=="closed"&&(this.audioContext.close(),this.audioContext=null),console.log("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾")}catch(e){console.warn("Error during audio processor cleanup:",e)}}isActive(){return this.audioContext!==null&&this.audioContext.state==="running"}}function yi(){const[t,e]=C(null),[n,i]=C(!1),[s,o]=C("medium"),[r,a]=C(null),c={stream:null,track:null,videoEl:null},u=()=>{try{return t()?.getVideoTracks()[0]?.getSettings().facingMode??null}catch{return null}},p=async()=>{const d=t()?.getVideoTracks()[0];if(!d)return!1;const m=d.getCapabilities?.();if(!m||!("torch"in m))return!1;try{return await d.applyConstraints({advanced:[{torch:!0}]}),!0}catch{return!1}},f=async()=>{const d=t()?.getVideoTracks()[0];if(!d)return!1;const m=d.getCapabilities?.();if(!m||!("torch"in m))return!1;try{return await d.applyConstraints({advanced:[{torch:!1}]}),!0}catch{return!1}},_=async()=>{if(c.track&&c.stream)return!0;try{const d=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:{exact:"environment"},width:{ideal:160,max:320},height:{ideal:120,max:240},frameRate:{ideal:5,max:10},advanced:[{torch:!1}]}}),m=d.getVideoTracks()[0],v=m.getCapabilities?.();if(!v||!("torch"in v))return d.getTracks().forEach(R=>R.stop()),!1;const g=document.createElement("video");g.muted=!0,g.playsInline=!0,g.setAttribute("playsinline",""),g.style.position="fixed",g.style.width="1px",g.style.height="1px",g.style.opacity="0",g.style.pointerEvents="none",document.body.appendChild(g),g.srcObject=d;try{await g.play()}catch{}return c.stream=d,c.track=m,c.videoEl=g,!0}catch{return!1}},w=async()=>{if(!c.track)return!1;try{return await c.track.applyConstraints({advanced:[{torch:!0}]}),!0}catch{return!1}},T=async()=>{try{await c.track?.applyConstraints?.({advanced:[{torch:!1}]})}catch{}try{c.stream?.getTracks().forEach(d=>d.stop())}catch{}try{c.videoEl?.pause()}catch{}c.videoEl?.parentNode&&c.videoEl.parentNode.removeChild(c.videoEl),c.stream=null,c.track=null,c.videoEl=null},b=d=>{const m=document.querySelector(".video-section"),v=document.querySelector(".wrap");d?(m?.classList.add("flashlight-on"),document.body.classList.add("flashlight-bg"),v?.classList.add("flashlight-bg")):(m?.classList.remove("flashlight-on"),document.body.classList.remove("flashlight-bg"),v?.classList.remove("flashlight-bg"))},$=async()=>{if(!n())return;if(u()==="environment"){let m=await p();m||(m=await _()&&await w()),b(!m)}else await f(),await T(),b(!0)},F=async()=>{if(!!n()){await f(),await T(),b(!1),i(!1);return}i(!0),await $()};async function S(d="medium"){try{const m=1+L().size,v=vn();let g;v==="auto"?m>=4?g={width:{ideal:480,max:640},height:{ideal:360,max:480},frameRate:{ideal:15,max:20},facingMode:{ideal:"user"}}:m>=3?g={width:{ideal:640,max:800},height:{ideal:480,max:600},frameRate:{ideal:20,max:25},facingMode:{ideal:"user"}}:g={width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30,max:30},facingMode:{ideal:"user"}}:v==="1080p"?g={width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},frameRate:{ideal:30,max:30},facingMode:{ideal:"user"}}:v==="720p"?g={width:{ideal:1280,max:1280},height:{ideal:720,max:720},frameRate:{ideal:30,max:30},facingMode:{ideal:"user"}}:g={width:{ideal:640,max:640},height:{ideal:480,max:480},frameRate:{ideal:15,max:20},facingMode:{ideal:"user"}};let R={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1},video:g};(se||ae)&&(R.video={width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:24,max:30},facingMode:{ideal:"user"}},R.audio={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}),Fe&&J&&(R.video={width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:15,max:24},facingMode:{ideal:"user"}}),it&&(R.video={width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30},facingMode:{ideal:"user"}}),dn&&(R.video={width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30},facingMode:{ideal:"user"}}),console.log("Requesting media with platform-specific constraints:",R);let D=await navigator.mediaDevices.getUserMedia(R);if(wt()){const Q=new jt;D=await Q.processStream(D),a(Q),console.log("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¾ Ðº Ð¿Ð¾Ñ‚Ð¾ÐºÑƒ")}return e(D),o(d),ge(null),console.log("Local stream obtained successfully"),D}catch(m){if(console.error("Failed to get local stream:",m),Fe&&J)try{console.log("Trying audio-only fallback for Android");const v=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return e(v),q("ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ (ÐºÐ°Ð¼ÐµÑ€Ð° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°)"),v}catch(v){console.error("Audio fallback also failed:",v)}throw ge(`ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº ÐºÐ°Ð¼ÐµÑ€Ðµ/Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ñƒ: ${m.name||String(m)}`),e(null),m}}const l=async()=>{try{const m=t()?.getVideoTracks()[0]?.getSettings().facingMode==="environment"?"user":"environment",v=Vt[s()]||Vt.medium,g=await oi(m),R=g?{deviceId:{exact:g},width:{ideal:v.width},height:{ideal:v.height},frameRate:{ideal:v.frameRate}}:{facingMode:{ideal:m},width:{ideal:v.width},height:{ideal:v.height},frameRate:{ideal:v.frameRate}},D=await navigator.mediaDevices.getUserMedia({audio:!0,video:R}),Q=D.getVideoTracks()[0],de=D.getAudioTracks()[0];for(const[,K]of L().entries()){const Te=K.pc.getSenders().find(Ae=>Ae.track&&Ae.track.kind==="video");Te&&await Te.replaceTrack(Q);const Mt=K.pc.getSenders().find(Ae=>Ae.track&&Ae.track.kind==="audio");Mt&&de&&await Mt.replaceTrack(de)}t()?.getTracks().forEach(K=>K.stop()),e(D),await $()}catch(d){q("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼ÐµÑ€Ñƒ"),console.warn(d)}},h=async()=>{try{const d=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0});d.getVideoTracks()[0].onended=()=>y();for(const[,m]of L().entries()){const v=m.pc.getSenders().find(g=>g.track&&g.track.kind==="video");v&&v.replaceTrack(d.getVideoTracks()[0])}mt(d),yt(!0)}catch(d){console.error("Error starting screen share:",d),q("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ ÑÐºÑ€Ð°Ð½Ð°")}},y=async()=>{try{if(Be()&&(Be().getTracks().forEach(d=>d.stop()),mt(null)),t())for(const[,d]of L().entries()){const m=d.pc.getSenders().find(v=>v.track&&v.track.kind==="video");m&&m.replaceTrack(t().getVideoTracks()[0])}yt(!1)}catch(d){console.error("Error stopping screen share:",d)}},A=()=>{Re()?y():h()},x=async()=>{const d=t();if(!d)return;const m=wt();if(fi(!m),m){const v=r();v&&(v.cleanup(),a(null));try{const R=(await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1}})).getAudioTracks()[0];for(const[Q,de]of L().entries()){const K=de.pc.getSenders().find(Te=>Te.track&&Te.track.kind==="audio");K&&R&&await K.replaceTrack(R)}const D=new MediaStream;D.addTrack(R),d.getVideoTracks().forEach(Q=>D.addTrack(Q)),d.getAudioTracks().forEach(Q=>Q.stop()),e(D),q("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾")}catch(g){console.error("Failed to get new audio stream:",g),q("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÑˆÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ")}}else{const v=new jt,g=await v.processStream(d);a(v);for(const[D,Q]of L().entries()){const de=Q.pc.getSenders().find(K=>K.track&&K.track.kind==="audio");de&&g.getAudioTracks()[0]&&await de.replaceTrack(g.getAudioTracks()[0])}const R=new MediaStream;g.getAudioTracks().forEach(D=>R.addTrack(D)),d.getVideoTracks().forEach(D=>R.addTrack(D)),e(R),q("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾")}};return ke(()=>{T(),b(!1);const d=r();d&&(d.cleanup(),a(null));const m=t();m&&m.getTracks().forEach(g=>{try{g.stop()}catch(R){console.warn("Error stopping track:",R)}});const v=Be();v&&v.getTracks().forEach(g=>{try{g.stop()}catch(R){console.warn("Error stopping screen track:",R)}}),i(!1)}),{localStream:t,setLocalStream:e,getLocalStream:S,swapCamera:l,toggleFlashlight:()=>F(),flashlightEnabled:n,toggleScreenShare:A,getFacing:u,toggleNoiseSuppression:x}}const ee=Object.create(null);ee.open="0";ee.close="1";ee.ping="2";ee.pong="3";ee.message="4";ee.upgrade="5";ee.noop="6";const Ge=Object.create(null);Object.keys(ee).forEach(t=>{Ge[ee[t]]=t});const _t={type:"error",data:"parser error"},_n=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",bn=typeof ArrayBuffer=="function",Sn=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Lt=({type:t,data:e},n,i)=>_n&&e instanceof Blob?n?i(e):Kt(e,i):bn&&(e instanceof ArrayBuffer||Sn(e))?n?i(e):Kt(new Blob([e]),i):i(ee[t]+(e||"")),Kt=(t,e)=>{const n=new FileReader;return n.onload=function(){const i=n.result.split(",")[1];e("b"+(i||""))},n.readAsDataURL(t)};function Yt(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let lt;function vi(t,e){if(_n&&t.data instanceof Blob)return t.data.arrayBuffer().then(Yt).then(e);if(bn&&(t.data instanceof ArrayBuffer||Sn(t.data)))return e(Yt(t.data));Lt(t,!1,n=>{lt||(lt=new TextEncoder),e(lt.encode(n))})}const Jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Pe=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Jt.length;t++)Pe[Jt.charCodeAt(t)]=t;const wi=t=>{let e=t.length*.75,n=t.length,i,s=0,o,r,a,c;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const u=new ArrayBuffer(e),p=new Uint8Array(u);for(i=0;i<n;i+=4)o=Pe[t.charCodeAt(i)],r=Pe[t.charCodeAt(i+1)],a=Pe[t.charCodeAt(i+2)],c=Pe[t.charCodeAt(i+3)],p[s++]=o<<2|r>>4,p[s++]=(r&15)<<4|a>>2,p[s++]=(a&3)<<6|c&63;return u},_i=typeof ArrayBuffer=="function",Nt=(t,e)=>{if(typeof t!="string")return{type:"message",data:kn(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:bi(t.substring(1),e)}:Ge[n]?t.length>1?{type:Ge[n],data:t.substring(1)}:{type:Ge[n]}:_t},bi=(t,e)=>{if(_i){const n=wi(t);return kn(n,e)}else return{base64:!0,data:t}},kn=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},En="",Si=(t,e)=>{const n=t.length,i=new Array(n);let s=0;t.forEach((o,r)=>{Lt(o,!1,a=>{i[r]=a,++s===n&&e(i.join(En))})})},ki=(t,e)=>{const n=t.split(En),i=[];for(let s=0;s<n.length;s++){const o=Nt(n[s],e);if(i.push(o),o.type==="error")break}return i};function Ei(){return new TransformStream({transform(t,e){vi(t,n=>{const i=n.length;let s;if(i<126)s=new Uint8Array(1),new DataView(s.buffer).setUint8(0,i);else if(i<65536){s=new Uint8Array(3);const o=new DataView(s.buffer);o.setUint8(0,126),o.setUint16(1,i)}else{s=new Uint8Array(9);const o=new DataView(s.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(i))}t.data&&typeof t.data!="string"&&(s[0]|=128),e.enqueue(s),e.enqueue(n)})}})}let ut;function Qe(t){return t.reduce((e,n)=>e+n.length,0)}function We(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let i=0;for(let s=0;s<e;s++)n[s]=t[0][i++],i===t[0].length&&(t.shift(),i=0);return t.length&&i<t[0].length&&(t[0]=t[0].slice(i)),n}function Ci(t,e){ut||(ut=new TextDecoder);const n=[];let i=0,s=-1,o=!1;return new TransformStream({transform(r,a){for(n.push(r);;){if(i===0){if(Qe(n)<1)break;const c=We(n,1);o=(c[0]&128)===128,s=c[0]&127,s<126?i=3:s===126?i=1:i=2}else if(i===1){if(Qe(n)<2)break;const c=We(n,2);s=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),i=3}else if(i===2){if(Qe(n)<8)break;const c=We(n,8),u=new DataView(c.buffer,c.byteOffset,c.length),p=u.getUint32(0);if(p>Math.pow(2,21)-1){a.enqueue(_t);break}s=p*Math.pow(2,32)+u.getUint32(4),i=3}else{if(Qe(n)<s)break;const c=We(n,s);a.enqueue(Nt(o?c:ut.decode(c),e)),i=0}if(s===0||s>t){a.enqueue(_t);break}}}})}const Cn=4;function B(t){if(t)return Ti(t)}function Ti(t){for(var e in B.prototype)t[e]=B.prototype[e];return t}B.prototype.on=B.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};B.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};B.prototype.off=B.prototype.removeListener=B.prototype.removeAllListeners=B.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var i,s=0;s<n.length;s++)if(i=n[s],i===e||i.fn===e){n.splice(s,1);break}return n.length===0&&delete this._callbacks["$"+t],this};B.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(n){n=n.slice(0);for(var i=0,s=n.length;i<s;++i)n[i].apply(this,e)}return this};B.prototype.emitReserved=B.prototype.emit;B.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};B.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ot=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),G=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Ai="arraybuffer";function Tn(t,...e){return e.reduce((n,i)=>(t.hasOwnProperty(i)&&(n[i]=t[i]),n),{})}const xi=G.setTimeout,$i=G.clearTimeout;function rt(t,e){e.useNativeTimers?(t.setTimeoutFn=xi.bind(G),t.clearTimeoutFn=$i.bind(G)):(t.setTimeoutFn=G.setTimeout.bind(G),t.clearTimeoutFn=G.clearTimeout.bind(G))}const Ri=1.33;function Li(t){return typeof t=="string"?Ni(t):Math.ceil((t.byteLength||t.size)*Ri)}function Ni(t){let e=0,n=0;for(let i=0,s=t.length;i<s;i++)e=t.charCodeAt(i),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(i++,n+=4);return n}function An(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Pi(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Oi(t){let e={},n=t.split("&");for(let i=0,s=n.length;i<s;i++){let o=n[i].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class Bi extends Error{constructor(e,n,i){super(e),this.description=n,this.context=i,this.type="TransportError"}}class Pt extends B{constructor(e){super(),this.writable=!1,rt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,i){return super.emitReserved("error",new Bi(e,n,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Nt(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=Pi(e);return n.length?"?"+n:""}}class Mi extends Pt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||n()})),this.writable||(i++,this.once("drain",function(){--i||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};ki(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Si(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=An()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let xn=!1;try{xn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Di=xn;function Ii(){}class Fi extends Mi{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let i=location.port;i||(i=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,n){const i=this.request({method:"POST",data:e});i.on("success",n),i.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,i)=>{this.onError("xhr poll error",n,i)}),this.pollXhr=e}}class X extends B{constructor(e,n,i){super(),this.createRequest=e,rt(this,i),this._opts=i,this._method=i.method||"GET",this._uri=n,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const n=Tn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(n);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let s in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(s)&&i.setRequestHeader(s,this._opts.extraHeaders[s])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var s;i.readyState===3&&((s=this._opts.cookieJar)===null||s===void 0||s.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(s){this.setTimeoutFn(()=>{this._onError(s)},0);return}typeof document<"u"&&(this._index=X.requestsCount++,X.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Ii,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete X.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}X.requestsCount=0;X.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Xt);else if(typeof addEventListener=="function"){const t="onpagehide"in G?"pagehide":"unload";addEventListener(t,Xt,!1)}}function Xt(){for(let t in X.requests)X.requests.hasOwnProperty(t)&&X.requests[t].abort()}const qi=function(){const t=$n({xdomain:!1});return t&&t.responseType!==null}();class Vi extends Fi{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=qi&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new X($n,this.uri(),e)}}function $n(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Di))return new XMLHttpRequest}catch{}if(!e)try{return new G[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Rn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Ui extends Pt{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,i=Rn?{}:Tn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,i)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const i=e[n],s=n===e.length-1;Lt(i,this.supportsBinary,o=>{try{this.doWrite(i,o)}catch{}s&&ot(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=An()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const dt=G.WebSocket||G.MozWebSocket;class Qi extends Ui{createSocket(e,n,i){return Rn?new dt(e,n,i):n?new dt(e,n):new dt(e)}doWrite(e,n){this.ws.send(n)}}class Wi extends Pt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=Ci(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(n).getReader(),s=Ei();s.readable.pipeTo(e.writable),this._writer=s.writable.getWriter();const o=()=>{i.read().then(({done:a,value:c})=>{a||(this.onPacket(c),o())}).catch(a=>{})};o();const r={type:"open"};this.query.sid&&(r.data=`{"sid":"${this.query.sid}"}`),this._writer.write(r).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const i=e[n],s=n===e.length-1;this._writer.write(i).then(()=>{s&&ot(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Hi={websocket:Qi,webtransport:Wi,polling:Vi},zi=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Gi=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function bt(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),i=t.indexOf("]");n!=-1&&i!=-1&&(t=t.substring(0,n)+t.substring(n,i).replace(/:/g,";")+t.substring(i,t.length));let s=zi.exec(t||""),o={},r=14;for(;r--;)o[Gi[r]]=s[r]||"";return n!=-1&&i!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=ji(o,o.path),o.queryKey=Ki(o,o.query),o}function ji(t,e){const n=/\/{2,9}/g,i=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function Ki(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,s,o){s&&(n[s]=o)}),n}const St=typeof addEventListener=="function"&&typeof removeEventListener=="function",je=[];St&&addEventListener("offline",()=>{je.forEach(t=>t())},!1);class ce extends B{constructor(e,n){if(super(),this.binaryType=Ai,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const i=bt(e);n.hostname=i.host,n.secure=i.protocol==="https"||i.protocol==="wss",n.port=i.port,i.query&&(n.query=i.query)}else n.host&&(n.hostname=bt(n.host).host);rt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(i=>{const s=i.prototype.name;this.transports.push(s),this._transportsByName[s]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Oi(this.opts.query)),St&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},je.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=Cn,n.transport=e,this.id&&(n.sid=this.id);const i=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&ce.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",ce.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let i=0;i<this.writeBuffer.length;i++){const s=this.writeBuffer[i].data;if(s&&(n+=Li(s)),i>0&&n>this._maxPayload)return this.writeBuffer.slice(0,i);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,ot(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,i){return this._sendPacket("message",e,n,i),this}send(e,n,i){return this._sendPacket("message",e,n,i),this}_sendPacket(e,n,i,s){if(typeof n=="function"&&(s=n,n=void 0),typeof i=="function"&&(s=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const o={type:e,data:n,options:i};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},i=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(ce.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),St&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=je.indexOf(this._offlineEventListener);i!==-1&&je.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}ce.protocol=Cn;class Yi extends ce{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),i=!1;ce.priorWebsocketSuccess=!1;const s=()=>{i||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!i)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;ce.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const _=new Error("probe error");_.transport=n.name,this.emitReserved("upgradeError",_)}}))};function o(){i||(i=!0,p(),n.close(),n=null)}const r=f=>{const _=new Error("probe error: "+f);_.transport=n.name,o(),this.emitReserved("upgradeError",_)};function a(){r("transport closed")}function c(){r("socket closed")}function u(f){n&&f.name!==n.name&&o()}const p=()=>{n.removeListener("open",s),n.removeListener("error",r),n.removeListener("close",a),this.off("close",c),this.off("upgrading",u)};n.once("open",s),n.once("error",r),n.once("close",a),this.once("close",c),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&n.push(e[i]);return n}}let Ji=class extends Yi{constructor(e,n={}){const i=typeof e=="object"?e:n;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(s=>Hi[s]).filter(s=>!!s)),super(e,i)}};function Xi(t,e="",n){let i=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),i=bt(t)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const o=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+o+":"+i.port+e,i.href=i.protocol+"://"+o+(n&&n.port===i.port?"":":"+i.port),i}const Zi=typeof ArrayBuffer=="function",es=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Ln=Object.prototype.toString,ts=typeof Blob=="function"||typeof Blob<"u"&&Ln.call(Blob)==="[object BlobConstructor]",ns=typeof File=="function"||typeof File<"u"&&Ln.call(File)==="[object FileConstructor]";function Ot(t){return Zi&&(t instanceof ArrayBuffer||es(t))||ts&&t instanceof Blob||ns&&t instanceof File}function Ke(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,i=t.length;n<i;n++)if(Ke(t[n]))return!0;return!1}if(Ot(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return Ke(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&Ke(t[n]))return!0;return!1}function is(t){const e=[],n=t.data,i=t;return i.data=kt(n,e),i.attachments=e.length,{packet:i,buffers:e}}function kt(t,e){if(!t)return t;if(Ot(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let i=0;i<t.length;i++)n[i]=kt(t[i],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=kt(t[i],e));return n}return t}function ss(t,e){return t.data=Et(t.data,e),delete t.attachments,t}function Et(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Et(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Et(t[n],e));return t}const os=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],rs=5;var k;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(k||(k={}));class as{constructor(e){this.replacer=e}encode(e){return(e.type===k.EVENT||e.type===k.ACK)&&Ke(e)?this.encodeAsBinary({type:e.type===k.EVENT?k.BINARY_EVENT:k.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===k.BINARY_EVENT||e.type===k.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=is(e),i=this.encodeAsString(n.packet),s=n.buffers;return s.unshift(i),s}}function Zt(t){return Object.prototype.toString.call(t)==="[object Object]"}class Bt extends B{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const i=n.type===k.BINARY_EVENT;i||n.type===k.BINARY_ACK?(n.type=i?k.EVENT:k.ACK,this.reconstructor=new cs(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Ot(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const i={type:Number(e.charAt(0))};if(k[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===k.BINARY_EVENT||i.type===k.BINARY_ACK){const o=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const r=e.substring(o,n);if(r!=Number(r)||e.charAt(n)!=="-")throw new Error("Illegal attachments");i.attachments=Number(r)}if(e.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););i.nsp=e.substring(o,n)}else i.nsp="/";const s=e.charAt(n+1);if(s!==""&&Number(s)==s){const o=n+1;for(;++n;){const r=e.charAt(n);if(r==null||Number(r)!=r){--n;break}if(n===e.length)break}i.id=Number(e.substring(o,n+1))}if(e.charAt(++n)){const o=this.tryParse(e.substr(n));if(Bt.isPayloadValid(i.type,o))i.data=o;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case k.CONNECT:return Zt(n);case k.DISCONNECT:return n===void 0;case k.CONNECT_ERROR:return typeof n=="string"||Zt(n);case k.EVENT:case k.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&os.indexOf(n[0])===-1);case k.ACK:case k.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class cs{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=ss(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const ls=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Bt,Encoder:as,get PacketType(){return k},protocol:rs},Symbol.toStringTag,{value:"Module"}));function j(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const us=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Nn extends B{constructor(e,n,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[j(e,"open",this.onopen.bind(this)),j(e,"packet",this.onpacket.bind(this)),j(e,"error",this.onerror.bind(this)),j(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var i,s,o;if(us.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const r={type:k.EVENT,data:n};if(r.options={},r.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const p=this.ids++,f=n.pop();this._registerAckCallback(p,f),r.id=p}const a=(s=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||s===void 0?void 0:s.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(r),this.packet(r)):this.sendBuffer.push(r)),this.flags={},this}_registerAckCallback(e,n){var i;const s=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(s===void 0){this.acks[e]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);n.call(this,new Error("operation has timed out"))},s),r=(...a)=>{this.io.clearTimeoutFn(o),n.apply(this,a)};r.withError=!0,this.acks[e]=r}emitWithAck(e,...n){return new Promise((i,s)=>{const o=(r,a)=>r?s(r):i(a);o.withError=!0,n.push(o),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...o)=>i!==this._queue[0]?void 0:(s!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(s)):(this._queue.shift(),n&&n(null,...o)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:k.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case k.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case k.EVENT:case k.BINARY_EVENT:this.onevent(e);break;case k.ACK:case k.BINARY_ACK:this.onack(e);break;case k.DISCONNECT:this.ondisconnect();break;case k.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const i of n)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let i=!1;return function(...s){i||(i=!0,n.packet({type:k.ACK,id:e,data:s}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:k.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let i=0;i<n.length;i++)if(e===n[i])return n.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let i=0;i<n.length;i++)if(e===n[i])return n.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const i of n)i.apply(this,e.data)}}}function Ce(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ce.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};Ce.prototype.reset=function(){this.attempts=0};Ce.prototype.setMin=function(t){this.ms=t};Ce.prototype.setMax=function(t){this.max=t};Ce.prototype.setJitter=function(t){this.jitter=t};class Ct extends B{constructor(e,n){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,rt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((i=n.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new Ce({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const s=n.parser||ls;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ji(this.uri,this.opts);const n=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const s=j(n,"open",function(){i.onopen(),e&&e()}),o=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},r=j(n,"error",o);if(this._timeout!==!1){const a=this._timeout,c=this.setTimeoutFn(()=>{s(),o(new Error("timeout")),n.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(s),this.subs.push(r),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(j(e,"ping",this.onping.bind(this)),j(e,"data",this.ondata.bind(this)),j(e,"error",this.onerror.bind(this)),j(e,"close",this.onclose.bind(this)),j(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){ot(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new Nn(this,e,n),this.nsps[e]=i),i}_destroy(e){const n=Object.keys(this.nsps);for(const i of n)if(this.nsps[i].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let i=0;i<n.length;i++)this.engine.write(n[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},n);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const xe={};function Ye(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=Xi(t,e.path||"/socket.io"),i=n.source,s=n.id,o=n.path,r=xe[s]&&o in xe[s].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||r;let c;return a?c=new Ct(i,e):(xe[s]||(xe[s]=new Ct(i,e)),c=xe[s]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(Ye,{Manager:Ct,Socket:Nn,io:Ye,connect:Ye});let N=null,we=null;function ds(t,e,n,i){const o=new URLSearchParams(window.location.search).get("signal")||window.location.origin;N=Ye(o,{transports:["polling","websocket"],path:"/socket.io",withCredentials:!1,timeout:15e3,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,forceNew:!1,autoConnect:!0,upgrade:!0,rememberUpgrade:!0});function r(){we&&clearInterval(we),we=setInterval(()=>{N?.connected&&N.emit("ping")},1e3)}function a(){we&&(clearInterval(we),we=null)}if(N.on("connect",()=>{ge(null),console.log("Connected to signaling server"),r()}),N.on("disconnect",()=>{Me(!1),console.log("Disconnected from signaling server"),a()}),N.on("connect_error",c=>{ge("Failed to connect to signaling server"),console.error("Connection error:",c)}),N.on("peers-list",({peers:c})=>{console.log("Received peers list:",c),console.log("Our socket ID:",N?.id),c.forEach(u=>{console.log(`Adding peer: ${u}`),e&&e(u)})}),N.on("peer-joined",({socketId:c})=>{console.log("Peer joined:",c),console.log("Our socket ID:",N?.id),e&&e(c)}),N.on("peer-left",({socketId:c})=>{console.log("Peer left:",c),wn(c),n&&n(c)}),N.on("user-name-set",({socketId:c,userName:u})=>{console.log(`User ${c} set name to: ${u}`),mi(c,u)}),N.on("chat-message",({author:c,text:u,timestamp:p})=>{console.log(`Chat message from ${c}: ${u}`),i&&i(c,u,new Date(p))}),N.on("signal",async({from:c,data:u})=>{t&&await t(c,u)}),N.on("pong",()=>{}),J&&typeof window<"u"){const c=()=>{const u=window.Telegram;if(u&&u.WebApp&&u.WebApp.initDataUnsafe&&u.WebApp.initDataUnsafe.start_param){const p=u.WebApp.initDataUnsafe.start_param;_e(p),he(!1)}};typeof window<"u"&&(window.addEventListener("load",c),setTimeout(c,500))}return ke(()=>{a(),N?.disconnect(),N=null}),{socket:()=>N,emit:(c,u)=>N?.emit(c,u),id:()=>N?.id}}function z(){return N}function hs(t,e){const n=1+L().size,i=oe(),s=si(n,i);console.log(`Creating peer connection for ${t} with config:`,s),console.log(`Connection mode: ${i?"ðŸ”’ Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ (STUN only)":"ðŸŒ Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€ (STUN + TURN)"}`);const o=new RTCPeerConnection(s),r=new MediaStream;if(o.onicecandidate=a=>{if(a.candidate){const c=a.candidate.type;c==="relay"?console.log(`ðŸ”„ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ TURN ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð»Ñ ${t}`):c==="srflx"?console.log(`âš¡ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ STUN (Ð¿Ñ€ÑÐ¼Ð¾Ðµ Ñ‡ÐµÑ€ÐµÐ· NAT) Ð´Ð»Ñ ${t}`):c==="host"&&console.log(`ðŸ  Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ${t}`),z()?.emit("signal",{to:t,data:{candidate:a.candidate}})}},o.ontrack=a=>{r.addTrack(a.track);const c=document.getElementById(`remoteVideo-${t}`);if(c&&c.srcObject!==r&&(c.srcObject=r),a.track&&a.track.kind==="video"){const u=document.querySelector(`#video-${t} .avatar`);u&&u.remove()}a.track&&(a.track.onended=()=>{console.log(`INSTANT REMOVAL: Track ended for ${t}`),be(t)})},o.onconnectionstatechange=()=>{console.log(`pc.connectionState with ${t}:`,o.connectionState),o.connectionState==="connecting"?(Ne(70),Le("Connecting...")):o.connectionState==="connected"?(Ne(100),Le("Connected!"),Me(!0),setTimeout(()=>H(!1),1e3)):o.connectionState==="failed"?(console.error(`WebRTC connection failed with ${t} - attempting restart`),H(!1),setTimeout(async()=>{if(Oe(t)){console.log(`Attempting to restart connection with ${t}`);try{await Pn(t,2)}catch(a){console.error(`Failed to restart connection with ${t}:`,a),be(t)}}},3e3)):o.connectionState==="disconnected"&&(console.warn(`WebRTC connection disconnected with ${t}`),console.log(`INSTANT REMOVAL: WebRTC disconnected with ${t}`),be(t))},o.oniceconnectionstatechange=()=>{if(console.log(`pc.iceConnectionState with ${t}:`,o.iceConnectionState),o.iceConnectionState==="failed"&&(console.error(`ICE connection failed for ${t}`),console.log(`INSTANT REMOVAL: ICE failed with ${t}`),be(t)),o.iceConnectionState==="disconnected"&&(console.log(`INSTANT REMOVAL: ICE disconnected with ${t}`),be(t)),o.iceConnectionState==="connected"){const a=st(t);a&&a._disconnectTimer&&(clearTimeout(a._disconnectTimer),a._disconnectTimer=null)}},o.onicegatheringstatechange=()=>{console.log(`pc.iceGatheringState with ${t}:`,o.iceGatheringState),o.iceGatheringState==="gathering"?(Ne(30),Le("Gathering ICE candidates...")):o.iceGatheringState==="complete"&&(Ne(60),Le("ICE gathering complete, checking connectivity..."))},e)for(const a of e.getTracks())o.addTrack(a,e);else o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});return{pc:o,remoteStream:r}}function be(t){const e=st(t);if(e){e.qualityInterval&&clearInterval(e.qualityInterval);try{e.pc.close()}catch(n){console.warn("Error closing peer connection:",n)}ai(t),fs(t)}}function fs(t){const e=document.getElementById(`video-${t}`);e&&e.remove()}async function ps(t){const e=st(t);if(!e){console.log(`Cannot call peer ${t}: peer not found in peers map`);return}console.log(`Calling peer ${t}...`);try{const n=await e.pc.createOffer();await e.pc.setLocalDescription(n),z()?.emit("signal",{to:t,data:{sdp:e.pc.localDescription}}),console.log(`Offer sent to ${t}`)}catch(n){throw console.error(`Error calling peer ${t}:`,n),n}}async function Pn(t,e=3){let n=0;for(;n<e;)try{await ps(t),console.log(`Successfully called peer ${t} on attempt ${n+1}`);return}catch(i){if(n++,console.warn(`Failed to call peer ${t} on attempt ${n}:`,i),n<e){const s=Math.pow(2,n)*1e3;console.log(`Retrying in ${s}ms...`),await new Promise(o=>setTimeout(o,s))}}console.error(`Failed to call peer ${t} after ${e} attempts`)}async function gs(t,e){if(console.log(`Received signal from ${t}:`,e),!Oe(t))return console.log(`Adding new peer ${t} from signal`),!1;const n=st(t);if(!n)return console.error(`Peer ${t} not found after adding`),!1;if(e.sdp){console.log(`Processing SDP from ${t}:`,e.sdp.type);try{let i=e.sdp;if((se||ae)&&(i.sdp=(i.sdp||"").replace(/a=fmtp:111 profile-level-id=42e01f[\r\n]/g,"")),it&&(i.sdp=(i.sdp||"").replace(/a=fmtp:111/g,"a=fmtp:111 profile-level-id=42e01f")),await n.pc.setRemoteDescription(new RTCSessionDescription(i)),i.type==="offer"){console.log(`Creating answer for ${t}`);let s={};(se||ae)&&(s.voiceActivityDetection=!1);const o=await n.pc.createAnswer(s);(se||ae)&&(o.sdp=(o.sdp||"").replace(/a=fmtp:111 profile-level-id=42e01f[\r\n]/g,"")),await n.pc.setLocalDescription(o),z()?.emit("signal",{to:t,data:{sdp:n.pc.localDescription}}),console.log(`Answer sent to ${t}`)}}catch(i){if(console.error(`Error processing SDP from ${t}:`,i),i.name==="InvalidStateError"&&i.message.includes("stable"))return console.log(`Skipping duplicate SDP from ${t}`),!1;throw i}}else if(e.candidate)try{await n.pc.addIceCandidate(new RTCIceCandidate(e.candidate)),console.log(`ICE candidate added for ${t}`)}catch(i){console.warn(`Failed to add ICE candidate for ${t}:`,i)}return!0}function On(t){const e=document.createElement("div");e.className="video-container remote-video",e.id=`video-${t}`;const n=document.createElement("video");n.autoplay=!0,n.playsInline=!0,n.id=`remoteVideo-${t}`,e.appendChild(n);const i=document.createElement("div");i.className="avatar";const s=xt().get(t)||"â€¢";return i.textContent=s.charAt(0).toUpperCase(),e.appendChild(i),e}const[en,ms]=C(0);function He(){ms(t=>t+1)}function ys(t){const e=re(()=>{en();const i=t();if(!i)return!1;const s=i.getAudioTracks();return s.length>0&&s.every(o=>o.enabled)}),n=re(()=>{en();const i=t();if(!i)return!1;const s=i.getVideoTracks();return s.length>0&&s.every(o=>o.enabled)});return{isAudioEnabled:e,isVideoEnabled:n}}var vs=M('<div class=video-section><div class=videos-grid id=videosGrid><div class="video-container local-video"><button class=pip-button title=Picture-in-Picture>ðŸ“º</button><div class=video-label><div class=mic-status id=localMicStatus>');let ht=null,$e=null;function Bn(t){const e=getComputedStyle(t),n=parseFloat(e.gap||"12"),i=parseFloat(e.paddingLeft||"16"),s=parseFloat(e.paddingRight||"16"),o=parseFloat(e.paddingTop||"16"),r=parseFloat(e.paddingBottom||"16"),a=t.clientWidth-i-s-n,c=t.clientHeight-o-r-n,u=Math.max(80,Math.floor(Math.min(a/2,c/2)));t.style.setProperty("--tile-size",u+"px")}function tn(){ht&&clearTimeout(ht),ht=setTimeout(()=>{const t=document.getElementById("videosGrid");t&&requestAnimationFrame(()=>{t.className="videos-grid";const e=t.querySelector(".video-container.local-video");if(e){e.classList.remove("placeholder");const o=e.querySelector("#localAvatar");o&&o.remove()}const n=t.querySelectorAll(".video-container:not(.placeholder)").length,i=t.querySelectorAll(".video-container.placeholder").length,s=Math.max(0,4-n);if(i>s){const o=t.querySelectorAll(".video-container.placeholder"),r=i-s;for(let a=0;a<r;a++)o[a]&&o[a].remove()}if(i<s){const o=document.createDocumentFragment(),r=s-i;for(let a=0;a<r;a++){const c=document.createElement("div");c.className="video-container placeholder",o.appendChild(c)}t.appendChild(o)}Bn(t)})},100)}function ws(t){let e,n;const i=re(()=>{const s=t.localStream();if(!s)return!1;const o=s.getAudioTracks();return o.length>0&&o.every(r=>r.enabled)});return ne(()=>{pt(),tn()}),ne(()=>{const s=document.getElementById("localMicStatus");s&&(s.className=`mic-status ${i()?"":"muted"}`)}),ne(()=>{const s=t.localStream();if(n){let o=n.querySelector("#localVideo");o||(o=document.createElement("video"),o.id="localVideo",o.autoplay=!0,o.playsInline=!0,o.setAttribute("playsinline",""),o.muted=!0,n.appendChild(o)),s&&o.srcObject!==s&&(o.srcObject=s,o.play().catch(r=>console.warn("Local video play failed:",r)))}}),ne(()=>{pt().forEach(o=>{if(!document.getElementById(`video-${o}`)){const r=On(o);e.appendChild(r)}}),tn()}),qe(()=>{typeof window<"u"&&e&&($e=new ResizeObserver(()=>{e&&Bn(e)}),$e.observe(e),ke(()=>{$e&&($e.disconnect(),$e=null)}))}),(()=>{var s=vs(),o=s.firstChild,r=o.firstChild,a=r.firstChild,c=e;typeof c=="function"?pe(c,o):e=o;var u=n;return typeof u=="function"?pe(u,r):n=r,Y(a,"click",t.onEnablePiP),s})()}me(["click"]);var _s=M("<button class=settings-pill><span class=icon>ðŸ“¹</span><span>"),bs=M('<button class="settings-pill back-button"><span class=icon>â†</span><span>ÐÐ°Ð·Ð°Ð´'),Ss=M("<button><span class=icon></span><span>");function ks(t){const e=[{value:"1080p",label:"1080p",icon:"ðŸŽ¬"},{value:"720p",label:"720p",icon:"ðŸ“¹"},{value:"480p",label:"480p",icon:"ðŸ“±"},{value:"auto",label:"ÐÐ²Ñ‚Ð¾",icon:"âš¡"}],n=()=>{const o=e.find(r=>r.value===t.currentQuality());return o?`${o.label}`:"ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾"},i=(o,r)=>{o.stopPropagation(),t.onQualityChange(r)},s=o=>{console.log("VideoQuality: handleToggle clicked"),o.stopPropagation(),o.preventDefault(),t.onToggleQualityMenu()};return Se(()=>Se(()=>!t.showQualityMenu())()?(()=>{var o=_s(),r=o.firstChild,a=r.nextSibling;return o.$$click=s,E(a,n),o})():[Se(()=>e.map(o=>(()=>{var r=Ss(),a=r.firstChild,c=a.nextSibling;return r.$$click=u=>i(u,o.value),E(a,()=>o.icon),E(c,()=>o.label),U(()=>te(r,`settings-pill quality-option ${t.currentQuality()===o.value?"active":""}`)),r})())),(()=>{var o=bs();return o.$$click=s,o})()])}me(["click"]);var Es=M('<button id=transBtn><img src=/icon/screen_share_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt="Screen Share"width=20 height=20><span>'),Cs=M("<button id=flashlightToggle><img src=/icon/flashlight_on_24dp_345D2F_FILL0_wght400_GRAD0_opsz24.svg alt=Flashlight width=20 height=20><span>"),Ts=M('<button class=settings-pill id=swapCameraBtn><img src=/icon/cameraswitch_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt="Swap Camera"width=20 height=20><span>Swap'),As=M("<button><span class=icon>ðŸŽ™ï¸</span><span>Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ"),xs=M('<div class=call-controls id=callControls><div class=control-group><button id=toggleMic title=Mic><img src=/icon/mic_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Mic width=24 height=24></button><button id=toggleCam title=Video><img src=/icon/videocam_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Video width=24 height=24></button><div class=settings-fab-wrap><button class="control-btn round settings"id=settingsBtn title=Settings><img src=/icon/settings_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Settings width=24 height=24></button><div class=settings-submenu id=settingsSubmenu></div></div><button class="control-btn round copy-link"id=copyLinkBtn title=Share><img src=/icon/share_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Share width=24 height=24></button></div><div class=hangup-wrap><button class="control-btn leave"id=hangupBtn title=Leave><img src=/icon/call_end_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Leave width=32 height=32>');function $s(t){const e=ys(t.localStream),[n,i]=C(!1),[s,o]=C(!1);let r,a,c;const u=()=>{r&&(r.classList.remove("hiding"),r.classList.add("show"),i(!0))},p=()=>{if(!r||!r.classList.contains("show"))return;r.classList.remove("show"),r.classList.add("hiding");const w=()=>{r&&(r.classList.remove("hiding"),r.removeEventListener("animationend",w),i(!1))};r.addEventListener("animationend",w,{once:!0})},f=()=>{n()?(p(),o(!1)):u()},_=()=>{console.log("Controls: toggleQualityMenu called, current state:",s()),o(!s())};return ne(()=>{if(a){const w=a.querySelector("span");w&&(w.textContent=t.flashlightEnabled?"OFF":"ON"),t.flashlightEnabled?a.classList.add("active"):a.classList.remove("active")}}),ne(()=>{if(c){const w=c.querySelector("span");w&&(w.textContent=Re()?"Stop":"Trans"),Re()?c.classList.add("active"):c.classList.remove("active")}}),qe(()=>{const w=T=>{const b=T.target,$=document.getElementById("settingsBtn");if(b.closest(".settings-pill")?.textContent?.includes("ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾")||b.closest(".settings-pill")?.textContent?.includes("1080p")||b.closest(".settings-pill")?.textContent?.includes("720p")||b.closest(".settings-pill")?.textContent?.includes("480p")||b.closest(".settings-pill")?.textContent?.includes("ÐÐ²Ñ‚Ð¾")||b.closest(".settings-pill")?.textContent?.includes("ÐÐ°Ð·Ð°Ð´")){console.log("Controls: Click on quality button, ignoring");return}!(r?.contains(b)||$?.contains(b))&&n()&&(console.log("Controls: Click outside, closing menu"),p(),o(!1))};document.addEventListener("click",w),ke(()=>document.removeEventListener("click",w))}),O(Z,{get when(){return $t()},get children(){var w=xs(),T=w.firstChild,b=T.firstChild,$=b.nextSibling,F=$.nextSibling,S=F.firstChild,l=S.nextSibling,h=F.nextSibling,y=T.nextSibling,A=y.firstChild;Y(b,"click",t.onToggleMic),Y($,"click",t.onToggleCam),S.$$click=f;var x=r;return typeof x=="function"?pe(x,l):r=l,E(l,O(Z,{get when(){return!s()},get children(){return[(()=>{var d=Es(),m=d.firstChild,v=m.nextSibling;Y(d,"click",t.onToggleScreenShare);var g=c;return typeof g=="function"?pe(g,d):c=d,E(v,()=>Re()?"Stop":"Trans"),U(()=>te(d,`settings-pill ${Re()?"active":""}`)),d})(),(()=>{var d=Cs(),m=d.firstChild,v=m.nextSibling;Y(d,"click",t.onToggleFlashlight);var g=a;return typeof g=="function"?pe(g,d):a=d,E(v,()=>t.flashlightEnabled?"OFF":"ON"),U(()=>te(d,`settings-pill ${t.flashlightEnabled?"active":""}`)),d})(),(()=>{var d=Ts();return Y(d,"click",t.onSwapCamera),d})(),(()=>{var d=As();return Y(d,"click",t.onToggleNoiseSuppression),U(()=>te(d,`settings-pill ${wt()?"active":""}`)),d})()]}}),null),E(l,O(ks,{get onQualityChange(){return t.onQualityChange},currentQuality:()=>vn(),showQualityMenu:s,onToggleQualityMenu:_}),null),Y(h,"click",t.onCopyLink),Y(A,"click",t.onHangup),U(d=>{var m=`control-btn round mic primary ${e.isAudioEnabled()?"enabled":""}`,v=`control-btn round video ${e.isVideoEnabled()?"enabled":""}`;return m!==d.e&&te(b,d.e=m),v!==d.t&&te($,d.t=v),d},{e:void 0,t:void 0}),w}})}me(["click"]);var Rs=M('<div class=chat-section id=chatSection><div class=chat-header><div class=chat-title>Chat</div></div><div class=chat-messages id=chatMessages></div><div class=chat-input-container><input type=text id=chatInput placeholder="ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."maxlength=500><button class=chat-send-btn id=chatSendBtn><svg width=16 height=16 viewBox="0 0 24 24"fill=currentColor><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z">'),Ls=M("<div><div class=chat-message-author></div><div class=chat-message-text></div><div class=chat-message-time>");function Ns(){const[t,e]=C("");let n,i=null;ne(()=>{gt(),i&&clearTimeout(i),i=setTimeout(()=>{n&&requestAnimationFrame(()=>{n.scrollTop=n.scrollHeight})},10)});const s=()=>{const o=t().trim();if(!o)return;if(!ct()&&!fe){De(()=>{mn(o),yn(!0)});return}z()?.emit("chat-message",{author:ct(),text:o,timestamp:new Date}),De(()=>{Rt(ct(),o,!0),e("")})};return O(Z,{get when(){return li()&&!fe},get children(){var o=Rs(),r=o.firstChild,a=r.nextSibling,c=a.nextSibling,u=c.firstChild,p=u.nextSibling,f=n;return typeof f=="function"?pe(f,a):n=a,E(a,O(Gn,{get each(){return gt()},children:_=>(()=>{var w=Ls(),T=w.firstChild,b=T.nextSibling,$=b.nextSibling;return E(T,()=>_.author),E(b,()=>_.text),E($,()=>gi(_.timestamp)),U(()=>te(w,`chat-message ${_.isOwn?"own":"other"}`)),w})()})),u.addEventListener("keypress",_=>_.key==="Enter"&&s()),u.$$input=_=>e(_.currentTarget.value),p.$$click=s,U(()=>u.value=t()),o}})}me(["input","click"]);var Ps=M('<div class=name-modal id=nameModal style=display:flex><div class=name-modal-content><h3>ÐšÐ°Ðº Ð²Ð°Ñ Ð·Ð¾Ð²ÑƒÑ‚?</h3><p>Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ Ð´Ð»Ñ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ñ Ð² Ñ‡Ð°Ñ‚Ðµ</p><input type=text id=userNameInput placeholder="Ð’Ð°ÑˆÐµ Ð¸Ð¼Ñ"maxlength=20><div class=name-modal-buttons><button class=btn-primary id=confirmNameBtn>ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ');function Os(){const[t,e]=C("");let n;qe(()=>{zt()&&n&&setTimeout(()=>{n.focus(),n.select()},100)});const i=()=>{const s=t().trim();if(s.length<2){q("Ð˜Ð¼Ñ Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°");return}if(s.length>20){q("Ð˜Ð¼Ñ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 20 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²");return}fn(s),yn(!1);const o=z();o?.emit("set-user-name",{userName:s});const r=ui();r&&r.trim()&&(o?.emit("chat-message",{author:s,text:r,timestamp:new Date}),Rt(s,r,!0),mn(null)),e("")};return O(Z,{get when(){return zt()},get children(){var s=Ps(),o=s.firstChild,r=o.firstChild,a=r.nextSibling,c=a.nextSibling,u=c.nextSibling,p=u.firstChild,f=n;return typeof f=="function"?pe(f,c):n=c,c.addEventListener("keypress",_=>_.key==="Enter"&&i()),c.$$input=_=>e(_.currentTarget.value),p.$$click=i,U(()=>c.value=t()),s}})}me(["input","click"]);var Bs=M("<div>"),Ms=M("<div class=preloader id=preloader><div class=logo>Adeita Vichat</div><div class=spinner>");function Ds(){return O(Z,{get when(){return di()},get children(){var t=Ms(),e=t.firstChild;return e.nextSibling,E(t,O(Z,{get when(){return Wt()},get children(){var n=Bs();return E(n,()=>Wt()),n}}),null),t}})}var Is=M("<div class=connection-type-selector-compact><div class=connection-compact-row><div class=connection-compact-label></div><div class=connection-toggle-wrap><button><div><div class=toggle-icon></div></div></button></div></div><div class=connection-compact-hint>");function Fs(){const[t,e]=C(!1);return qe(()=>{const n=new URLSearchParams(window.location.search),i=n.get("direct");n.get("room")&&i!==null&&e(!0)}),O(Z,{get when(){return!$t()},get children(){var n=Is(),i=n.firstChild,s=i.firstChild,o=s.nextSibling,r=o.firstChild,a=r.firstChild,c=a.firstChild,u=i.nextSibling;return E(s,()=>oe()?"ðŸ”’ Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ":"ðŸŒ Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€"),r.$$click=()=>!t()&&vt(!oe()),E(c,()=>oe()?"ðŸ”’":"ðŸŒ"),E(u,(()=>{var p=Se(()=>!!t());return()=>p()?"ðŸ” Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÐµÐ¼":oe()?"ÐŸÑ€ÑÐ¼Ð¾Ðµ P2P":"ÐÐ°Ð´ÐµÐ¶Ð½ÐµÐµ"})()),U(p=>{var f=`connection-toggle ${t()?"locked":""}`,_=t(),w=t()?"Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÐµÐ»ÐµÐ¼":"ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ",T=`toggle-slider ${oe()?"direct":"relay"}`;return f!==p.e&&te(r,p.e=f),_!==p.t&&(r.disabled=p.t=_),w!==p.a&&un(r,"title",p.a=w),T!==p.o&&te(a,p.o=T),p},{e:void 0,t:void 0,a:void 0,o:void 0}),n}})}me(["click"]);var qs=M("<div class=connection-quality-indicator><div class=quality-icon></div><div class=quality-details><div class=quality-text></div><div class=quality-stats><span class=ping>ms"),Vs=M("<span class=packet-loss> â€¢ <!>% Ð¿Ð¾Ñ‚ÐµÑ€ÑŒ");function Us(){const[t,e]=C("unknown"),[n,i]=C(0),[s,o]=C(0);let r=null;const a=async()=>{const f=L();if(f.size===0){e("unknown"),i(0),o(0);return}let _=0,w=0,T=0;for(const[b,$]of f.entries())try{(await $.pc.getStats()).forEach(S=>{if(S.type==="candidate-pair"&&S.state==="succeeded"&&S.currentRoundTripTime&&(_+=S.currentRoundTripTime*1e3,T++),S.type==="inbound-rtp"&&S.kind==="video"&&S.packetsLost&&S.packetsReceived){const l=S.packetsLost/(S.packetsLost+S.packetsReceived)*100;w+=l}})}catch(F){console.warn(`Failed to get stats for peer ${b}:`,F)}if(T>0){const b=Math.round(_/T),$=w/f.size;i(b),o(Math.round($)),b<100&&$<2?e("excellent"):b<200&&$<5?e("good"):e("poor")}};ne(()=>{r=setInterval(a,2e3),ke(()=>{r&&clearInterval(r)})});const c=()=>{switch(t()){case"excellent":return"ðŸ“¶";case"good":return"ðŸ“¶";case"poor":return"ðŸ“µ";default:return"âšª"}},u=()=>{switch(t()){case"excellent":return"#16a34a";case"good":return"#d97706";case"poor":return"#dc2626";default:return"#8a8a8a"}},p=()=>{switch(t()){case"excellent":return"ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾";case"good":return"Ð¥Ð¾Ñ€Ð¾ÑˆÐ¾";case"poor":return"ÐŸÐ»Ð¾Ñ…Ð¾";default:return"â€”"}};return O(Z,{get when(){return L().size>0},get children(){var f=qs(),_=f.firstChild,w=_.nextSibling,T=w.firstChild,b=T.nextSibling,$=b.firstChild,F=$.firstChild;return E(_,c),E(T,p),E($,n,F),E(b,(()=>{var S=Se(()=>s()>0);return()=>S()&&(()=>{var l=Vs(),h=l.firstChild,y=h.nextSibling;return y.nextSibling,E(l,s,y),l})()})(),null),U(S=>{var l=u(),h=u();return l!==S.e&&Ft(_,"color",S.e=l),h!==S.t&&Ft(T,"color",S.t=h),S},{e:void 0,t:void 0}),f}})}var Qs=M("<div id=errors><div class=errors>"),Ws=M("<div class=call-button-container id=callButtonContainer><button class=call-button id=callButton><img src=/icon/connect_without_contact_24dp_FFFFFF_FILL0_wght400_GRAD0_opsz24.svg alt=Connected width=24 height=24><span>"),Hs=M('<div class=wrap><header style="display:none !important"><div class=logo><div class=room-title></div><div class=participants-count> participant</div></div></header><div class=main-content><div class=participants-section id=participantsSection>');function zs(){const t=yi();let e=!0;const n=()=>{const l=new URLSearchParams(window.location.search),h=l.get("room"),y=l.get("direct");let A=l.get("tgWebAppStartParam")||l.get("startapp");if(J&&typeof window<"u"&&window.Telegram?.WebApp){const x=window.Telegram.WebApp;x.initDataUnsafe&&x.initDataUnsafe.start_param&&(A=x.initDataUnsafe.start_param)}fe&&Qt(!1),y==="1"||y==="true"?(vt(!0),console.log("ðŸ”’ Ð¢Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð· URL: Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ (P2P)")):(y==="0"||y==="false")&&(vt(!1),console.log("ðŸŒ Ð¢Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð· URL: Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€")),A?(_e(A),he(!1),setTimeout(()=>i(),100)):h?(_e(h),he(!1)):he(!0)},i=async()=>{try{console.log(`Joining existing room: ${W()}`),H(!0);try{await t.getLocalStream()}catch(h){console.warn("Failed to get local stream, continuing without it:",h)}z()?.emit("join",W()),Me(!0),setTimeout(()=>H(!1),3e3)}catch(l){console.error("Failed to join existing room:",l),ge(`Failed to join room: ${l.message}`),H(!1)}},s=async()=>{const l=pi();_e(l),he(!0);try{console.log(`Creating new room: ${l}`),H(!0),await t.getLocalStream(),z()?.emit("join",l),Me(!0),setTimeout(()=>H(!1),2e3)}catch(h){console.error("Failed to create room:",h),ge(`Failed to create room: ${h.message}`),H(!1)}},o=async()=>{const l=1+L().size;if(t.localStream()&&l>=3)try{console.log(`Updating video quality for ${l} participants`);const h=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1},video:l>=4?{width:{ideal:480,max:640},height:{ideal:360,max:480},frameRate:{ideal:15,max:20},facingMode:{ideal:"user"}}:{width:{ideal:640,max:800},height:{ideal:480,max:600},frameRate:{ideal:20,max:25},facingMode:{ideal:"user"}}});for(const[x,d]of L().entries()){const m=d.pc.getSenders().find(g=>g.track&&g.track.kind==="video"),v=d.pc.getSenders().find(g=>g.track&&g.track.kind==="audio");m&&h.getVideoTracks()[0]&&await m.replaceTrack(h.getVideoTracks()[0]),v&&h.getAudioTracks()[0]&&await v.replaceTrack(h.getAudioTracks()[0])}const y=t.localStream();y&&y.getTracks().forEach(x=>x.stop()),t.setLocalStream(h);const A=document.getElementById("localVideo");A&&(A.srcObject=h,A.play().catch(x=>console.warn("Play failed:",x))),console.log(`Video quality updated for ${l} participants`)}catch(h){console.warn("Failed to update video quality:",h)}},r=async l=>{if(Oe(l)){console.log(`[App] Peer ${l} already exists, skipping`);return}console.log(`[App] Adding peer ${l}`),H(!0),Ne(10),Le("Creating connection...");const h=document.getElementById("videosGrid");if(h){console.log(`[App] Creating video element for ${l}`);const A=On(l);h.appendChild(A),console.log(`[App] Video element added to grid for ${l}`)}else console.error("[App] videosGrid not found!");const y=hs(l,t.localStream()||null);ri(l,y),console.log(`[App] Peer ${l} added to store`),await o()};ds(async(l,h)=>{Oe(l)||(console.log(`Adding new peer ${l} from signal`),r(l)),await gs(l,h)},l=>{console.log(`[App] onPeerJoined called for: ${l}`);const h=z();console.log(`[App] Our socket ID: ${h?.id}`),console.log("[App] Current peers:",pt()),r(l),setTimeout(async()=>{const y=z(),A=y?.id&&y.id<l;console.log(`[App] Should we call ${l}? ${A} (our ID: ${y?.id})`),Oe(l)&&A?(console.log(`[App] Calling new peer ${l}`),await Pn(l)):console.log(`[App] Waiting for peer ${l} to call us`)},1e3)},l=>{be(l)},(l,h,y)=>{Rt(l,h,!1)});const f=async()=>{const l=oe()?"&direct=1":"",h=`${window.location.origin}${window.location.pathname}?room=${W()}${l}`,y=`https://t.me/AdeitaBot/Adeita_Vichat?startapp=${W()}${l}`,x=`ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐ°ÑŽ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ðº Ð·Ð²Ð¾Ð½ÐºÑƒ

Ð¢Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ: ${oe()?"ðŸ”’ Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ (P2P)":"ðŸŒ Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€"}

Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ ÑÑ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð»Ð¸Ð±Ð¾:

â€” Ð§ÐµÑ€ÐµÐ· Telegram Mini App: ${y}

â€” Ð§ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚: ${h}

ðŸ˜¿Ð•ÑÐ»Ð¸ Telegram Mini App Ð½Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚`;if(J&&typeof window<"u"&&window.Telegram?.WebApp)window.Telegram.WebApp.sendData(x),window.Telegram.WebApp.close();else try{await navigator.clipboard.writeText(x),q("Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾")}catch{const m=document.createElement("textarea");m.value=x,document.body.appendChild(m),m.select(),document.execCommand("copy"),document.body.removeChild(m),q("Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾")}},_=()=>{H(!0);const l=z();W()&&l?.emit("leave",W()),se||ae?(t.localStream()&&(t.localStream().getAudioTracks().forEach(h=>{h.stop(),h.enabled=!1}),t.localStream().getVideoTracks().forEach(h=>{h.stop(),h.enabled=!1})),setTimeout(()=>w(),500)):w()},w=()=>{for(const[h,y]of L().entries())y.pc.getSenders().forEach(A=>A.track?.stop()),y.pc.close();ci(),wn(""),_e(""),he(!1),fn(""),gn([]),yt(!1),t.localStream()&&t.localStream().getTracks().forEach(h=>h.stop());const l=document.getElementById("localVideo");l&&(l.srcObject=null,l.pause()),Be()&&(Be().getTracks().forEach(h=>h.stop()),mt(null));try{document.querySelector(".video-section")?.classList.remove("flashlight-on"),document.body.classList.remove("flashlight-bg"),document.querySelector(".wrap")?.classList.remove("flashlight-bg")}catch(h){console.warn("Failed to cleanup flashlight:",h)}Me(!1),ge(null),H(!1),(se||ae)&&q("Ð—Ð²Ð¾Ð½Ð¾Ðº Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½. ÐœÐ¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½.")},T=async()=>{if(!t.localStream()){try{if(await t.getLocalStream(),t.localStream())for(const[y,A]of L().entries()){const x=A.pc.getSenders().find(d=>d.track&&d.track.kind==="audio");x&&t.localStream().getAudioTracks()[0]&&await x.replaceTrack(t.localStream().getAudioTracks()[0])}He()}catch(y){console.error("Failed to get stream:",y)}return}const l=t.localStream().getAudioTracks(),h=l.some(y=>y.enabled);for(const y of l)y.enabled=!h;He()},b=async()=>{if(!t.localStream()){try{if(await t.getLocalStream(),t.localStream())for(const[y,A]of L().entries()){const x=A.pc.getSenders().find(d=>d.track&&d.track.kind==="video");x&&t.localStream().getVideoTracks()[0]&&await x.replaceTrack(t.localStream().getVideoTracks()[0])}He()}catch(y){console.error("Failed to get stream:",y)}return}const l=t.localStream().getVideoTracks(),h=l.some(y=>y.enabled);for(const y of l)y.enabled=!h;He()},$=async l=>{if(e&&!t.localStream()){e=!1,console.log(`${l} detected, attempting to get camera access`);try{await t.getLocalStream(),q("ÐšÐ°Ð¼ÐµÑ€Ð° Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°")}catch(h){console.warn(`Failed to get camera on ${l}:`,h)}}},F=async l=>{if(hi(l),q(`ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð²Ð¸Ð´ÐµÐ¾: ${l}`),t.localStream())try{await t.getLocalStream();for(const[h,y]of L().entries()){const A=y.pc.getSenders().find(x=>x.track&&x.track.kind==="video");A&&t.localStream().getVideoTracks()[0]&&await A.replaceTrack(t.localStream().getVideoTracks()[0])}}catch(h){console.error("Failed to change video quality:",h)}},S=async()=>{const l=document.getElementById("localVideo");if(!l){q("Ð’Ð¸Ð´ÐµÐ¾ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾");return}try{document.pictureInPictureElement?(await document.exitPictureInPicture(),Gt(!1),q("PiP Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½")):(await l.requestPictureInPicture(),Gt(!0),q("PiP Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½"))}catch(h){console.error("PiP error:",h),q("PiP Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½")}};return qe(()=>{if(n(),H(!0),fe&&Qt(!1),setTimeout(()=>{H(!1),document.body.classList.add("loaded")},100),J&&typeof window<"u"&&window.Telegram?.WebApp){const l=()=>{const h=window.Telegram.WebApp;if(h.initDataUnsafe&&h.initDataUnsafe.start_param){const y=h.initDataUnsafe.start_param;_e(y),he(!1),setTimeout(()=>i(),200)}};window.addEventListener("load",l),setTimeout(l,500)}J&&(fe&&document.addEventListener("touchstart",()=>$("touch"),{once:!0}),document.querySelectorAll("button").forEach(h=>{h.addEventListener("click",()=>$("button click"),{once:!0})}),se&&document.addEventListener("visibilitychange",async()=>{!document.hidden&&!t.localStream()&&setTimeout(()=>$("visibility change"),100)}),Fe&&window.addEventListener("focus",()=>$("window focus"))),window.addEventListener("beforeunload",()=>{const l=z();W()&&l?.connected&&l.emit("leave",W())}),document.addEventListener("visibilitychange",()=>{if(document.hidden&&W()){const l=z();l?.connected&&l.emit("ping")}})}),[O(Ds,{}),(()=>{var l=Hs(),h=l.firstChild,y=h.firstChild,A=y.firstChild,x=A.nextSibling,d=x.firstChild,m=h.nextSibling,v=m.firstChild;return E(A,(()=>{var g=Se(()=>!!W());return()=>g()?`Room ${W()}`:"Adeita Vichat"})()),E(x,()=>1+L().size,d),E(x,()=>1+L().size!==1?"s":"",null),E(m,O(ws,{get localStream(){return t.localStream},onEnablePiP:S}),v),E(v,O(Ns,{})),E(l,O(Us,{}),null),E(l,O(Z,{get when(){return Ht()},get children(){var g=Qs(),R=g.firstChild;return E(R,()=>Ht()),g}}),null),E(l,O(Os,{}),null),E(l,O(Fs,{}),null),E(l,O(Z,{get when(){return!$t()},get children(){var g=Ws(),R=g.firstChild,D=R.firstChild,Q=D.nextSibling;return Y(R,"click",W()&&!Ut()?i:s),E(Q,()=>W()&&!Ut()?"Join call":"Start a call"),g}}),null),E(l,O($s,{onToggleMic:T,onToggleCam:b,get onToggleFlashlight(){return t.toggleFlashlight},get onSwapCamera(){return t.swapCamera},get onToggleScreenShare(){return t.toggleScreenShare},onCopyLink:f,onHangup:_,get flashlightEnabled(){return t.flashlightEnabled()},get localStream(){return t.localStream},get onToggleNoiseSuppression(){return t.toggleNoiseSuppression},onQualityChange:F}),null),U(g=>Yn(v,fe?"display: none !important;":"",g)),l})()]}me(["click"]);const Gs=document.getElementById("root");if(J&&typeof document<"u"){document.documentElement.classList.add("tg-webapp");let t=0;document.addEventListener("touchend",e=>{const n=Date.now();n-t<=300&&e.preventDefault(),t=n},{passive:!1}),document.addEventListener("touchstart",e=>{e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("touchmove",e=>{e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("wheel",e=>{e.ctrlKey&&e.preventDefault()},{passive:!1}),["gesturestart","gesturechange","gestureend"].forEach(e=>{document.addEventListener(e,n=>n.preventDefault())}),document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("selectstart",e=>{const n=(e.target?.tagName||"").toLowerCase();n!=="input"&&n!=="textarea"&&e.preventDefault()}),document.addEventListener("dragstart",e=>e.preventDefault())}else document.documentElement.classList.add("app-shell"),document.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("selectstart",t=>{const e=(t.target?.tagName||"").toLowerCase();e!=="input"&&e!=="textarea"&&t.preventDefault()}),document.addEventListener("dragstart",t=>t.preventDefault());Kn(()=>O(zs,{}),Gs);
//# sourceMappingURL=index-8LAX1sf6.js.map
