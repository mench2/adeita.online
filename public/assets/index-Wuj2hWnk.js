(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();const ns=!1,ss=(t,e)=>t===e,is=Symbol("solid-track"),nt={equals:ss};let vn=En;const pe=1,st=2,_n={owned:null,cleanups:null,context:null,owner:null};var F=null;let vt=null,rs=null,B=null,q=null,re=null,ht=0;function Je(t,e){const n=B,s=F,i=t.length===0,r=e===void 0?s:e,a=i?_n:{owned:null,cleanups:null,context:r?r.context:null,owner:r},o=i?t:()=>t(()=>fe(()=>Ge(a)));F=a,B=null;try{return Re(o,!0)}finally{B=n,F=s}}function k(t,e){e=e?Object.assign({},nt,e):nt;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=i=>(typeof i=="function"&&(i=i(n.value)),Sn(n,i));return[bn.bind(n),s]}function G(t,e,n){const s=qt(t,e,!1,pe);ze(s)}function se(t,e,n){vn=cs;const s=qt(t,e,!1,pe);s.user=!0,re?re.push(s):ze(s)}function le(t,e,n){n=n?Object.assign({},nt,n):nt;const s=qt(t,e,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=n.equals||void 0,ze(s),bn.bind(s)}function Ie(t){return Re(t,!1)}function fe(t){if(B===null)return t();const e=B;B=null;try{return t()}finally{B=e}}function ft(t){se(()=>fe(t))}function $e(t){return F===null||(F.cleanups===null?F.cleanups=[t]:F.cleanups.push(t)),t}function bn(){if(this.sources&&this.state)if(this.state===pe)ze(this);else{const t=q;q=null,Re(()=>rt(this),!1),q=t}if(B){const t=this.observers?this.observers.length:0;B.sources?(B.sources.push(this),B.sourceSlots.push(t)):(B.sources=[this],B.sourceSlots=[t]),this.observers?(this.observers.push(B),this.observerSlots.push(B.sources.length-1)):(this.observers=[B],this.observerSlots=[B.sources.length-1])}return this.value}function Sn(t,e,n){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&Re(()=>{for(let i=0;i<t.observers.length;i+=1){const r=t.observers[i],a=vt&&vt.running;a&&vt.disposed.has(r),(a?!r.tState:!r.state)&&(r.pure?q.push(r):re.push(r),r.observers&&kn(r)),a||(r.state=pe)}if(q.length>1e6)throw q=[],new Error},!1)),e}function ze(t){if(!t.fn)return;Ge(t);const e=ht;os(t,t.value,e)}function os(t,e,n){let s;const i=F,r=B;B=F=t;try{s=t.fn(e)}catch(a){return t.pure&&(t.state=pe,t.owned&&t.owned.forEach(Ge),t.owned=null),t.updatedAt=n+1,Cn(a)}finally{B=r,F=i}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Sn(t,s):t.value=s,t.updatedAt=n)}function qt(t,e,n,s=pe,i){const r={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:F,context:F?F.context:null,pure:n};return F===null||F!==_n&&(F.owned?F.owned.push(r):F.owned=[r]),r}function it(t){if(t.state===0)return;if(t.state===st)return rt(t);if(t.suspense&&fe(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<ht);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===pe)ze(t);else if(t.state===st){const s=q;q=null,Re(()=>rt(t,e[0]),!1),q=s}}function Re(t,e){if(q)return t();let n=!1;e||(q=[]),re?n=!0:re=[],ht++;try{const s=t();return as(n),s}catch(s){n||(re=null),q=null,Cn(s)}}function as(t){if(q&&(En(q),q=null),t)return;const e=re;re=null,e.length&&Re(()=>vn(e),!1)}function En(t){for(let e=0;e<t.length;e++)it(t[e])}function cs(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:it(s)}for(e=0;e<n;e++)it(t[e])}function rt(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const s=t.sources[n];if(s.sources){const i=s.state;i===pe?s!==e&&(!s.updatedAt||s.updatedAt<ht)&&it(s):i===st&&rt(s,e)}}}function kn(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=st,n.pure?q.push(n):re.push(n),n.observers&&kn(n))}}function Ge(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),s=t.sourceSlots.pop(),i=n.observers;if(i&&i.length){const r=i.pop(),a=n.observerSlots.pop();s<i.length&&(r.sourceSlots[a]=s,i[s]=r,n.observerSlots[s]=a)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)Ge(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)Ge(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function ls(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function Cn(t,e=F){throw ls(t)}const ds=Symbol("fallback");function sn(t){for(let e=0;e<t.length;e++)t[e]()}function us(t,e,n={}){let s=[],i=[],r=[],a=0,o=e.length>1?[]:null;return $e(()=>sn(r)),()=>{let c=t()||[],d=c.length,p,h;return c[is],fe(()=>{let _,A,w,C,R,l,u,m,S;if(d===0)a!==0&&(sn(r),r=[],s=[],i=[],a=0,o&&(o=[])),n.fallback&&(s=[ds],i[0]=Je(E=>(r[0]=E,n.fallback())),a=1);else if(a===0){for(i=new Array(d),h=0;h<d;h++)s[h]=c[h],i[h]=Je(b);a=d}else{for(w=new Array(d),C=new Array(d),o&&(R=new Array(d)),l=0,u=Math.min(a,d);l<u&&s[l]===c[l];l++);for(u=a-1,m=d-1;u>=l&&m>=l&&s[u]===c[m];u--,m--)w[m]=i[u],C[m]=r[u],o&&(R[m]=o[u]);for(_=new Map,A=new Array(m+1),h=m;h>=l;h--)S=c[h],p=_.get(S),A[h]=p===void 0?-1:p,_.set(S,h);for(p=l;p<=u;p++)S=s[p],h=_.get(S),h!==void 0&&h!==-1?(w[h]=i[p],C[h]=r[p],o&&(R[h]=o[p]),h=A[h],_.set(S,h)):r[p]();for(h=l;h<d;h++)h in w?(i[h]=w[h],r[h]=C[h],o&&(o[h]=R[h],o[h](h))):i[h]=Je(b);i=i.slice(0,a=d),s=c.slice(0)}return i});function b(_){if(r[h]=_,o){const[A,w]=k(h);return o[h]=w,e(c[h],A)}return e(c[h])}}}function V(t,e){return fe(()=>t(e||{}))}const hs=t=>`Stale read from <${t}>.`;function fs(t){const e="fallback"in t&&{fallback:()=>t.fallback};return le(us(()=>t.each,t.children,e||void 0))}function Z(t){const e=t.keyed,n=le(()=>t.when,void 0,void 0),s=e?n:le(n,void 0,{equals:(i,r)=>!i==!r});return le(()=>{const i=s();if(i){const r=t.children;return typeof r=="function"&&r.length>0?fe(()=>r(e?i:()=>{if(!fe(s))throw hs("Show");return n()})):r}return t.fallback},void 0,void 0)}const qe=t=>le(()=>t());function ps(t,e,n){let s=n.length,i=e.length,r=s,a=0,o=0,c=e[i-1].nextSibling,d=null;for(;a<i||o<r;){if(e[a]===n[o]){a++,o++;continue}for(;e[i-1]===n[r-1];)i--,r--;if(i===a){const p=r<s?o?n[o-1].nextSibling:n[r-o]:c;for(;o<r;)t.insertBefore(n[o++],p)}else if(r===o)for(;a<i;)(!d||!d.has(e[a]))&&e[a].remove(),a++;else if(e[a]===n[r-1]&&n[o]===e[i-1]){const p=e[--i].nextSibling;t.insertBefore(n[o++],e[a++].nextSibling),t.insertBefore(n[--r],p),e[i]=n[r]}else{if(!d){d=new Map;let h=o;for(;h<r;)d.set(n[h],h++)}const p=d.get(e[a]);if(p!=null)if(o<p&&p<r){let h=a,b=1,_;for(;++h<i&&h<r&&!((_=d.get(e[h]))==null||_!==p+b);)b++;if(b>p-o){const A=e[a];for(;o<p;)t.insertBefore(n[o++],A)}else t.replaceChild(n[o++],e[a++])}else a++;else e[a++].remove()}}}const rn="_$DX_DELEGATE";function gs(t,e,n,s={}){let i;return Je(r=>{i=r,e===document?t():x(e,t(),e.firstChild?null:void 0,n)},s.owner),()=>{i(),e.textContent=""}}function P(t,e,n,s){let i;const r=()=>{const o=document.createElement("template");return o.innerHTML=t,o.content.firstChild},a=()=>(i||(i=r())).cloneNode(!0);return a.cloneNode=a,a}function Le(t,e=window.document){const n=e[rn]||(e[rn]=new Set);for(let s=0,i=t.length;s<i;s++){const r=t[s];n.has(r)||(n.add(r),e.addEventListener(r,ys))}}function Tn(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function ne(t,e){e==null?t.removeAttribute("class"):t.className=e}function te(t,e,n,s){Array.isArray(n)?(t[`$$${e}`]=n[0],t[`$$${e}Data`]=n[1]):t[`$$${e}`]=n}function ms(t,e,n){if(!e)return n?Tn(t,"style"):e;const s=t.style;if(typeof e=="string")return s.cssText=e;typeof n=="string"&&(s.cssText=n=void 0),n||(n={}),e||(e={});let i,r;for(r in n)e[r]==null&&s.removeProperty(r),delete n[r];for(r in e)i=e[r],i!==n[r]&&(s.setProperty(r,i),n[r]=i);return n}function on(t,e,n){n!=null?t.style.setProperty(e,n):t.style.removeProperty(e)}function we(t,e,n){return fe(()=>t(e,n))}function x(t,e,n,s){if(n!==void 0&&!s&&(s=[]),typeof e!="function")return ot(t,e,s,n);G(i=>ot(t,e(),i,n),s)}function ys(t){let e=t.target;const n=`$$${t.type}`,s=t.target,i=t.currentTarget,r=c=>Object.defineProperty(t,"target",{configurable:!0,value:c}),a=()=>{const c=e[n];if(c&&!e.disabled){const d=e[`${n}Data`];if(d!==void 0?c.call(e,d,t):c.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&r(e.host),!0},o=()=>{for(;a()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const c=t.composedPath();r(c[0]);for(let d=0;d<c.length-2&&(e=c[d],!!a());d++){if(e._$host){e=e._$host,o();break}if(e.parentNode===i)break}}else o();r(s)}function ot(t,e,n,s,i){for(;typeof n=="function";)n=n();if(e===n)return n;const r=typeof e,a=s!==void 0;if(t=a&&n[0]&&n[0].parentNode||t,r==="string"||r==="number"){if(r==="number"&&(e=e.toString(),e===n))return n;if(a){let o=n[0];o&&o.nodeType===3?o.data!==e&&(o.data=e):o=document.createTextNode(e),n=ve(t,n,s,o)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||r==="boolean")n=ve(t,n,s);else{if(r==="function")return G(()=>{let o=e();for(;typeof o=="function";)o=o();n=ot(t,o,n,s)}),()=>n;if(Array.isArray(e)){const o=[],c=n&&Array.isArray(n);if(kt(o,e,n,i))return G(()=>n=ot(t,o,n,s,!0)),()=>n;if(o.length===0){if(n=ve(t,n,s),a)return n}else c?n.length===0?an(t,o,s):ps(t,n,o):(n&&ve(t),an(t,o));n=o}else if(e.nodeType){if(Array.isArray(n)){if(a)return n=ve(t,n,s,e);ve(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function kt(t,e,n,s){let i=!1;for(let r=0,a=e.length;r<a;r++){let o=e[r],c=n&&n[t.length],d;if(!(o==null||o===!0||o===!1))if((d=typeof o)=="object"&&o.nodeType)t.push(o);else if(Array.isArray(o))i=kt(t,o,c)||i;else if(d==="function")if(s){for(;typeof o=="function";)o=o();i=kt(t,Array.isArray(o)?o:[o],Array.isArray(c)?c:[c])||i}else t.push(o),i=!0;else{const p=String(o);c&&c.nodeType===3&&c.data===p?t.push(c):t.push(document.createTextNode(p))}}return i}function an(t,e,n=null){for(let s=0,i=e.length;s<i;s++)t.insertBefore(e[s],n)}function ve(t,e,n,s){if(n===void 0)return t.textContent="";const i=s||document.createTextNode("");if(e.length){let r=!1;for(let a=e.length-1;a>=0;a--){const o=e[a];if(i!==o){const c=o.parentNode===t;!r&&!a?c?t.replaceChild(i,o):t.insertBefore(i,n):c&&o.remove()}else r=!0}}else t.insertBefore(i,n);return[i]}const ye=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent)||window.matchMedia("(max-width: 768px)").matches,We=/Android/i.test(navigator.userAgent),oe=/iPhone|iPad|iPod/i.test(navigator.userAgent),de=/Safari/i.test(navigator.userAgent)&&!/Chrome/i.test(navigator.userAgent),ws=/Chrome/i.test(navigator.userAgent),pt=/Firefox/i.test(navigator.userAgent),An=/Edg/i.test(navigator.userAgent),vs=/Windows/i.test(navigator.userAgent),_s=/Macintosh|Mac OS X/i.test(navigator.userAgent),Y=typeof window<"u"&&!!window.Telegram&&!!window.Telegram.WebApp;console.log("Platform detection:",{mobile:ye,android:We,ios:oe,safari:de,chrome:ws,firefox:pt,edge:An,windows:vs,macos:_s,telegram:Y});const xn=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"}],bs=[{urls:"turn:95.81.117.141:3478",username:"adeita",credential:"TeFmLD44bTHMQeyuWgyFcB0fuRnuS3QklMb3ObxHPQM="},{urls:"turns:95.81.117.141:5349",username:"adeita",credential:"TeFmLD44bTHMQeyuWgyFcB0fuRnuS3QklMb3ObxHPQM="},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turns:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"}],Ss=[...xn,...bs];function Es(t){return t?(console.log("ðŸ”’ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ STUN)"),xn):(console.log("ðŸŒ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ñ‡ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€ (STUN + TURN)"),Ss)}const cn={high:{width:1920,height:1080,frameRate:30},medium:{width:1280,height:720,frameRate:30},low:{width:640,height:480,frameRate:15}};function ks(t,e=!1){let n=10;t>=4?n=3:t>=3&&(n=5);let s={iceServers:Es(e),iceCandidatePoolSize:n,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",iceTransportPolicy:"all",iceConnectionReceivingTimeout:t>=4?15e3:2e4,iceBackupCandidatePairPingInterval:2e3,continualGatheringPolicy:t>=4?"gather_once":"gather_continually",sdpSemantics:"unified-plan",iceGatheringTimeout:t>=4?1e4:15e3};return(oe||de)&&(s.iceCandidatePoolSize=5,s.iceConnectionReceivingTimeout=25e3,s.iceGatheringTimeout=2e4),We&&Y&&(s.iceCandidatePoolSize=8,s.iceConnectionReceivingTimeout=18e3),pt&&(s.iceCandidatePoolSize=12,s.iceConnectionReceivingTimeout=22e3),s}async function Cs(t){try{const n=(await navigator.mediaDevices.enumerateDevices()).filter(c=>c.kind==="videoinput");if(n.length===0)return null;const s=t==="environment"?["back","rear","environment"]:["front","user"],i=t==="environment"?["front","user"]:["back","rear","environment"],r=c=>n.find(d=>(d.label||"").toLowerCase().includes(c[0])||(d.label||"").toLowerCase().includes(c[1])||(d.label||"").toLowerCase().includes(c[2]||"")),a=r(s);if(a)return a.deviceId;const o=r(i);return o?o.deviceId:n[0].deviceId}catch(e){return console.warn("enumerateDevices failed:",e),null}}let _e=null,He=null;function W(t=""){const e=document.getElementById("nameModal");if(e&&getComputedStyle(e).display!=="none"&&e.offsetParent!==null)return;_e&&(_e.remove(),_e=null),He&&(clearTimeout(He),He=null);const n=document.createElement("div");n.className="copy-popover";const s=document.createElement("div");s.className="check",s.textContent="âœ“";const i=document.createElement("div");i.className="label",i.textContent=t,n.appendChild(s),n.appendChild(i),document.body.appendChild(n),_e=n;const r=document.getElementById("callControls"),a=r?r.getBoundingClientRect():null,o=n.getBoundingClientRect(),c=Math.max(8,(window.innerWidth-o.width)/2),d=a?Math.max(8,a.top-16-o.height):Math.max(8,window.innerHeight-110-o.height);n.style.left=c+"px",n.style.top=d+"px",requestAnimationFrame(()=>n.classList.add("show")),He=setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>{n.remove(),_e===n&&(_e=null)},150)},1800)}const[N,It]=k(new Map);function Ts(t,e){Ie(()=>{const n=new Map(N());n.set(t,e),It(n)})}function As(t){Ie(()=>{const e=N().get(t);if(e){e.qualityInterval&&clearInterval(e.qualityInterval),e._disconnectTimer&&clearTimeout(e._disconnectTimer);try{e.pc.close()}catch(s){console.warn("Error closing peer connection:",s)}}const n=new Map(N());n.delete(t),It(n)})}function Ce(t){return N().get(t)}function ce(t){return N().has(t)}function Ct(){return Array.from(N().keys())}function xs(){Ie(()=>{for(const[t,e]of N().entries()){e.qualityInterval&&clearInterval(e.qualityInterval),e._disconnectTimer&&clearTimeout(e._disconnectTimer);try{e.pc.close()}catch(n){console.warn(`Error closing peer ${t}:`,n)}}It(new Map)})}const[U,me]=k(""),[Tt,ae]=k(!1),[De,Gt]=k(""),[gt,Wt]=k(new Map),[at,Qt]=k([]),[$n,At]=k(!0),[Te,ct]=k(null),[Se,lt]=k(!1),[Rn,zt]=k(null),[Ln,I]=k(!1),[xt,Ee]=k(""),[$s,ke]=k(0),[$t,ue]=k(null),[Ae,xe]=k(!1),[Rt,Ht]=k(!1),[ie,dt]=k(!1),[Kt,Nn]=k("auto"),[ut,Pn]=k(!1),[Rs,Ls]=k(!1),[Qe,Ns]=k(!0),[J,Lt]=k(null),[Fe,Nt]=k("");function On(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let e="";for(let n=0;n<8;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function mt(t,e,n=!1){const s={id:Date.now()+Math.random(),author:t,text:e,timestamp:new Date,isOwn:n};return Qt([...at(),s]),s}function Bn(t){return t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}function Mn(t,e){const n=new Map(gt());n.set(t,e),Wt(n)}function jt(t){const e=new Map(gt());e.delete(t),Wt(e)}const Ps=Object.freeze(Object.defineProperty({__proto__:null,addChatMessage:mt,chatMessages:at,e2eeEnabled:Qe,e2eeKey:J,e2eeKeyString:Fe,error:$t,formatTime:Bn,generateRoomId:On,isChatVisible:$n,isRoomCreator:Tt,isScreenSharing:Se,noiseSuppressionEnabled:ut,pendingChatText:Rn,pipEnabled:Rs,progressPercent:$s,progressText:xt,removeUserName:jt,roomId:U,screenStream:Te,setChatMessages:Qt,setE2eeEnabled:Ns,setE2eeKey:Lt,setE2eeKeyString:Nt,setError:ue,setIsChatVisible:At,setIsRoomCreator:ae,setIsScreenSharing:lt,setNoiseSuppressionEnabled:Pn,setPendingChatText:zt,setPipEnabled:Ls,setProgressPercent:ke,setProgressText:Ee,setRoomId:me,setScreenStream:ct,setShowControls:xe,setShowNameModal:Ht,setShowProgress:I,setUseDirectConnection:dt,setUserName:Gt,setUserNames:Wt,setVideoQuality:Nn,showControls:Ae,showNameModal:Rt,showProgress:Ln,updateUserName:Mn,useDirectConnection:ie,userName:De,userNames:gt,videoQuality:Kt},Symbol.toStringTag,{value:"Module"}));class ln{audioContext=null;sourceNode=null;gainNode=null;filterNode=null;dynamicsCompressor=null;destination=null;originalStream=null;constructor(){}async processStream(e){if(!e||e.getAudioTracks().length===0)return console.warn("No audio tracks to process"),e;try{return this.audioContext=new AudioContext({sampleRate:48e3}),this.originalStream=e,this.sourceNode=this.audioContext.createMediaStreamSource(e),this.filterNode=this.audioContext.createBiquadFilter(),this.filterNode.type="highpass",this.filterNode.frequency.value=200,this.filterNode.Q.value=.7,this.dynamicsCompressor=this.audioContext.createDynamicsCompressor(),this.dynamicsCompressor.threshold.value=-50,this.dynamicsCompressor.knee.value=40,this.dynamicsCompressor.ratio.value=12,this.dynamicsCompressor.attack.value=.003,this.dynamicsCompressor.release.value=.25,this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1.2,this.destination=this.audioContext.createMediaStreamDestination(),this.sourceNode.connect(this.filterNode).connect(this.dynamicsCompressor).connect(this.gainNode).connect(this.destination),console.log("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾"),this.destination.stream}catch(n){return console.error("Failed to process audio stream:",n),e}}cleanup(){try{this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=null),this.filterNode&&(this.filterNode.disconnect(),this.filterNode=null),this.dynamicsCompressor&&(this.dynamicsCompressor.disconnect(),this.dynamicsCompressor=null),this.gainNode&&(this.gainNode.disconnect(),this.gainNode=null),this.destination&&(this.destination.disconnect(),this.destination=null),this.audioContext&&this.audioContext.state!=="closed"&&(this.audioContext.close(),this.audioContext=null),console.log("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾")}catch(e){console.warn("Error during audio processor cleanup:",e)}}isActive(){return this.audioContext!==null&&this.audioContext.state==="running"}}function Os(){const[t,e]=k(null),[n,s]=k(!1),[i,r]=k("medium"),[a,o]=k(null),c={stream:null,track:null,videoEl:null},d=()=>{try{return t()?.getVideoTracks()[0]?.getSettings().facingMode??null}catch{return null}},p=async()=>{const f=t()?.getVideoTracks()[0];if(!f)return!1;const y=f.getCapabilities?.();if(!y||!("torch"in y))return!1;try{return await f.applyConstraints({advanced:[{torch:!0}]}),!0}catch{return!1}},h=async()=>{const f=t()?.getVideoTracks()[0];if(!f)return!1;const y=f.getCapabilities?.();if(!y||!("torch"in y))return!1;try{return await f.applyConstraints({advanced:[{torch:!1}]}),!0}catch{return!1}},b=async()=>{if(c.track&&c.stream)return!0;try{const f=await navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:{exact:"environment"},width:{ideal:160,max:320},height:{ideal:120,max:240},frameRate:{ideal:5,max:10},advanced:[{torch:!1}]}}),y=f.getVideoTracks()[0],g=y.getCapabilities?.();if(!g||!("torch"in g))return f.getTracks().forEach(L=>L.stop()),!1;const v=document.createElement("video");v.muted=!0,v.playsInline=!0,v.setAttribute("playsinline",""),v.style.position="fixed",v.style.width="1px",v.style.height="1px",v.style.opacity="0",v.style.pointerEvents="none",document.body.appendChild(v),v.srcObject=f;try{await v.play()}catch{}return c.stream=f,c.track=y,c.videoEl=v,!0}catch{return!1}},_=async()=>{if(!c.track)return!1;try{return await c.track.applyConstraints({advanced:[{torch:!0}]}),!0}catch{return!1}},A=async()=>{try{await c.track?.applyConstraints?.({advanced:[{torch:!1}]})}catch{}try{c.stream?.getTracks().forEach(f=>f.stop())}catch{}try{c.videoEl?.pause()}catch{}c.videoEl?.parentNode&&c.videoEl.parentNode.removeChild(c.videoEl),c.stream=null,c.track=null,c.videoEl=null},w=f=>{const y=document.querySelector(".video-section"),g=document.querySelector(".wrap");f?(y?.classList.add("flashlight-on"),document.body.classList.add("flashlight-bg"),g?.classList.add("flashlight-bg")):(y?.classList.remove("flashlight-on"),document.body.classList.remove("flashlight-bg"),g?.classList.remove("flashlight-bg"))},C=async()=>{if(!n())return;if(d()==="environment"){let y=await p();y||(y=await b()&&await _()),w(!y)}else await h(),await A(),w(!0)},R=async()=>{if(!!n()){await h(),await A(),w(!1),s(!1);return}s(!0),await C()};async function l(f="medium"){try{const y=1+N().size,g=Kt();let v;g==="auto"?y>=4?v={width:{ideal:480,max:640},height:{ideal:360,max:480},frameRate:{ideal:15,max:20},facingMode:{ideal:"user"}}:y>=3?v={width:{ideal:640,max:800},height:{ideal:480,max:600},frameRate:{ideal:20,max:25},facingMode:{ideal:"user"}}:v={width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30,max:30},facingMode:{ideal:"user"}}:g==="1080p"?v={width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},frameRate:{ideal:30,max:30},facingMode:{ideal:"user"}}:g==="720p"?v={width:{ideal:1280,max:1280},height:{ideal:720,max:720},frameRate:{ideal:30,max:30},facingMode:{ideal:"user"}}:v={width:{ideal:640,max:640},height:{ideal:480,max:480},frameRate:{ideal:15,max:20},facingMode:{ideal:"user"}};let L={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1},video:v};(oe||de)&&(L.video={width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:24,max:30},facingMode:{ideal:"user"}},L.audio={echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}),We&&Y&&(L.video={width:{ideal:640,max:1280},height:{ideal:480,max:720},frameRate:{ideal:15,max:24},facingMode:{ideal:"user"}}),pt&&(L.video={width:{ideal:1280},height:{ideal:720},frameRate:{ideal:30},facingMode:{ideal:"user"}}),An&&(L.video={width:{ideal:1280,max:1920},height:{ideal:720,max:1080},frameRate:{ideal:30},facingMode:{ideal:"user"}}),console.log("Requesting media with platform-specific constraints:",L);let D=await navigator.mediaDevices.getUserMedia(L);if(ut()){const H=new ln;D=await H.processStream(D),o(H),console.log("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¾ Ðº Ð¿Ð¾Ñ‚Ð¾ÐºÑƒ")}return e(D),r(f),ue(null),console.log("Local stream obtained successfully"),D}catch(y){if(console.error("Failed to get local stream:",y),We&&Y)try{console.log("Trying audio-only fallback for Android");const g=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});return e(g),W("ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ (ÐºÐ°Ð¼ÐµÑ€Ð° Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°)"),g}catch(g){console.error("Audio fallback also failed:",g)}throw ue(`ÐÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº ÐºÐ°Ð¼ÐµÑ€Ðµ/Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ñƒ: ${y.name||String(y)}`),e(null),y}}const u=async()=>{try{const y=t()?.getVideoTracks()[0]?.getSettings().facingMode==="environment"?"user":"environment",g=cn[i()]||cn.medium,v=await Cs(y),L=v?{deviceId:{exact:v},width:{ideal:g.width},height:{ideal:g.height},frameRate:{ideal:g.frameRate}}:{facingMode:{ideal:y},width:{ideal:g.width},height:{ideal:g.height},frameRate:{ideal:g.frameRate}},D=await navigator.mediaDevices.getUserMedia({audio:!0,video:L}),H=D.getVideoTracks()[0],ge=D.getAudioTracks()[0];for(const[,j]of N().entries()){const Pe=j.pc.getSenders().find(Oe=>Oe.track&&Oe.track.kind==="video");Pe&&await Pe.replaceTrack(H);const nn=j.pc.getSenders().find(Oe=>Oe.track&&Oe.track.kind==="audio");nn&&ge&&await nn.replaceTrack(ge)}t()?.getTracks().forEach(j=>j.stop()),e(D),await C()}catch(f){W("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼ÐµÑ€Ñƒ"),console.warn(f)}},m=async()=>{try{const f=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0});f.getVideoTracks()[0].onended=()=>S();for(const[,y]of N().entries()){const g=y.pc.getSenders().find(v=>v.track&&v.track.kind==="video");g&&g.replaceTrack(f.getVideoTracks()[0])}ct(f),lt(!0)}catch(f){console.error("Error starting screen share:",f),W("ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ ÑÐºÑ€Ð°Ð½Ð°")}},S=async()=>{try{if(Te()&&(Te().getTracks().forEach(f=>f.stop()),ct(null)),t())for(const[,f]of N().entries()){const y=f.pc.getSenders().find(g=>g.track&&g.track.kind==="video");y&&y.replaceTrack(t().getVideoTracks()[0])}lt(!1)}catch(f){console.error("Error stopping screen share:",f)}},E=()=>{Se()?S():m()},$=async()=>{const f=t();if(!f)return;const y=ut();if(Pn(!y),y){const g=a();g&&(g.cleanup(),o(null));try{const L=(await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1}})).getAudioTracks()[0];for(const[H,ge]of N().entries()){const j=ge.pc.getSenders().find(Pe=>Pe.track&&Pe.track.kind==="audio");j&&L&&await j.replaceTrack(L)}const D=new MediaStream;D.addTrack(L),f.getVideoTracks().forEach(H=>D.addTrack(H)),f.getAudioTracks().forEach(H=>H.stop()),e(D),W("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾")}catch(v){console.error("Failed to get new audio stream:",v),W("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ð¸ ÑˆÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ñ")}}else{const g=new ln,v=await g.processStream(f);o(g);for(const[D,H]of N().entries()){const ge=H.pc.getSenders().find(j=>j.track&&j.track.kind==="audio");ge&&v.getAudioTracks()[0]&&await ge.replaceTrack(v.getAudioTracks()[0])}const L=new MediaStream;v.getAudioTracks().forEach(D=>L.addTrack(D)),f.getVideoTracks().forEach(D=>L.addTrack(D)),e(L),W("ðŸŽ™ï¸ Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾")}};return $e(()=>{A(),w(!1);const f=a();f&&(f.cleanup(),o(null));const y=t();y&&y.getTracks().forEach(v=>{try{v.stop()}catch(L){console.warn("Error stopping track:",L)}});const g=Te();g&&g.getTracks().forEach(v=>{try{v.stop()}catch(L){console.warn("Error stopping screen track:",L)}}),s(!1)}),{localStream:t,setLocalStream:e,getLocalStream:l,swapCamera:u,toggleFlashlight:()=>R(),flashlightEnabled:n,toggleScreenShare:E,getFacing:d,toggleNoiseSuppression:$}}const Bs="modulepreload",Ms=function(t){return"/"+t},dn={},un=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");i=Promise.allSettled(n.map(c=>{if(c=Ms(c),c in dn)return;dn[c]=!0;const d=c.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${p}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Bs,d||(h.as="script"),h.crossOrigin="",h.href=c,o&&h.setAttribute("nonce",o),document.head.appendChild(h),d)return new Promise((b,_)=>{h.addEventListener("load",b),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})},ee=Object.create(null);ee.open="0";ee.close="1";ee.ping="2";ee.pong="3";ee.message="4";ee.upgrade="5";ee.noop="6";const Xe=Object.create(null);Object.keys(ee).forEach(t=>{Xe[ee[t]]=t});const Pt={type:"error",data:"parser error"},Dn=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Fn=typeof ArrayBuffer=="function",Vn=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Yt=({type:t,data:e},n,s)=>Dn&&e instanceof Blob?n?s(e):hn(e,s):Fn&&(e instanceof ArrayBuffer||Vn(e))?n?s(e):hn(new Blob([e]),s):s(ee[t]+(e||"")),hn=(t,e)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];e("b"+(s||""))},n.readAsDataURL(t)};function fn(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let _t;function Ds(t,e){if(Dn&&t.data instanceof Blob)return t.data.arrayBuffer().then(fn).then(e);if(Fn&&(t.data instanceof ArrayBuffer||Vn(t.data)))return e(fn(t.data));Yt(t,!1,n=>{_t||(_t=new TextEncoder),e(_t.encode(n))})}const pn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ve=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<pn.length;t++)Ve[pn.charCodeAt(t)]=t;const Fs=t=>{let e=t.length*.75,n=t.length,s,i=0,r,a,o,c;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const d=new ArrayBuffer(e),p=new Uint8Array(d);for(s=0;s<n;s+=4)r=Ve[t.charCodeAt(s)],a=Ve[t.charCodeAt(s+1)],o=Ve[t.charCodeAt(s+2)],c=Ve[t.charCodeAt(s+3)],p[i++]=r<<2|a>>4,p[i++]=(a&15)<<4|o>>2,p[i++]=(o&3)<<6|c&63;return d},Vs=typeof ArrayBuffer=="function",Jt=(t,e)=>{if(typeof t!="string")return{type:"message",data:Un(t,e)};const n=t.charAt(0);return n==="b"?{type:"message",data:Us(t.substring(1),e)}:Xe[n]?t.length>1?{type:Xe[n],data:t.substring(1)}:{type:Xe[n]}:Pt},Us=(t,e)=>{if(Vs){const n=Fs(t);return Un(n,e)}else return{base64:!0,data:t}},Un=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},qn="",qs=(t,e)=>{const n=t.length,s=new Array(n);let i=0;t.forEach((r,a)=>{Yt(r,!1,o=>{s[a]=o,++i===n&&e(s.join(qn))})})},Is=(t,e)=>{const n=t.split(qn),s=[];for(let i=0;i<n.length;i++){const r=Jt(n[i],e);if(s.push(r),r.type==="error")break}return s};function Gs(){return new TransformStream({transform(t,e){Ds(t,n=>{const s=n.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const r=new DataView(i.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{i=new Uint8Array(9);const r=new DataView(i.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}t.data&&typeof t.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(n)})}})}let bt;function Ke(t){return t.reduce((e,n)=>e+n.length,0)}function je(t,e){if(t[0].length===e)return t.shift();const n=new Uint8Array(e);let s=0;for(let i=0;i<e;i++)n[i]=t[0][s++],s===t[0].length&&(t.shift(),s=0);return t.length&&s<t[0].length&&(t[0]=t[0].slice(s)),n}function Ws(t,e){bt||(bt=new TextDecoder);const n=[];let s=0,i=-1,r=!1;return new TransformStream({transform(a,o){for(n.push(a);;){if(s===0){if(Ke(n)<1)break;const c=je(n,1);r=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(Ke(n)<2)break;const c=je(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(Ke(n)<8)break;const c=je(n,8),d=new DataView(c.buffer,c.byteOffset,c.length),p=d.getUint32(0);if(p>Math.pow(2,21)-1){o.enqueue(Pt);break}i=p*Math.pow(2,32)+d.getUint32(4),s=3}else{if(Ke(n)<i)break;const c=je(n,i);o.enqueue(Jt(r?c:bt.decode(c),e)),s=0}if(i===0||i>t){o.enqueue(Pt);break}}}})}const In=4;function M(t){if(t)return Qs(t)}function Qs(t){for(var e in M.prototype)t[e]=M.prototype[e];return t}M.prototype.on=M.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};M.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this};M.prototype.off=M.prototype.removeListener=M.prototype.removeAllListeners=M.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+t];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var s,i=0;i<n.length;i++)if(s=n[i],s===e||s.fn===e){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+t],this};M.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,i=n.length;s<i;++s)n[s].apply(this,e)}return this};M.prototype.emitReserved=M.prototype.emit;M.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};M.prototype.hasListeners=function(t){return!!this.listeners(t).length};const yt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,n)=>n(e,0),z=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),zs="arraybuffer";function Gn(t,...e){return e.reduce((n,s)=>(t.hasOwnProperty(s)&&(n[s]=t[s]),n),{})}const Hs=z.setTimeout,Ks=z.clearTimeout;function wt(t,e){e.useNativeTimers?(t.setTimeoutFn=Hs.bind(z),t.clearTimeoutFn=Ks.bind(z)):(t.setTimeoutFn=z.setTimeout.bind(z),t.clearTimeoutFn=z.clearTimeout.bind(z))}const js=1.33;function Ys(t){return typeof t=="string"?Js(t):Math.ceil((t.byteLength||t.size)*js)}function Js(t){let e=0,n=0;for(let s=0,i=t.length;s<i;s++)e=t.charCodeAt(s),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(s++,n+=4);return n}function Wn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Xs(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function Zs(t){let e={},n=t.split("&");for(let s=0,i=n.length;s<i;s++){let r=n[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}class ei extends Error{constructor(e,n,s){super(e),this.description=n,this.context=s,this.type="TransportError"}}class Xt extends M{constructor(e){super(),this.writable=!1,wt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,n,s){return super.emitReserved("error",new ei(e,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const n=Jt(e,this.socket.binaryType);this.onPacket(n)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,n={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const n=Xs(e);return n.length?"?"+n:""}}class ti extends Xt{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const n=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};Is(e,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,qs(e,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=Wn()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(e,n)}}let Qn=!1;try{Qn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ni=Qn;function si(){}class ii extends ti{constructor(e){if(super(e),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,n){const s=this.request({method:"POST",data:e});s.on("success",n),s.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=e}}class X extends M{constructor(e,n,s){super(),this.createRequest=e,wt(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;const n=Gn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=X.requestsCount++,X.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=si,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete X.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}X.requestsCount=0;X.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",gn);else if(typeof addEventListener=="function"){const t="onpagehide"in z?"pagehide":"unload";addEventListener(t,gn,!1)}}function gn(){for(let t in X.requests)X.requests.hasOwnProperty(t)&&X.requests[t].abort()}const ri=function(){const t=zn({xdomain:!1});return t&&t.responseType!==null}();class oi extends ii{constructor(e){super(e);const n=e&&e.forceBase64;this.supportsBinary=ri&&!n}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new X(zn,this.uri(),e)}}function zn(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ni))return new XMLHttpRequest}catch{}if(!e)try{return new z[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Hn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ai extends Xt{get name(){return"websocket"}doOpen(){const e=this.uri(),n=this.opts.protocols,s=Hn?{}:Gn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,n,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const s=e[n],i=n===e.length-1;Yt(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch{}i&&yt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=Wn()),this.supportsBinary||(n.b64=1),this.createUri(e,n)}}const St=z.WebSocket||z.MozWebSocket;class ci extends ai{createSocket(e,n,s){return Hn?new St(e,n,s):n?new St(e,n):new St(e)}doWrite(e,n){this.ws.send(n)}}class li extends Xt{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const n=Ws(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(n).getReader(),i=Gs();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const r=()=>{s.read().then(({done:o,value:c})=>{o||(this.onPacket(c),r())}).catch(o=>{})};r();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let n=0;n<e.length;n++){const s=e[n],i=n===e.length-1;this._writer.write(s).then(()=>{i&&yt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const di={websocket:ci,webtransport:li,polling:oi},ui=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,hi=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ot(t){if(t.length>8e3)throw"URI too long";const e=t,n=t.indexOf("["),s=t.indexOf("]");n!=-1&&s!=-1&&(t=t.substring(0,n)+t.substring(n,s).replace(/:/g,";")+t.substring(s,t.length));let i=ui.exec(t||""),r={},a=14;for(;a--;)r[hi[a]]=i[a]||"";return n!=-1&&s!=-1&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=fi(r,r.path),r.queryKey=pi(r,r.query),r}function fi(t,e){const n=/\/{2,9}/g,s=e.replace(n,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function pi(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,r){i&&(n[i]=r)}),n}const Bt=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ze=[];Bt&&addEventListener("offline",()=>{Ze.forEach(t=>t())},!1);class he extends M{constructor(e,n){if(super(),this.binaryType=zs,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(n=e,e=null),e){const s=Ot(e);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=Ot(n.host).host);wt(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Zs(this.opts.query)),Bt&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ze.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const n=Object.assign({},this.opts.query);n.EIO=In,n.transport=e,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&he.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(e);n.open(),this.setTransport(n)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",he.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=e.data,this._onError(n);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(n+=Ys(i)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,yt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,n,s){return this._sendPacket("message",e,n,s),this}send(e,n,s){return this._sendPacket("message",e,n,s),this}_sendPacket(e,n,s,i){if(typeof n=="function"&&(i=n,n=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const r={type:e,data:n,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),e()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(he.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Bt&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=Ze.indexOf(this._offlineEventListener);s!==-1&&Ze.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,n),this.writeBuffer=[],this._prevBufferLen=0}}}he.protocol=In;class gi extends he{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let n=this.createTransport(e),s=!1;he.priorWebsocketSuccess=!1;const i=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",h=>{if(!s)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;he.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(p(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const b=new Error("probe error");b.transport=n.name,this.emitReserved("upgradeError",b)}}))};function r(){s||(s=!0,p(),n.close(),n=null)}const a=h=>{const b=new Error("probe error: "+h);b.transport=n.name,r(),this.emitReserved("upgradeError",b)};function o(){a("transport closed")}function c(){a("socket closed")}function d(h){n&&h.name!==n.name&&r()}const p=()=>{n.removeListener("open",i),n.removeListener("error",a),n.removeListener("close",o),this.off("close",c),this.off("upgrading",d)};n.once("open",i),n.once("error",a),n.once("close",o),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const n=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&n.push(e[s]);return n}}let mi=class extends gi{constructor(e,n={}){const s=typeof e=="object"?e:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>di[i]).filter(i=>!!i)),super(e,s)}};function yi(t,e="",n){let s=t;n=n||typeof location<"u"&&location,t==null&&(t=n.protocol+"//"+n.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=n.protocol+t:t=n.host+t),/^(https?|wss?):\/\//.test(t)||(typeof n<"u"?t=n.protocol+"//"+t:t="https://"+t),s=Ot(t)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(n&&n.port===s.port?"":":"+s.port),s}const wi=typeof ArrayBuffer=="function",vi=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Kn=Object.prototype.toString,_i=typeof Blob=="function"||typeof Blob<"u"&&Kn.call(Blob)==="[object BlobConstructor]",bi=typeof File=="function"||typeof File<"u"&&Kn.call(File)==="[object FileConstructor]";function Zt(t){return wi&&(t instanceof ArrayBuffer||vi(t))||_i&&t instanceof Blob||bi&&t instanceof File}function et(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let n=0,s=t.length;n<s;n++)if(et(t[n]))return!0;return!1}if(Zt(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return et(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&et(t[n]))return!0;return!1}function Si(t){const e=[],n=t.data,s=t;return s.data=Mt(n,e),s.attachments=e.length,{packet:s,buffers:e}}function Mt(t,e){if(!t)return t;if(Zt(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}else if(Array.isArray(t)){const n=new Array(t.length);for(let s=0;s<t.length;s++)n[s]=Mt(t[s],e);return n}else if(typeof t=="object"&&!(t instanceof Date)){const n={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(n[s]=Mt(t[s],e));return n}return t}function Ei(t,e){return t.data=Dt(t.data,e),delete t.attachments,t}function Dt(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=Dt(t[n],e);else if(typeof t=="object")for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=Dt(t[n],e));return t}const ki=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ci=5;var T;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(T||(T={}));class Ti{constructor(e){this.replacer=e}encode(e){return(e.type===T.EVENT||e.type===T.ACK)&&et(e)?this.encodeAsBinary({type:e.type===T.EVENT?T.BINARY_EVENT:T.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let n=""+e.type;return(e.type===T.BINARY_EVENT||e.type===T.BINARY_ACK)&&(n+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(n+=e.nsp+","),e.id!=null&&(n+=e.id),e.data!=null&&(n+=JSON.stringify(e.data,this.replacer)),n}encodeAsBinary(e){const n=Si(e),s=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(s),i}}function mn(t){return Object.prototype.toString.call(t)==="[object Object]"}class en extends M{constructor(e){super(),this.reviver=e}add(e){let n;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(e);const s=n.type===T.BINARY_EVENT;s||n.type===T.BINARY_ACK?(n.type=s?T.EVENT:T.ACK,this.reconstructor=new Ai(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(Zt(e)||e.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(e),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let n=0;const s={type:Number(e.charAt(0))};if(T[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===T.BINARY_EVENT||s.type===T.BINARY_ACK){const r=n+1;for(;e.charAt(++n)!=="-"&&n!=e.length;);const a=e.substring(r,n);if(a!=Number(a)||e.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(e.charAt(n+1)==="/"){const r=n+1;for(;++n&&!(e.charAt(n)===","||n===e.length););s.nsp=e.substring(r,n)}else s.nsp="/";const i=e.charAt(n+1);if(i!==""&&Number(i)==i){const r=n+1;for(;++n;){const a=e.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===e.length)break}s.id=Number(e.substring(r,n+1))}if(e.charAt(++n)){const r=this.tryParse(e.substr(n));if(en.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,n){switch(e){case T.CONNECT:return mn(n);case T.DISCONNECT:return n===void 0;case T.CONNECT_ERROR:return typeof n=="string"||mn(n);case T.EVENT:case T.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&ki.indexOf(n[0])===-1);case T.ACK:case T.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ai{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const n=Ei(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const xi=Object.freeze(Object.defineProperty({__proto__:null,Decoder:en,Encoder:Ti,get PacketType(){return T},protocol:Ci},Symbol.toStringTag,{value:"Module"}));function K(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const $i=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class jn extends M{constructor(e,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[K(e,"open",this.onopen.bind(this)),K(e,"packet",this.onpacket.bind(this)),K(e,"error",this.onerror.bind(this)),K(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...n){var s,i,r;if($i.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(n.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:T.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const p=this.ids++,h=n.pop();this._registerAckCallback(p,h),a.id=p}const o=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!o||(c?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(e,n){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[e]=n;return}const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);n.call(this,new Error("operation has timed out"))},i),a=(...o)=>{this.io.clearTimeoutFn(r),n.apply(this,o)};a.withError=!0,this.acks[e]=a}emitWithAck(e,...n){return new Promise((s,i)=>{const r=(a,o)=>a?i(a):s(o);r.withError=!0,n.push(r),this.emit(e,...n)})}_addToQueue(e){let n;typeof e[e.length-1]=="function"&&(n=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...r)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!e||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:T.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){const s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case T.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case T.EVENT:case T.BINARY_EVENT:this.onevent(e);break;case T.ACK:case T.BINARY_ACK:this.onack(e);break;case T.DISCONNECT:this.ondisconnect();break;case T.CONNECT_ERROR:this.destroy();const s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){const n=e.data||[];e.id!=null&&n.push(this.ack(e.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const n=this;let s=!1;return function(...i){s||(s=!0,n.packet({type:T.ACK,id:e,data:i}))}}onack(e){const n=this.acks[e.id];typeof n=="function"&&(delete this.acks[e.id],n.withError&&e.data.unshift(null),n.apply(this,e.data))}onconnect(e,n){this.id=e,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:T.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(e===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(e===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,e.data)}}}function Ne(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}Ne.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+n:t-n}return Math.min(t,this.max)|0};Ne.prototype.reset=function(){this.attempts=0};Ne.prototype.setMin=function(t){this.ms=t};Ne.prototype.setMax=function(t){this.max=t};Ne.prototype.setJitter=function(t){this.jitter=t};class Ft extends M{constructor(e,n){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(n=e,e=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,wt(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Ne({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=e;const i=n.parser||xi;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var n;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(n=this.backoff)===null||n===void 0||n.setMin(e),this)}randomizationFactor(e){var n;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(n=this.backoff)===null||n===void 0||n.setJitter(e),this)}reconnectionDelayMax(e){var n;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(n=this.backoff)===null||n===void 0||n.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new mi(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=K(n,"open",function(){s.onopen(),e&&e()}),r=o=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",o),e?e(o):this.maybeReconnectOnOpen()},a=K(n,"error",r);if(this._timeout!==!1){const o=this._timeout,c=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),n.close()},o);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(K(e,"ping",this.onping.bind(this)),K(e,"data",this.ondata.bind(this)),K(e,"error",this.onerror.bind(this)),K(e,"close",this.onclose.bind(this)),K(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(n){this.onclose("parse error",n)}}ondecoded(e){yt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,n){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new jn(this,e,n),this.nsps[e]=s),s}_destroy(e){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(e){const n=this.encoder.encode(e);for(let s=0;s<n.length;s++)this.engine.write(n[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Be={};function tt(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const n=yi(t,e.path||"/socket.io"),s=n.source,i=n.id,r=n.path,a=Be[i]&&r in Be[i].nsps,o=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let c;return o?c=new Ft(s,e):(Be[i]||(Be[i]=new Ft(s,e)),c=Be[i]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(tt,{Manager:Ft,Socket:jn,io:tt,connect:tt});let O=null,be=null;function Ri(t,e,n,s){const r=new URLSearchParams(window.location.search).get("signal")||window.location.origin;O=tt(r,{transports:["polling","websocket"],path:"/socket.io",withCredentials:!1,timeout:15e3,reconnection:!0,reconnectionAttempts:1/0,reconnectionDelay:1e3,reconnectionDelayMax:5e3,forceNew:!1,autoConnect:!0,upgrade:!0,rememberUpgrade:!0});function a(){be&&clearInterval(be),be=setInterval(()=>{O?.connected&&O.emit("ping")},1e3)}function o(){be&&(clearInterval(be),be=null)}if(O.on("connect",()=>{ue(null),console.log("Connected to signaling server"),a()}),O.on("disconnect",()=>{xe(!1),console.log("Disconnected from signaling server"),o()}),O.on("connect_error",c=>{ue("Failed to connect to signaling server"),console.error("Connection error:",c)}),O.on("peers-list",({peers:c})=>{console.log("Received peers list:",c),console.log("Our socket ID:",O?.id),c.forEach(d=>{console.log(`Adding peer: ${d}`),e&&e(d)})}),O.on("peer-joined",({socketId:c})=>{console.log("Peer joined:",c),console.log("Our socket ID:",O?.id),e&&e(c)}),O.on("peer-left",({socketId:c})=>{console.log("Peer left:",c),jt(c),n&&n(c)}),O.on("user-name-set",({socketId:c,userName:d})=>{console.log(`User ${c} set name to: ${d}`),Mn(c,d)}),O.on("chat-message",async({author:c,text:d,encrypted:p,iv:h,timestamp:b})=>{const{decryptText:_}=await un(async()=>{const{decryptText:C}=await Promise.resolve().then(()=>Ni);return{decryptText:C}},void 0),A=await un(()=>Promise.resolve().then(()=>Ps),void 0);let w=d||"";if(p&&h&&A.e2eeEnabled()&&A.e2eeKey())try{w=await _(p,h,A.e2eeKey()),console.log(`ðŸ”’ Decrypted chat message from ${c}`)}catch(C){console.error("Failed to decrypt chat message:",C),w="[ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ñ€Ð°ÑÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ]"}else console.log(`Chat message from ${c}: ${w}`);s&&s(c,w,new Date(b))}),O.on("signal",async({from:c,data:d})=>{t&&await t(c,d)}),O.on("pong",()=>{}),Y&&typeof window<"u"){const c=()=>{const d=window.Telegram;if(d&&d.WebApp&&d.WebApp.initDataUnsafe&&d.WebApp.initDataUnsafe.start_param){const p=d.WebApp.initDataUnsafe.start_param;me(p),ae(!1)}};typeof window<"u"&&(window.addEventListener("load",c),setTimeout(c,500))}return $e(()=>{o(),O?.disconnect(),O=null}),{socket:()=>O,emit:(c,d)=>O?.emit(c,d),id:()=>O?.id}}function Q(){return O}async function Yn(){return await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function Jn(t){const e=await crypto.subtle.exportKey("raw",t),n=new Uint8Array(e);return btoa(String.fromCharCode(...n))}async function Xn(t){const e=Uint8Array.from(atob(t),n=>n.charCodeAt(0));return await crypto.subtle.importKey("raw",e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function tn(t,e){const s=new TextEncoder().encode(t),i=crypto.getRandomValues(new Uint8Array(12)),r=await crypto.subtle.encrypt({name:"AES-GCM",iv:i},e,s);return{encrypted:btoa(String.fromCharCode(...new Uint8Array(r))),iv:btoa(String.fromCharCode(...i))}}async function Li(t,e,n){const s=Uint8Array.from(atob(t),o=>o.charCodeAt(0)),i=Uint8Array.from(atob(e),o=>o.charCodeAt(0)),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:i},n,s);return new TextDecoder().decode(r)}class Vt{key;keyMaterial;constructor(e){this.key=e,this.keyMaterial=new Uint8Array(32)}async initialize(){const e=await crypto.subtle.exportKey("raw",this.key);this.keyMaterial=new Uint8Array(e)}async encryptFrame(e){const n=new Uint8Array(e.data),s=crypto.getRandomValues(new Uint8Array(12)),i=await crypto.subtle.encrypt({name:"AES-GCM",iv:s},this.key,n),r=new Uint8Array(s.length+i.byteLength);return r.set(s,0),r.set(new Uint8Array(i),s.length),r.buffer}async decryptFrame(e){const n=new Uint8Array(e),s=n.slice(0,12),i=n.slice(12);try{return await crypto.subtle.decrypt({name:"AES-GCM",iv:s},this.key,i)}catch(r){return console.error("Failed to decrypt frame:",r),new ArrayBuffer(0)}}}async function Zn(t,e){if(!t.transform){console.warn("Insertable Streams API not supported for sender");return}const n=t.createEncodedStreams(),s=new TransformStream({async transform(i,r){try{const a=await e.encryptFrame(i);i.data=a,r.enqueue(i)}catch(a){console.error("Error encrypting frame:",a),r.enqueue(i)}}});n.readable.pipeThrough(s).pipeTo(n.writable).catch(i=>console.error("Sender transform error:",i))}async function es(t,e){if(!t.transform){console.warn("Insertable Streams API not supported for receiver");return}const n=t.createEncodedStreams(),s=new TransformStream({async transform(i,r){try{const a=await e.decryptFrame(i.data);a.byteLength>0&&(i.data=a),r.enqueue(i)}catch(a){console.error("Error decrypting frame:",a),r.enqueue(i)}}});n.readable.pipeThrough(s).pipeTo(n.writable).catch(i=>console.error("Receiver transform error:",i))}const Ni=Object.freeze(Object.defineProperty({__proto__:null,FrameCryptor:Vt,decryptText:Li,encryptText:tn,exportKey:Jn,generateRoomKey:Yn,importKey:Xn,setupReceiverTransform:es,setupSenderTransform:Zn},Symbol.toStringTag,{value:"Module"}));function Pi(t,e){const n=1+N().size,s=ie(),i=ks(n,s);console.log(`Creating peer connection for ${t} with config:`,i),console.log(`Connection mode: ${s?"ðŸ”’ Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ (STUN only)":"ðŸŒ Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€ (STUN + TURN)"}`);const r=new RTCPeerConnection(i),a=new MediaStream;if(r.onicecandidate=o=>{if(o.candidate){const c=o.candidate.type;c==="relay"?console.log(`ðŸ”„ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ TURN ÑÐµÑ€Ð²ÐµÑ€ Ð´Ð»Ñ ${t}`):c==="srflx"?console.log(`âš¡ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ STUN (Ð¿Ñ€ÑÐ¼Ð¾Ðµ Ñ‡ÐµÑ€ÐµÐ· NAT) Ð´Ð»Ñ ${t}`):c==="host"&&console.log(`ðŸ  Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ ${t}`),Q()?.emit("signal",{to:t,data:{candidate:o.candidate}})}},r.ontrack=o=>{a.addTrack(o.track);const c=document.getElementById(`remoteVideo-${t}`);if(c&&c.srcObject!==a&&(c.srcObject=a),o.track&&o.track.kind==="video"){const d=document.querySelector(`#video-${t} .avatar`);d&&d.remove()}o.track&&(o.track.onended=()=>{console.log(`Track ended for ${t}`),setTimeout(()=>{if(ce(t)){const d=Ce(t);d&&d.pc.connectionState==="disconnected"&&Ue(t)}},2e3)})},r.onconnectionstatechange=()=>{console.log(`pc.connectionState with ${t}:`,r.connectionState),r.connectionState==="connecting"?(ke(70),Ee("Connecting...")):r.connectionState==="connected"?(ke(100),Ee("Connected!"),xe(!0),setTimeout(()=>I(!1),1e3)):r.connectionState==="failed"?(console.error(`WebRTC connection failed with ${t} - attempting restart`),I(!1),setTimeout(async()=>{if(ce(t)){console.log(`Attempting to restart connection with ${t}`);try{await Ut(t,2)}catch(o){console.error(`Failed to restart connection with ${t}:`,o),Ue(t)}}},3e3)):r.connectionState==="disconnected"&&(console.warn(`WebRTC connection disconnected with ${t}`),setTimeout(()=>{if(ce(t)){const o=Ce(t);o&&o.pc.connectionState==="disconnected"&&(console.log(`Removing peer ${t} after disconnect timeout`),Ue(t))}},3e3))},r.oniceconnectionstatechange=()=>{if(console.log(`pc.iceConnectionState with ${t}:`,r.iceConnectionState),r.iceConnectionState==="failed"&&(console.error(`ICE connection failed for ${t}`),setTimeout(async()=>{if(ce(t))try{await Ut(t,1)}catch(o){console.error(`Failed to reconnect ${t}:`,o),Ue(t)}},2e3)),r.iceConnectionState==="disconnected"&&console.warn(`ICE disconnected with ${t}, waiting for reconnection...`),r.iceConnectionState==="connected"){const o=Ce(t);o&&o._disconnectTimer&&(clearTimeout(o._disconnectTimer),o._disconnectTimer=null)}},r.onicegatheringstatechange=()=>{console.log(`pc.iceGatheringState with ${t}:`,r.iceGatheringState),r.iceGatheringState==="gathering"?(ke(30),Ee("Gathering ICE candidates...")):r.iceGatheringState==="complete"&&(ke(60),Ee("ICE gathering complete, checking connectivity..."))},e)for(const o of e.getTracks()){const c=r.addTrack(o,e);if(Qe()&&J()){const d=new Vt(J());d.initialize().then(()=>{Zn(c,d).catch(p=>{console.warn("Failed to setup sender E2EE transform:",p)})})}}return Qe()&&J()?r.ontrack=(o=>c=>{o(c);const d=new Vt(J());d.initialize().then(()=>{for(const p of c.receiver?[c.receiver]:r.getReceivers())es(p,d).catch(h=>{console.warn("Failed to setup receiver E2EE transform:",h)})})})(r.ontrack):(r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"})),{pc:r,remoteStream:a}}function Ue(t){const e=Ce(t);if(e){e.qualityInterval&&clearInterval(e.qualityInterval);try{e.pc.close()}catch(n){console.warn("Error closing peer connection:",n)}As(t),Oi(t)}}function Oi(t){const e=document.getElementById(`video-${t}`);e&&e.remove()}async function Bi(t){const e=Ce(t);if(!e){console.log(`Cannot call peer ${t}: peer not found in peers map`);return}console.log(`Calling peer ${t}...`);try{const n=await e.pc.createOffer();await e.pc.setLocalDescription(n),Q()?.emit("signal",{to:t,data:{sdp:e.pc.localDescription}}),console.log(`Offer sent to ${t}`)}catch(n){throw console.error(`Error calling peer ${t}:`,n),n}}async function Ut(t,e=3){let n=0;for(;n<e;)try{await Bi(t),console.log(`Successfully called peer ${t} on attempt ${n+1}`);return}catch(s){if(n++,console.warn(`Failed to call peer ${t} on attempt ${n}:`,s),n<e){const i=Math.pow(2,n)*1e3;console.log(`Retrying in ${i}ms...`),await new Promise(r=>setTimeout(r,i))}}console.error(`Failed to call peer ${t} after ${e} attempts`)}async function Mi(t,e){if(console.log(`Received signal from ${t}:`,e),!ce(t))return console.log(`Adding new peer ${t} from signal`),!1;const n=Ce(t);if(!n)return console.error(`Peer ${t} not found after adding`),!1;if(e.sdp){console.log(`Processing SDP from ${t}:`,e.sdp.type);try{let s=e.sdp;if((oe||de)&&(s.sdp=(s.sdp||"").replace(/a=fmtp:111 profile-level-id=42e01f[\r\n]/g,"")),pt&&(s.sdp=(s.sdp||"").replace(/a=fmtp:111/g,"a=fmtp:111 profile-level-id=42e01f")),await n.pc.setRemoteDescription(new RTCSessionDescription(s)),s.type==="offer"){console.log(`Creating answer for ${t}`);let i={};(oe||de)&&(i.voiceActivityDetection=!1);const r=await n.pc.createAnswer(i);(oe||de)&&(r.sdp=(r.sdp||"").replace(/a=fmtp:111 profile-level-id=42e01f[\r\n]/g,"")),await n.pc.setLocalDescription(r),Q()?.emit("signal",{to:t,data:{sdp:n.pc.localDescription}}),console.log(`Answer sent to ${t}`)}}catch(s){if(console.error(`Error processing SDP from ${t}:`,s),s.name==="InvalidStateError"&&s.message.includes("stable"))return console.log(`Skipping duplicate SDP from ${t}`),!1;throw s}}else if(e.candidate)try{await n.pc.addIceCandidate(new RTCIceCandidate(e.candidate)),console.log(`ICE candidate added for ${t}`)}catch(s){console.warn(`Failed to add ICE candidate for ${t}:`,s)}return!0}function Di(t){const e=document.createElement("div");e.className="video-container remote-video",e.id=`video-${t}`;const n=document.createElement("video");n.autoplay=!0,n.playsInline=!0,n.id=`remoteVideo-${t}`,e.appendChild(n);const s=document.createElement("button");s.className="pip-button",s.title="Picture-in-Picture",s.textContent="ðŸ“º",s.onclick=async()=>{try{document.pictureInPictureElement?await document.exitPictureInPicture():await n.requestPictureInPicture()}catch(a){console.error("PiP error:",a)}},e.appendChild(s);const i=document.createElement("div");i.className="avatar";const r=gt().get(t)||"â€¢";return i.textContent=r.charAt(0).toUpperCase(),e.appendChild(i),e}const[yn,Fi]=k(0);function Ye(){Fi(t=>t+1)}function Vi(t){const e=le(()=>{yn();const s=t();if(!s)return!1;const i=s.getAudioTracks();return i.length>0&&i.every(r=>r.enabled)}),n=le(()=>{yn();const s=t();if(!s)return!1;const i=s.getVideoTracks();return i.length>0&&i.every(r=>r.enabled)});return{isAudioEnabled:e,isVideoEnabled:n}}var Ui=P('<div class=video-section><div class=videos-grid id=videosGrid><div class="video-container local-video"><div class=video-label><div class=mic-status id=localMicStatus>');let Et=null,Me=null;function ts(t){const e=getComputedStyle(t),n=parseFloat(e.gap||"12"),s=parseFloat(e.paddingLeft||"16"),i=parseFloat(e.paddingRight||"16"),r=parseFloat(e.paddingTop||"16"),a=parseFloat(e.paddingBottom||"16"),o=t.clientWidth-s-i-n,c=t.clientHeight-r-a-n,d=Math.max(80,Math.floor(Math.min(o/2,c/2)));t.style.setProperty("--tile-size",d+"px")}function wn(){Et&&clearTimeout(Et),Et=setTimeout(()=>{const t=document.getElementById("videosGrid");t&&requestAnimationFrame(()=>{t.className="videos-grid";const e=t.querySelector(".video-container.local-video");if(e){e.classList.remove("placeholder");const r=e.querySelector("#localAvatar");r&&r.remove()}const n=t.querySelectorAll(".video-container:not(.placeholder)").length,s=t.querySelectorAll(".video-container.placeholder").length,i=Math.max(0,4-n);if(console.log("[updateVideoGridLayout] Real tiles:",n),console.log("[updateVideoGridLayout] Current placeholders:",s),console.log("[updateVideoGridLayout] Target placeholders:",i),s>i){const r=t.querySelectorAll(".video-container.placeholder"),a=s-i;console.log("[updateVideoGridLayout] Removing",a,"placeholders");for(let o=0;o<a;o++)r[o]&&r[o].remove()}if(s<i){const r=document.createDocumentFragment(),a=i-s;console.log("[updateVideoGridLayout] Adding",a,"placeholders");for(let o=0;o<a;o++){const c=document.createElement("div");c.className="video-container placeholder",r.appendChild(c)}t.appendChild(r)}ts(t)})},100)}function qi(t){let e,n;const s=le(()=>{const i=t.localStream();if(!i)return!1;const r=i.getAudioTracks();return r.length>0&&r.every(a=>a.enabled)});return se(()=>{Ct(),wn()}),se(()=>{const i=document.getElementById("localMicStatus");i&&(i.className=`mic-status ${s()?"":"muted"}`)}),se(()=>{const i=t.localStream();if(n){let r=n.querySelector("#localVideo");r||(r=document.createElement("video"),r.id="localVideo",r.autoplay=!0,r.playsInline=!0,r.setAttribute("playsinline",""),r.muted=!0,n.appendChild(r)),i&&r.srcObject!==i&&(r.srcObject=i,r.play().catch(a=>console.warn("Local video play failed:",a)))}}),se(()=>{const i=Ct();console.log("[VideoGrid] Peers changed:",i),i.forEach(c=>{if(document.getElementById(`video-${c}`))console.log("[VideoGrid] Video element already exists for peer:",c);else{const p=Di(c),h=e.querySelector(".video-container.placeholder");h?(e.insertBefore(p,h),console.log("[VideoGrid] Inserted video element before placeholders for peer:",c)):(e.appendChild(p),console.log("[VideoGrid] Appended video element for peer:",c))}});const r=e.querySelectorAll(".video-container"),a=e.querySelectorAll(".video-container:not(.placeholder)"),o=e.querySelectorAll(".video-container.placeholder");console.log("[VideoGrid] Total containers:",r.length),console.log("[VideoGrid] Real videos:",a.length),console.log("[VideoGrid] Placeholders:",o.length),console.log("[VideoGrid] Grid computed style:",window.getComputedStyle(e).gridTemplateColumns),r.forEach((c,d)=>{console.log(`[VideoGrid] Container ${d}:`,c.className,c.id)}),wn()}),ft(()=>{typeof window<"u"&&e&&(Me=new ResizeObserver(()=>{e&&ts(e)}),Me.observe(e),$e(()=>{Me&&(Me.disconnect(),Me=null)}))}),(()=>{var i=Ui(),r=i.firstChild,a=r.firstChild,o=e;typeof o=="function"?we(o,r):e=r;var c=n;return typeof c=="function"?we(c,a):n=a,i})()}var Ii=P("<button class=settings-pill><span class=icon>ðŸ“¹</span><span>"),Gi=P('<button class="settings-pill back-button"><span class=icon>â†</span><span>ÐÐ°Ð·Ð°Ð´'),Wi=P("<button><span class=icon></span><span>");function Qi(t){const e=[{value:"1080p",label:"1080p",icon:"ðŸŽ¬"},{value:"720p",label:"720p",icon:"ðŸ“¹"},{value:"480p",label:"480p",icon:"ðŸ“±"},{value:"auto",label:"ÐÐ²Ñ‚Ð¾",icon:"âš¡"}],n=()=>{const r=e.find(a=>a.value===t.currentQuality());return r?`${r.label}`:"ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾"},s=(r,a)=>{r.stopPropagation(),t.onQualityChange(a)},i=r=>{console.log("VideoQuality: handleToggle clicked"),r.stopPropagation(),r.preventDefault(),t.onToggleQualityMenu()};return qe(()=>qe(()=>!t.showQualityMenu())()?(()=>{var r=Ii(),a=r.firstChild,o=a.nextSibling;return r.$$click=i,x(o,n),r})():[qe(()=>e.map(r=>(()=>{var a=Wi(),o=a.firstChild,c=o.nextSibling;return a.$$click=d=>s(d,r.value),x(o,()=>r.icon),x(c,()=>r.label),G(()=>ne(a,`settings-pill quality-option ${t.currentQuality()===r.value?"active":""}`)),a})())),(()=>{var r=Gi();return r.$$click=i,r})()])}Le(["click"]);var zi=P('<button id=transBtn><img src=/icon/screen_share_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt="Screen Share"width=20 height=20><span>'),Hi=P("<button id=flashlightToggle><img src=/icon/flashlight_on_24dp_345D2F_FILL0_wght400_GRAD0_opsz24.svg alt=Flashlight width=20 height=20><span>"),Ki=P('<button class=settings-pill id=swapCameraBtn><img src=/icon/cameraswitch_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt="Swap Camera"width=20 height=20><span>Swap'),ji=P("<button><span class=icon>ðŸŽ™ï¸</span><span>Ð¨ÑƒÐ¼Ð¾Ð¿Ð¾Ð´Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ"),Yi=P('<div class=call-controls id=callControls><div class=control-group><button id=toggleMic title=Mic><img src=/icon/mic_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Mic width=24 height=24></button><button id=toggleCam title=Video><img src=/icon/videocam_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Video width=24 height=24></button><div class=settings-fab-wrap><button class="control-btn round settings"id=settingsBtn title=Settings><img src=/icon/settings_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Settings width=24 height=24></button><div class=settings-submenu id=settingsSubmenu></div></div><button class="control-btn round copy-link"id=copyLinkBtn title=Share><img src=/icon/share_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Share width=24 height=24></button></div><div class=hangup-wrap><button class="control-btn leave"id=hangupBtn title=Leave><img src=/icon/call_end_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg alt=Leave width=32 height=32>');function Ji(t){const e=Vi(t.localStream),[n,s]=k(!1),[i,r]=k(!1);let a,o,c;const d=()=>{a&&(a.classList.remove("hiding"),a.classList.add("show"),s(!0))},p=()=>{if(!a||!a.classList.contains("show"))return;a.classList.remove("show"),a.classList.add("hiding");const _=()=>{a&&(a.classList.remove("hiding"),a.removeEventListener("animationend",_),s(!1))};a.addEventListener("animationend",_,{once:!0})},h=()=>{n()?(p(),r(!1)):d()},b=()=>{console.log("Controls: toggleQualityMenu called, current state:",i()),r(!i())};return se(()=>{if(o){const _=o.querySelector("span");_&&(_.textContent=t.flashlightEnabled?"OFF":"ON"),t.flashlightEnabled?o.classList.add("active"):o.classList.remove("active")}}),se(()=>{if(c){const _=c.querySelector("span");_&&(_.textContent=Se()?"Stop":"Trans"),Se()?c.classList.add("active"):c.classList.remove("active")}}),ft(()=>{const _=A=>{const w=A.target,C=document.getElementById("settingsBtn");if(w.closest(".settings-pill")?.textContent?.includes("ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾")||w.closest(".settings-pill")?.textContent?.includes("1080p")||w.closest(".settings-pill")?.textContent?.includes("720p")||w.closest(".settings-pill")?.textContent?.includes("480p")||w.closest(".settings-pill")?.textContent?.includes("ÐÐ²Ñ‚Ð¾")||w.closest(".settings-pill")?.textContent?.includes("ÐÐ°Ð·Ð°Ð´")){console.log("Controls: Click on quality button, ignoring");return}!(a?.contains(w)||C?.contains(w))&&n()&&(console.log("Controls: Click outside, closing menu"),p(),r(!1))};document.addEventListener("click",_),$e(()=>document.removeEventListener("click",_))}),V(Z,{get when(){return Ae()},get children(){var _=Yi(),A=_.firstChild,w=A.firstChild,C=w.nextSibling,R=C.nextSibling,l=R.firstChild,u=l.nextSibling,m=R.nextSibling,S=A.nextSibling,E=S.firstChild;te(w,"click",t.onToggleMic),te(C,"click",t.onToggleCam),l.$$click=h;var $=a;return typeof $=="function"?we($,u):a=u,x(u,V(Z,{get when(){return!i()},get children(){return[(()=>{var f=zi(),y=f.firstChild,g=y.nextSibling;te(f,"click",t.onToggleScreenShare);var v=c;return typeof v=="function"?we(v,f):c=f,x(g,()=>Se()?"Stop":"Trans"),G(()=>ne(f,`settings-pill ${Se()?"active":""}`)),f})(),(()=>{var f=Hi(),y=f.firstChild,g=y.nextSibling;te(f,"click",t.onToggleFlashlight);var v=o;return typeof v=="function"?we(v,f):o=f,x(g,()=>t.flashlightEnabled?"OFF":"ON"),G(()=>ne(f,`settings-pill ${t.flashlightEnabled?"active":""}`)),f})(),(()=>{var f=Ki();return te(f,"click",t.onSwapCamera),f})(),(()=>{var f=ji();return te(f,"click",t.onToggleNoiseSuppression),G(()=>ne(f,`settings-pill ${ut()?"active":""}`)),f})()]}}),null),x(u,V(Qi,{get onQualityChange(){return t.onQualityChange},currentQuality:()=>Kt(),showQualityMenu:i,onToggleQualityMenu:b}),null),te(m,"click",t.onCopyLink),te(E,"click",t.onHangup),G(f=>{var y=`control-btn round mic primary ${e.isAudioEnabled()?"enabled":""}`,g=`control-btn round video ${e.isVideoEnabled()?"enabled":""}`;return y!==f.e&&ne(w,f.e=y),g!==f.t&&ne(C,f.t=g),f},{e:void 0,t:void 0}),_}})}Le(["click"]);var Xi=P('<div class=chat-section id=chatSection><div class=chat-header><div class=chat-title>Chat</div></div><div class=chat-messages id=chatMessages></div><div class=chat-input-container><input type=text id=chatInput placeholder="ÐÐ°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ..."maxlength=500><button class=chat-send-btn id=chatSendBtn><svg width=16 height=16 viewBox="0 0 24 24"fill=currentColor><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z">'),Zi=P("<div><div class=chat-message-author></div><div class=chat-message-text></div><div class=chat-message-time>");function er(){const[t,e]=k("");let n,s=null;se(()=>{at(),s&&clearTimeout(s),s=setTimeout(()=>{n&&requestAnimationFrame(()=>{n.scrollTop=n.scrollHeight})},10)});const i=async()=>{const r=t().trim();if(!r)return;if(!De()&&!ye){Ie(()=>{zt(r),Ht(!0)});return}const a=Q();if(Qe()&&J())try{const{encrypted:o,iv:c}=await tn(r,J());a?.emit("chat-message",{author:De(),encrypted:o,iv:c,timestamp:new Date})}catch(o){console.error("Failed to encrypt message:",o);return}else a?.emit("chat-message",{author:De(),text:r,timestamp:new Date});Ie(()=>{mt(De(),r,!0),e("")})};return V(Z,{get when(){return $n()&&!ye},get children(){var r=Xi(),a=r.firstChild,o=a.nextSibling,c=o.nextSibling,d=c.firstChild,p=d.nextSibling,h=n;return typeof h=="function"?we(h,o):n=o,x(o,V(fs,{get each(){return at()},children:b=>(()=>{var _=Zi(),A=_.firstChild,w=A.nextSibling,C=w.nextSibling;return x(A,()=>b.author),x(w,()=>b.text),x(C,()=>Bn(b.timestamp)),G(()=>ne(_,`chat-message ${b.isOwn?"own":"other"}`)),_})()})),d.addEventListener("keypress",b=>b.key==="Enter"&&i()),d.$$input=b=>e(b.currentTarget.value),p.$$click=i,G(()=>d.value=t()),r}})}Le(["input","click"]);var tr=P('<div class=name-modal id=nameModal style=display:flex><div class=name-modal-content><h3>ÐšÐ°Ðº Ð²Ð°Ñ Ð·Ð¾Ð²ÑƒÑ‚?</h3><p>Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¸Ð¼Ñ Ð´Ð»Ñ ÑƒÑ‡Ð°ÑÑ‚Ð¸Ñ Ð² Ñ‡Ð°Ñ‚Ðµ</p><input type=text id=userNameInput placeholder="Ð’Ð°ÑˆÐµ Ð¸Ð¼Ñ"maxlength=20><div class=name-modal-buttons><button class=btn-primary id=confirmNameBtn>ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð¸Ñ‚ÑŒ');function nr(){const[t,e]=k("");let n;ft(()=>{Rt()&&n&&setTimeout(()=>{n.focus(),n.select()},100)});const s=async()=>{const i=t().trim();if(i.length<2){W("Ð˜Ð¼Ñ Ð´Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 2 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð°");return}if(i.length>20){W("Ð˜Ð¼Ñ Ð½Ðµ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ 20 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²");return}Gt(i),Ht(!1);const r=Q();r?.emit("set-user-name",{userName:i});const a=Rn();if(a&&a.trim()){if(Qe()&&J())try{const{encrypted:o,iv:c}=await tn(a,J());r?.emit("chat-message",{author:i,encrypted:o,iv:c,timestamp:new Date})}catch(o){console.error("Failed to encrypt pending message:",o);return}else r?.emit("chat-message",{author:i,text:a,timestamp:new Date});mt(i,a,!0),zt(null)}e("")};return V(Z,{get when(){return Rt()},get children(){var i=tr(),r=i.firstChild,a=r.firstChild,o=a.nextSibling,c=o.nextSibling,d=c.nextSibling,p=d.firstChild,h=n;return typeof h=="function"?we(h,c):n=c,c.addEventListener("keypress",b=>b.key==="Enter"&&s()),c.$$input=b=>e(b.currentTarget.value),p.$$click=s,G(()=>c.value=t()),i}})}Le(["input","click"]);var sr=P("<div>"),ir=P("<div class=preloader id=preloader><div class=logo>Adeita Vichat</div><div class=spinner>");function rr(){return V(Z,{get when(){return Ln()},get children(){var t=ir(),e=t.firstChild;return e.nextSibling,x(t,V(Z,{get when(){return xt()},get children(){var n=sr();return x(n,()=>xt()),n}}),null),t}})}var or=P('<div class="status-bar-item e2ee-status"><span class=status-icon>ðŸ”’</span><span class=status-text>Ð—Ð°ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¾'),ar=P("<div class=status-bar-divider>"),cr=P('<div class="status-bar-item ping-status"><span class=status-icon>ðŸ“¶</span><span class=status-text>ms'),lr=P("<div class=status-bar>"),dr=P('<div class="status-bar-item connection-type"><span class=status-text></span><button><div><span class=toggle-icon-mini>');function ur(){const[t,e]=k("unknown"),[n,s]=k(0),[i,r]=k(0);let a=null;const o=async()=>{const b=N();if(b.size===0){e("unknown"),s(0),r(0);return}let _=0,A=0,w=0;for(const[C,R]of b.entries())try{(await R.pc.getStats()).forEach(u=>{if(u.type==="candidate-pair"&&u.state==="succeeded"&&u.currentRoundTripTime&&(_+=u.currentRoundTripTime*1e3,w++),u.type==="inbound-rtp"&&u.kind==="video"&&u.packetsLost&&u.packetsReceived){const m=u.packetsLost/(u.packetsLost+u.packetsReceived)*100;A+=m}})}catch(l){console.warn(`Failed to get stats for peer ${C}:`,l)}if(w>0){const C=Math.round(_/w),R=A/b.size;s(C),r(Math.round(R)),C<100&&R<2?e("excellent"):C<200&&R<5?e("good"):e("poor")}};se(()=>{a=setInterval(o,2e3),$e(()=>{a&&clearInterval(a)})});const c=()=>{switch(t()){case"excellent":return"#16a34a";case"good":return"#d97706";case"poor":return"#dc2626";default:return"#8a8a8a"}},d=()=>{U()&&Ae()||dt(!ie())},p=()=>U()&&Ae(),h=()=>U()&&Ae();return(()=>{var b=lr();return x(b,V(Z,{get when(){return h()},get children(){return[or(),ar()]}}),null),x(b,V(Z,{get when(){return N().size>0},get fallback(){return(()=>{var _=dr(),A=_.firstChild,w=A.nextSibling,C=w.firstChild,R=C.firstChild;return x(A,()=>ie()?"Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ":"Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€"),w.$$click=d,x(R,()=>ie()?"ðŸ”’":"ðŸŒ"),G(l=>{var u=`connection-toggle-mini ${p()?"locked":""}`,m=p(),S=p()?"ÐÐµÐ»ÑŒÐ·Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²Ð¾ Ð²Ñ€ÐµÐ¼Ñ Ð·Ð²Ð¾Ð½ÐºÐ°":"ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ",E=`toggle-slider-mini ${ie()?"direct":""}`;return u!==l.e&&ne(w,l.e=u),m!==l.t&&(w.disabled=l.t=m),S!==l.a&&Tn(w,"title",l.a=S),E!==l.o&&ne(C,l.o=E),l},{e:void 0,t:void 0,a:void 0,o:void 0}),_})()},get children(){var _=cr(),A=_.firstChild,w=A.nextSibling,C=w.firstChild;return x(w,n,C),x(w,(()=>{var R=qe(()=>i()>0);return()=>R()&&` â€¢ ${i()}%`})(),null),G(R=>{var l=c(),u=c();return l!==R.e&&on(A,"color",R.e=l),u!==R.t&&on(w,"color",R.t=u),R},{e:void 0,t:void 0}),_}}),null),b})()}Le(["click"]);var hr=P("<div id=errors><div class=errors>"),fr=P("<div class=call-button-container id=callButtonContainer><button class=call-button id=callButton><img src=/icon/connect_without_contact_24dp_FFFFFF_FILL0_wght400_GRAD0_opsz24.svg alt=Connected width=24 height=24><span>"),pr=P('<div class=wrap><header style="display:none !important"><div class=logo><div class=room-title></div><div class=participants-count> participant</div></div></header><div class=main-content><div class=participants-section id=participantsSection>');function gr(){const t=Os();let e=!0;const n=async()=>{const l=new URLSearchParams(window.location.search),u=l.get("room"),m=l.get("direct"),S=l.get("key");let E=l.get("tgWebAppStartParam")||l.get("startapp");if(Y&&typeof window<"u"&&window.Telegram?.WebApp){const $=window.Telegram.WebApp;$.initDataUnsafe&&$.initDataUnsafe.start_param&&(E=$.initDataUnsafe.start_param)}if(ye&&At(!1),m==="1"||m==="true"?(dt(!0),console.log("ðŸ”’ Ð¢Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð· URL: Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ (P2P)")):(m==="0"||m==="false")&&(dt(!1),console.log("ðŸŒ Ð¢Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð¸Ð· URL: Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€")),S)try{const $=await Xn(S);Lt($),Nt(S),console.log("ðŸ”’ E2EE ÐºÐ»ÑŽÑ‡ Ð¸Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð¸Ð· URL")}catch($){console.error("Failed to import E2EE key from URL:",$)}E?(me(E),ae(!1),setTimeout(()=>s(),100)):u?(me(u),ae(!1)):ae(!0)},s=async()=>{try{console.log(`Joining existing room: ${U()}`),I(!0);try{await t.getLocalStream()}catch(u){console.warn("Failed to get local stream, continuing without it:",u)}Q()?.emit("join",U()),xe(!0),setTimeout(()=>I(!1),3e3)}catch(l){console.error("Failed to join existing room:",l),ue(`Failed to join room: ${l.message}`),I(!1)}},i=async()=>{const l=On();if(me(l),ae(!0),!J())try{const E=await Yn(),$=await Jn(E);Lt(E),Nt($),console.log("ðŸ”’ E2EE ÐºÐ»ÑŽÑ‡ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ð´Ð»Ñ Ð½Ð¾Ð²Ð¾Ð¹ ÐºÐ¾Ð¼Ð½Ð°Ñ‚Ñ‹")}catch(E){console.error("Failed to generate E2EE key:",E)}const u=ie()?"&direct=1":"",m=Fe()?`&key=${Fe()}`:"",S=`${window.location.origin}${window.location.pathname}?room=${l}${u}${m}`;window.history.pushState({room:l},"",S),console.log("ðŸ“ URL Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½:",S);try{console.log(`Creating new room: ${l}`),I(!0),await t.getLocalStream(),Q()?.emit("join",l),xe(!0),setTimeout(()=>I(!1),2e3)}catch(E){console.error("Failed to create room:",E),ue(`Failed to create room: ${E.message}`),I(!1)}},r=async()=>{const l=1+N().size;if(t.localStream()&&l>=3)try{console.log(`Updating video quality for ${l} participants`);const u=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1},video:l>=4?{width:{ideal:480,max:640},height:{ideal:360,max:480},frameRate:{ideal:15,max:20},facingMode:{ideal:"user"}}:{width:{ideal:640,max:800},height:{ideal:480,max:600},frameRate:{ideal:20,max:25},facingMode:{ideal:"user"}}});for(const[E,$]of N().entries()){const f=$.pc.getSenders().find(g=>g.track&&g.track.kind==="video"),y=$.pc.getSenders().find(g=>g.track&&g.track.kind==="audio");f&&u.getVideoTracks()[0]&&await f.replaceTrack(u.getVideoTracks()[0]),y&&u.getAudioTracks()[0]&&await y.replaceTrack(u.getAudioTracks()[0])}const m=t.localStream();m&&m.getTracks().forEach(E=>E.stop()),t.setLocalStream(u);const S=document.getElementById("localVideo");S&&(S.srcObject=u,S.play().catch(E=>console.warn("Play failed:",E))),console.log(`Video quality updated for ${l} participants`)}catch(u){console.warn("Failed to update video quality:",u)}},a=async l=>{if(ce(l)){console.log(`[App] Peer ${l} already exists, skipping`);return}console.log(`[App] Adding peer ${l}`),I(!0),ke(10),Ee("Creating connection...");const u=Pi(l,t.localStream()||null);Ts(l,u),console.log(`[App] Peer ${l} added to store`),await r()};Ri(async(l,u)=>{ce(l)||(console.log(`Adding new peer ${l} from signal`),a(l)),await Mi(l,u)},l=>{console.log(`[App] onPeerJoined called for: ${l}`);const u=Q();console.log(`[App] Our socket ID: ${u?.id}`),console.log("[App] Current peers:",Ct()),a(l),setTimeout(async()=>{const m=Q(),S=m?.id&&m.id<l;console.log(`[App] Should we call ${l}? ${S} (our ID: ${m?.id})`),ce(l)&&S?(console.log(`[App] Calling new peer ${l}`),await Ut(l)):console.log(`[App] Waiting for peer ${l} to call us`)},1e3)},l=>{Ue(l)},(l,u,m)=>{mt(l,u,!1)});const h=async()=>{const l=ie()?"&direct=1":"",u=Fe()?`&key=${Fe()}`:"",m=`${window.location.origin}${window.location.pathname}?room=${U()}${l}${u}`,S=`https://t.me/AdeitaBot/Adeita_Vichat?startapp=${U()}${l}${u}`,$=`ÐŸÑ€Ð¸Ð²ÐµÑ‚! ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐ°ÑŽ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ðº Ð·Ð²Ð¾Ð½ÐºÑƒ

Ð¢Ð¸Ð¿ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ: ${ie()?"ðŸ”’ Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ (P2P)":"ðŸŒ Ð§ÐµÑ€ÐµÐ· ÑÐµÑ€Ð²ÐµÑ€"}
ðŸ”’ Ð¡ÐºÐ²Ð¾Ð·Ð½Ð¾Ðµ ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¾

Ð¢Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ ÑÑ‚Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ Ð»Ð¸Ð±Ð¾:

â€” Ð§ÐµÑ€ÐµÐ· Telegram Mini App: ${S}

â€” Ð§ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚: ${m}

ðŸ˜¿Ð•ÑÐ»Ð¸ Telegram Mini App Ð½Ðµ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ÑÑ Ñ‚Ñ‹ Ð¼Ð¾Ð¶ÐµÑˆÑŒ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ· ÑÐ°Ð¹Ñ‚`;if(Y&&typeof window<"u"&&window.Telegram?.WebApp)window.Telegram.WebApp.sendData($),window.Telegram.WebApp.close();else try{await navigator.clipboard.writeText($),W("Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾")}catch{const y=document.createElement("textarea");y.value=$,document.body.appendChild(y),y.select(),document.execCommand("copy"),document.body.removeChild(y),W("Ð¡ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾")}},b=()=>{I(!0);const l=Q();U()&&l?.emit("leave",U()),oe||de?(t.localStream()&&(t.localStream().getAudioTracks().forEach(u=>{u.stop(),u.enabled=!1}),t.localStream().getVideoTracks().forEach(u=>{u.stop(),u.enabled=!1})),setTimeout(()=>_(),500)):_()},_=()=>{for(const[u,m]of N().entries())m.pc.getSenders().forEach(S=>S.track?.stop()),m.pc.close();xs(),jt(""),me(""),ae(!1),Gt(""),Qt([]),lt(!1),t.localStream()&&t.localStream().getTracks().forEach(u=>u.stop());const l=document.getElementById("localVideo");l&&(l.srcObject=null,l.pause()),Te()&&(Te().getTracks().forEach(u=>u.stop()),ct(null));try{document.querySelector(".video-section")?.classList.remove("flashlight-on"),document.body.classList.remove("flashlight-bg"),document.querySelector(".wrap")?.classList.remove("flashlight-bg")}catch(u){console.warn("Failed to cleanup flashlight:",u)}xe(!1),ue(null),I(!1),(oe||de)&&W("Ð—Ð²Ð¾Ð½Ð¾Ðº Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½. ÐœÐ¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ Ð¾ÑÐ²Ð¾Ð±Ð¾Ð¶Ð´ÐµÐ½.")},A=async()=>{if(!t.localStream()){try{if(await t.getLocalStream(),t.localStream())for(const[m,S]of N().entries()){const E=S.pc.getSenders().find($=>$.track&&$.track.kind==="audio");E&&t.localStream().getAudioTracks()[0]&&await E.replaceTrack(t.localStream().getAudioTracks()[0])}Ye()}catch(m){console.error("Failed to get stream:",m)}return}const l=t.localStream().getAudioTracks(),u=l.some(m=>m.enabled);for(const m of l)m.enabled=!u;Ye()},w=async()=>{if(!t.localStream()){try{if(await t.getLocalStream(),t.localStream())for(const[m,S]of N().entries()){const E=S.pc.getSenders().find($=>$.track&&$.track.kind==="video");E&&t.localStream().getVideoTracks()[0]&&await E.replaceTrack(t.localStream().getVideoTracks()[0])}Ye()}catch(m){console.error("Failed to get stream:",m)}return}const l=t.localStream().getVideoTracks(),u=l.some(m=>m.enabled);for(const m of l)m.enabled=!u;Ye()},C=async l=>{if(e&&!t.localStream()){e=!1,console.log(`${l} detected, attempting to get camera access`);try{await t.getLocalStream(),W("ÐšÐ°Ð¼ÐµÑ€Ð° Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð°")}catch(u){console.warn(`Failed to get camera on ${l}:`,u)}}},R=async l=>{if(Nn(l),W(`ÐšÐ°Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð²Ð¸Ð´ÐµÐ¾: ${l}`),t.localStream())try{await t.getLocalStream();for(const[u,m]of N().entries()){const S=m.pc.getSenders().find(E=>E.track&&E.track.kind==="video");S&&t.localStream().getVideoTracks()[0]&&await S.replaceTrack(t.localStream().getVideoTracks()[0])}}catch(u){console.error("Failed to change video quality:",u)}};return ft(()=>{if(n(),I(!0),ye&&At(!1),setTimeout(()=>{I(!1),document.body.classList.add("loaded")},100),Y&&typeof window<"u"&&window.Telegram?.WebApp){const l=()=>{const u=window.Telegram.WebApp;if(u.initDataUnsafe&&u.initDataUnsafe.start_param){const m=u.initDataUnsafe.start_param;me(m),ae(!1),setTimeout(()=>s(),200)}};window.addEventListener("load",l),setTimeout(l,500)}Y&&(ye&&document.addEventListener("touchstart",()=>C("touch"),{once:!0}),document.querySelectorAll("button").forEach(u=>{u.addEventListener("click",()=>C("button click"),{once:!0})}),oe&&document.addEventListener("visibilitychange",async()=>{!document.hidden&&!t.localStream()&&setTimeout(()=>C("visibility change"),100)}),We&&window.addEventListener("focus",()=>C("window focus"))),window.addEventListener("beforeunload",()=>{const l=Q();U()&&l?.connected&&l.emit("leave",U())}),document.addEventListener("visibilitychange",()=>{if(document.hidden&&U()){const l=Q();l?.connected&&l.emit("ping")}})}),[V(rr,{}),(()=>{var l=pr(),u=l.firstChild,m=u.firstChild,S=m.firstChild,E=S.nextSibling,$=E.firstChild,f=u.nextSibling,y=f.firstChild;return x(S,(()=>{var g=qe(()=>!!U());return()=>g()?`Room ${U()}`:"Adeita Vichat"})()),x(E,()=>1+N().size,$),x(E,()=>1+N().size!==1?"s":"",null),x(f,V(ur,{}),y),x(f,V(qi,{get localStream(){return t.localStream}}),y),x(y,V(er,{})),x(l,V(Z,{get when(){return $t()},get children(){var g=hr(),v=g.firstChild;return x(v,()=>$t()),g}}),null),x(l,V(nr,{}),null),x(l,V(Z,{get when(){return!Ae()},get children(){var g=fr(),v=g.firstChild,L=v.firstChild,D=L.nextSibling;return te(v,"click",U()&&!Tt()?s:i),x(D,()=>U()&&!Tt()?"Join call":"Start a call"),g}}),null),x(l,V(Ji,{onToggleMic:A,onToggleCam:w,get onToggleFlashlight(){return t.toggleFlashlight},get onSwapCamera(){return t.swapCamera},get onToggleScreenShare(){return t.toggleScreenShare},onCopyLink:h,onHangup:b,get flashlightEnabled(){return t.flashlightEnabled()},get localStream(){return t.localStream},get onToggleNoiseSuppression(){return t.toggleNoiseSuppression},onQualityChange:R}),null),G(g=>ms(y,ye?"display: none !important;":"",g)),l})()]}Le(["click"]);const mr=document.getElementById("root");if(Y&&typeof document<"u"){document.documentElement.classList.add("tg-webapp"),console.log('âœ… Telegram WebApp detected, class "tg-webapp" added to <html>');let t=0;document.addEventListener("touchend",e=>{const n=Date.now();n-t<=300&&e.preventDefault(),t=n},{passive:!1}),document.addEventListener("touchstart",e=>{e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("touchmove",e=>{e.touches&&e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("wheel",e=>{e.ctrlKey&&e.preventDefault()},{passive:!1}),["gesturestart","gesturechange","gestureend"].forEach(e=>{document.addEventListener(e,n=>n.preventDefault())}),document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("selectstart",e=>{const n=(e.target?.tagName||"").toLowerCase();n!=="input"&&n!=="textarea"&&e.preventDefault()}),document.addEventListener("dragstart",e=>e.preventDefault())}else document.documentElement.classList.add("app-shell"),document.addEventListener("contextmenu",t=>t.preventDefault()),document.addEventListener("selectstart",t=>{const e=(t.target?.tagName||"").toLowerCase();e!=="input"&&e!=="textarea"&&t.preventDefault()}),document.addEventListener("dragstart",t=>t.preventDefault());gs(()=>V(gr,{}),mr);
//# sourceMappingURL=index-Wuj2hWnk.js.map
