      * { box-sizing: border-box; }
      :root {
        --m3-primary: #6750A4;
        --m3-primary-variant: #4F378B;
        --m3-on-primary: #FFFFFF;
        --m3-error: #B3261E;
        --m3-surface: #121212;
        --m3-surface-variant: #1E1E1E;
        --m3-outline: #2A2A2A;
      }
      
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; 
        margin: 0; 
        padding: 0; 
        background: #000000;
        min-height: 100vh;
        color: #ffffff;
        overflow: hidden;
        opacity: 0;
        transition: opacity 0.3s ease;
      }
      
      body.loaded {
        opacity: 1;
      }

      /* Ограничения для Telegram WebApp — включаем через класс на <html> */
      .tg-webapp { touch-action: manipulation; -webkit-text-size-adjust: 100%; }
      .tg-webapp * { -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0,0,0,0); }
      .tg-webapp a, .tg-webapp img { -webkit-user-drag: none; }
      .tg-webapp ::selection { background: transparent; }
      /* Разрешаем выделение текста в инпутах и текстовых областях */
      .tg-webapp input, .tg-webapp textarea { -webkit-user-select: text; user-select: text; }

      /* Глобальный режим «как приложение» вне Telegram */
      .app-shell { touch-action: manipulation; -webkit-text-size-adjust: 100%; }
      .app-shell * { -webkit-user-select: none; user-select: none; -webkit-touch-callout: none; -webkit-user-drag: none; -webkit-tap-highlight-color: rgba(0,0,0,0); }
      .app-shell a, .app-shell img { -webkit-user-drag: none; }
      .app-shell ::selection { background: transparent; }
      .app-shell input, .app-shell textarea { -webkit-user-select: text; user-select: text; }
      
      .wrap { 
        width: 100vw; 
        height: 100vh;
        margin: 0; 
        background: #000000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      
      header { display: none !important; }
      
      .logo {
        text-align: center;
        color: #ffffff;
      }
      
      .room-title {
        font-size: 20px;
        font-weight: 600;
        margin: 0;
      }
      
      .participants-count {
        font-size: 14px;
        color: #b0b0b0;
        margin: 4px 0 0 0;
      }
      
      .status-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #2a2a2a;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 500;
        border: 1px solid #3a3a3a;
      }
      
      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #dc2626;
        transition: all 0.3s ease;
      }
      
      .status-dot.connected { background: #16a34a; }
      .status-dot.connecting { background: #d97706; animation: pulse 2s infinite; }
      
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
      
      .main-content {
        display: flex;
        flex: 1;
        overflow: hidden;
        gap: 0;
        padding-bottom: 96px; /* чтобы фиксированная панель снизу не перекрывала клики */
      }
      
      .video-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 0;
        overflow: hidden;
        padding-bottom: 96px;
      }
      
      .participants-section {
        width: 420px; /* ширина как договаривались */
        background: rgba(20,20,20,0.9);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        padding: 12px;
        position: fixed; /* делаем островком */
        top: 24px;
        right: 24px;
        bottom: 24px;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.4);
        backdrop-filter: blur(8px);
      }

      /* Стили для чата */
      .chat-section {
        border-top: none;
        display: flex;
        flex-direction: column;
        height: auto;
        flex: 1; /* на всю высоту колонки */
        background: transparent;
      }

      .chat-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 14px;
        border-bottom: 1px solid #2a2a2a;
        background: rgba(40,40,40,0.9);
        border-radius: 12px;
      }

      .chat-title {
        font-size: 14px;
        font-weight: 600;
        color: #ffffff;
      }

      .chat-toggle {
        background: none;
        border: none;
        color: #8a8a8a;
        cursor: pointer;
        padding: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .chat-toggle:hover {
        background: #3a3a3a;
        color: #ffffff;
      }

      .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 8px 8px 0 8px; /* убрали нижний отступ */
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .chat-message {
        display: flex;
        flex-direction: column;
        gap: 2px;
        padding: 8px 12px;
        border-radius: 8px;
        max-width: 85%;
        word-wrap: break-word;
      }

      .chat-message.own {
        align-self: flex-end;
        background: var(--m3-primary);
        color: var(--m3-on-primary);
      }

      .chat-message.other {
        align-self: flex-start;
        background: #2a2a2a;
        color: #ffffff;
      }

      .chat-message-author {
        font-size: 11px;
        font-weight: 600;
        opacity: 0.8;
        margin-bottom: 2px;
      }

      .chat-message-text {
        font-size: 13px;
        line-height: 1.4;
      }

      .chat-message-time {
        font-size: 10px;
        opacity: 0.6;
        margin-top: 2px;
        align-self: flex-end;
      }

      .chat-input-container {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px;
        border-top: none;
        background: rgba(40,40,40,0.9);
        border-radius: 12px;
        margin-top: 8px; /* ближе к низу */
      }

      .chat-input-container input {
        flex: 1;
        background: #1a1a1a;
        border: 1px solid #3a3a3a;
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 13px;
        transition: all 0.2s ease;
      }

      .chat-input-container input:focus {
        outline: none;
        border-color: #0088cc;
        box-shadow: 0 0 0 2px rgba(0, 136, 204, 0.3);
      }

      .chat-input-container input::placeholder {
        color: #8a8a8a;
      }

      .chat-send-btn {
        background: #0088cc;
        border: none;
        color: white;
        padding: 8px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        min-width: 32px;
        height: 32px;
      }

      .chat-send-btn:hover {
        background: #0066aa;
        transform: scale(1.05);
      }

      .chat-send-btn:disabled {
        background: #4a4a4a;
        cursor: not-allowed;
        transform: none;
      }
      
      .controls { 
        display: flex; 
        gap: 12px; 
        flex-wrap: wrap; 
        margin: 20px 0 24px;
        padding: 20px;
        background: #000000;
        border-radius: 12px;
        border: 1px solid #2a2a2a;
      }
      
      input, select { 
        padding: 12px 16px; 
        border-radius: 8px; 
        border: 1px solid #3a3a3a; 
        background: #2a2a2a; 
        color: #ffffff;
        font-size: 14px;
        transition: all 0.2s ease;
      }
      
      input:focus, select:focus {
        outline: none;
        border-color: var(--m3-primary);
        box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.35);
        background: #323232;
      }
      
      input::placeholder {
        color: #8a8a8a;
      }
      
      button { 
        cursor: pointer;
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
        text-transform: none;
        letter-spacing: 0;
      }
      /* Ensure SVG icons inherit and render with the button color */
      .control-btn svg { display: block; width: 24px; height: 24px; color: inherit; }
      .control-btn svg path, .control-btn svg line, .control-btn svg circle, .control-btn svg rect { fill: currentColor; stroke: currentColor; }
      .control-btn .icon { font-size: 20px; line-height: 1; display: block; }
      
      .btn-primary {
        background: var(--m3-primary);
        color: var(--m3-on-primary);
        border: 1px solid var(--m3-primary-variant);
      }
      
      .btn-primary:hover {
        background: var(--m3-primary-variant);
        transform: translateY(-1px);
      }
      
      .btn-secondary {
        background: #4f545c;
        color: white;
        border: 1px solid #5d6269;
      }
      
      .btn-secondary:hover {
        background: #5d6269;
        transform: translateY(-1px);
      }
      
      .btn-danger {
        background: var(--m3-error);
        color: white;
        border: 1px solid #8C1D18;
      }
      
      .btn-danger:hover {
        background: #8C1D18;
        transform: translateY(-1px);
      }
      
      .btn-success {
        background: #3ba55d;
        color: white;
        border: 1px solid #2d7d46;
      }
      
      .btn-success:hover {
        background: #2d7d46;
        transform: translateY(-1px);
      }
      
      .btn-warning {
        background: #faa61a;
        color: white;
        border: 1px solid #e0951a;
      }
      
      .btn-warning:hover {
        background: #e0951a;
        transform: translateY(-1px);
      }
      
      .videos-grid {
        display: grid;
        gap: 12px;
        flex: 1;
        padding: 16px;
        height: 100%;
        /* Точный расчёт с учётом паддингов и гэпов */
        --pad-x: 32px; /* 16px слева + 16px справа */
        --pad-y: 32px; /* 16px сверху + 16px снизу */
        --gap: 12px;   /* промежуток между колонками/рядами */
        --bottom-ui: calc(120px + env(safe-area-inset-bottom));
        --avail-w: calc(100vw - var(--pad-x) - var(--gap));
        --avail-h: calc(100vh - var(--pad-y) - var(--bottom-ui) - var(--gap));
        --tile-size: min( calc(var(--avail-w) / 2), calc(var(--avail-h) / 2) );
        grid-template-columns: repeat(2, var(--tile-size));
        grid-template-rows: repeat(2, var(--tile-size));
        justify-content: center; /* центрируем по горизонтали */
        align-content: center;   /* центрируем по вертикали */
      }
      
      /* Новый режим: когда только локальная камера — показывать 2x2 */
      .videos-grid.one-video { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
      .videos-grid.two-videos { grid-template-columns: 1fr 1fr; }
      .videos-grid.three-videos { grid-template-columns: 1fr 1fr 1fr; }
      .videos-grid.four-videos { grid-template-columns: 1fr 1fr; grid-template-rows: 1fr 1fr; }
      .videos-grid.five-plus-videos { grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(2, 1fr); }
      
      .video-container {
        position: relative;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid transparent;
        display: flex;
        align-items: center;
        justify-content: center;
        aspect-ratio: 1 / 1;
        transition: border-color 0.3s ease;
      }

      /* --- СЕРЫЙ КВАДРАТ ДЛЯ ЛОКАЛЬНОГО ВИДЕО ДО ПОДКЛЮЧЕНИЯ --- */
.video-container.local-video {
  background: transparent; /* такой же как placeholder */
  border: 2px dashed #2a2a2a; /* чтобы выглядел как остальные квадраты */
  position: relative;
  overflow: hidden;
}
      
      /* Плейсхолдер для пустых ячеек */
      .video-container.placeholder {
        background: transparent;
        border: 2px dashed #2a2a2a;
      }
      .video-container.local-video.placeholder { background: transparent; border: 2px dashed #2a2a2a; }
      .video-container .avatar {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 42px;
        color: #8a8a8a;
        z-index: 2;
        pointer-events: none;
        user-select: none;
      }
      /* Полностью скрываем подпись и индикатор на всех видео */
      .video-label { display: none !important; }
      
      .mic-status {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--m3-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        color: white;
      }
      
      .mic-status.muted {
        background: #dc2626;
      }
      
      video {
        width: 100%;
        height: 100%;
        object-fit: cover; /* центрирование внутри квадрата */
        object-position: center center;
        background: transparent;
        border-radius: 8px;
      }
      
      .video-container:hover video {
        transform: scale(1.01);
      }
      /* Отзеркаливание локальной камеры + сохранение эффекта hover */
      .local-video video { transform: scaleX(-1); }
      .video-container.local-video:hover video { transform: scaleX(-1) scale(1.01); }
      
      .errors {
        background: #2d1b1b;
        border: 1px solid #5c1a1a;
        color: #f85149;
        padding: 12px 16px;
        border-radius: 8px;
        margin: 16px 0;
        font-size: 14px;
        font-weight: 500;
      }
      
      .room-info {
        background: #000000;
        padding: 16px 20px;
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #2a2a2a;
      }
      
      .room-id {
        font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
        background: #2a2a2a;
        padding: 8px 12px;
        border-radius: 6px;
        display: inline-block;
        margin-top: 8px;
        font-weight: 500;
        color: #8a8a8a;
      }
      
      @media (max-width: 768px) {
        body { padding: 0; }
        .wrap { height: 100vh; }
        .main-content { flex-direction: column; }
        .participants-section { 
          width: 100%; 
          height: 200px; 
          border-left: none; 
          border-top: 1px solid #333333; 
          order: 2;
        }
        .video-section { padding: 0; }
        .videos-grid {
          gap: 8px;
          padding: 12px;
          /* На мобильных уменьшаем отступ под системные панели и нижние контролы */
          --pad-x: 24px; /* 12 + 12 */
          --pad-y: 24px; /* 12 + 12 */
          --gap: 8px;
          --bottom-ui: calc(140px + env(safe-area-inset-bottom));
          --avail-w: calc(100vw - var(--pad-x) - var(--gap));
          --avail-h: calc(100vh - var(--pad-y) - var(--bottom-ui) - var(--gap));
          --tile-size: min( calc(var(--avail-w) / 2), calc(var(--avail-h) / 2) );
          grid-template-columns: repeat(2, var(--tile-size)) !important;
          grid-template-rows: repeat(2, var(--tile-size)) !important;
        }
        .video-container { min-height: 160px; }
        header { padding: 16px 20px; }
        .room-title { font-size: 18px; }
        .participants-count { font-size: 13px; }
        /* Прячем чат на мобильных */
        .chat-section { display: none !important; }
        /* Прячем колонку участников на мобильных */
        .participants-section { display: none !important; }
        .call-controls { bottom: 0; left: 0; right: 0; transform: none; gap: 12px; padding: 10px calc(12px + env(safe-area-inset-right)) calc(10px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left)); justify-content: space-around; }
        .control-btn { width: 44px; height: 44px; }
        .control-btn.primary { width: 52px; height: 52px; }
        .control-btn svg { width: 20px; height: 20px; }
        .control-label { font-size: 10px; }
        .call-button-container { 
          bottom: 30px; 
          padding: 0 20px;
        }
        .call-button { 
          padding: 14px 28px; 
          font-size: 15px; 
        }
      }
      
      @media (max-width: 480px) {
        .participants-section { height: 150px; }
        .video-section { padding: 8px; }
        video { min-height: 180px; max-height: 250px; }
        .controls { padding: 8px; margin: 8px 0; }
        header { padding: 8px 12px; }
        .logo { font-size: 16px; }
        .call-controls { bottom: 12px; gap: 16px; padding: 14px 18px; }
        .control-btn { width: 56px; height: 56px; font-size: 22px; }
        .control-btn.primary { width: 80px; height: 80px; }
        .control-btn svg { width: 26px; height: 26px; }
        .participants-header { padding: 12px; }
        .participants-title { font-size: 16px; }
        .participants-count { font-size: 12px; }
      }
      
      .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid #3a3a3a; border-radius: 50%; border-top-color: #5865f2; animation: spin 1s ease-in-out infinite; }
      /* Прелоадер на весь экран */
      .preloader { position: fixed; inset: 0; display: flex; align-items: center; justify-content: center; background: #000; z-index: 3000; flex-direction: column; gap: 16px; }
      .preloader .logo { font-weight: 800; font-size: 24px; color: #ddd; letter-spacing: 0.5px; }
      .preloader .spinner { width: 42px; height: 42px; border: 4px solid #2a2a2a; border-top-color: #6750A4; border-radius: 50%; animation: spin 1s linear infinite; }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      .participants-header { display: none; }
      
      .participants-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 4px;
      }
      
      .participants-count {
        font-size: 12px;
        color: #8a8a8a;
      }
      
      .participants-list { display: none; }
      
      .participant-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 8px 12px;
        border-radius: 6px;
        margin-bottom: 2px;
        transition: background-color 0.2s ease;
      }
      
      .participant-item:hover {
        background: #2a2a2a;
      }
      
      .participant-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--m3-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 12px;
        color: white;
        flex-shrink: 0;
      }
      
      .participant-info {
        flex: 1;
        min-width: 0;
      }
      
      .participant-name {
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      
      .participant-status {
        font-size: 11px;
        color: #8a8a8a;
      }
      
      .participant-mic {
        width: 14px;
        height: 14px;
        color: #0088cc;
        flex-shrink: 0;
      }
      
      .participant-mic.muted {
        color: #dc2626;
      }
      
      .call-controls {
        position: fixed;
        bottom: 24px;
        left: 50%;
        right: auto;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        background: transparent;
        padding: 0;
      }

      .control-group {
        display: flex;
        align-items: center;
        gap: 12px;
        background: #f1ffe3;
        border: 1px solid #e1ffa8;
        padding: 12px 18px;
        border-radius: 45px;
        backdrop-filter: blur(12px);
      }

      .control-btn.round {
  width: 60px;
  height: 60px;
  border-radius: 28px;
  background: #4B2C36;
  color: #fff;;
      }
      .control-btn.round.primary {
  background: #4B2C36;
      }
      .control-btn.round svg { width: 28px; height: 28px; }

      /* Поповер для копирования ссылок */
      .copy-popover {
        position: fixed;
        z-index: 1200;
        background: #d0f9bb;
        color: #345d2f;
        border: 1px solid rgba(0,0,0,0.05);
        box-shadow: 0 6px 16px rgba(0,0,0,0.18);
        border-radius: 28px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 700;
        opacity: 0;
        transform: translateY(6px) scale(0.98);
        transition: opacity .18s ease, transform .18s ease;
        pointer-events: none;
      }
      .copy-popover.show { opacity: 1; transform: translateY(0); }
      .copy-popover .check {
        width: 18px; height: 18px; border-radius: 50%;
        background: #345d2f; display: inline-flex; align-items: center; justify-content: center;
        color: #d0f9bb; font-weight: 900; font-size: 12px;
      }
      .copy-popover .label { font-size: 14px; font-weight: 700; }

      /* Вариант: тост по центру снизу */
      .copy-popover.pill-toast { 
        top: auto; right: auto; 
        left: 50%; bottom: 110px; 
        transform: translateX(-50%) translateY(6px) scale(0.98);
      }
      .copy-popover.pill-toast.show { transform: translateX(-50%) translateY(0) scale(1); }

      .control-btn.text-pill {
  min-width: 150px;
  height: 56px;
  border-radius: 28px;
  background: #4B2C36;
  color: #fff;
  padding: 0 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
      }
      .control-btn.text-pill .icon { font-size: 18px; }

      .hangup-wrap { margin-left: 12px; }
      .hangup-wrap .control-btn.leave {
        width: 64px;
        height: 64px;
        border-radius: 22px;
        background: rgb(240, 29, 54);
        color: #fff;
      }

      /* Submenu above settings */
      .settings-fab-wrap { position: relative; display: flex; align-items: center; }
      .settings-submenu { 
        position: absolute; 
        bottom: 83px; 
        left: 2px; 
        display: flex; 
        flex-direction: column; 
        gap: 8px; 
        opacity: 0; 
        transform: translateY(20px) scale(0.8); 
        pointer-events: none; 
        transition: all 400ms cubic-bezier(0.25, 0.46, 0.45, 0.94);
        filter: blur(8px);
      }
      .settings-submenu.show { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
        pointer-events: auto; 
        filter: blur(0px);
      }
      /* closing state for out animation */
      .settings-submenu.hiding {
        opacity: 0;
        transform: translateY(15px) scale(0.85);
        pointer-events: none;
        filter: blur(4px);
      }
      /* Progressive scale-up animation like in video */
      @keyframes scaleUpIn {
        0% { 
          opacity: 0; 
          transform: translateY(20px) scale(0.3); 
        }
        30% { 
          opacity: 0.7; 
          transform: translateY(10px) scale(0.6); 
        }
        70% { 
          opacity: 1; 
          transform: translateY(-3px) scale(1.05); 
        }
        100% { 
          opacity: 1; 
          transform: translateY(0) scale(1); 
        }
      }
      @keyframes scaleUpOut {
        0% { 
          opacity: 1; 
          transform: translateY(0) scale(1); 
        }
        100% { 
          opacity: 0; 
          transform: translateY(15px) scale(0.3); 
        }
      }
      .settings-pill {
        display: flex;
        align-items: center;
        gap: 12px;
        background: #d0f9bb;
        color: #345d2f;
        border-radius: 28px;
        padding: 14px 20px;
        font-weight: 700;
        border: 1px solid rgba(0,0,0,0.05);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        /* initial hidden state for animation - very small */
        opacity: 0;
        transform: translateY(20px) scale(0.3);
        will-change: transform, opacity;
      }
      .settings-pill .icon { font-size: 22px; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: 24px; }
      /* Progressive appearance like in video - one by one with scale-up */
      .settings-submenu.show .settings-pill { 
        animation: scaleUpIn 350ms cubic-bezier(0.25, 0.46, 0.45, 0.94) both; 
      }
      .settings-submenu.show .settings-pill:nth-child(3) { animation-delay: 0ms; }
      .settings-submenu.show .settings-pill:nth-child(2) { animation-delay: 100ms; }
      .settings-submenu.show .settings-pill:nth-child(1) { animation-delay: 200ms; }
      /* Reverse stagger for exit */
      .settings-submenu.hiding .settings-pill { 
        animation: scaleUpOut 250ms cubic-bezier(0.55, 0.085, 0.68, 0.53) both; 
      }
      .settings-submenu.hiding .settings-pill:nth-child(1) { animation-delay: 0ms; }
      .settings-submenu.hiding .settings-pill:nth-child(2) { animation-delay: 60ms; }
      .settings-submenu.hiding .settings-pill:nth-child(3) { animation-delay: 120ms; }
      
      .room-input {
        display: flex;
        align-items: center;
        gap: 8px;
        flex: 1;
      }
      
      .room-input input {
        background: #1a1a1a;
        border: 1px solid #3a3a3a;
        color: white;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 14px;
        min-width: 120px;
        transition: all 0.2s ease;
      }
      
      .room-input input:focus {
        outline: none;
        border-color: #5865f2;
        box-shadow: 0 0 0 2px rgba(88, 101, 242, 0.3);
      }
      
      .room-input input::placeholder {
        color: #8a8a8a;
      }
      
      .settings-dropdown {
        position: relative;
        display: none;
      }
      
      .settings-dropdown.show {
        display: block;
      }
      
      .settings-content {
        position: absolute;
        bottom: 60px;
        left: 50%;
        transform: translateX(-50%);
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        padding: 16px;
        min-width: 200px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        z-index: 1000;
      }
      
      .settings-content select {
        width: 100%;
        margin-bottom: 8px;
        background: #2a2a2a;
        border: 1px solid #3a3a3a;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 12px;
      }
      
      .settings-content select:last-child {
        margin-bottom: 0;
      }
      
      .control-btn {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: all 0.2s ease;
        position: relative;
      }
      /* Убираем светлые фокусы/outline и подсветку на мобильных */
      .control-btn, .settings-pill, .call-button, .chat-send-btn, .chat-toggle, .control-btn:focus, .settings-pill:focus, .call-button:focus, .chat-send-btn:focus, .chat-toggle:focus {
        outline: none !important;
        box-shadow: none !important;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
      }
      button:focus-visible { outline: none; box-shadow: none; }
      .control-btn.primary { width: 56px; height: 56px; }
      .control-label { 
        text-align: center; 
        font-size: 11px; 
        color: #b0b0b0; 
        margin-top: 4px; 
        font-weight: 500;
      }
      .primary-wrap { 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        gap: 4px;
      }
      .mic-pulse { box-shadow: 0 0 0 0 rgba(88,101,242,0.6); animation: pulseRing 2s infinite; }
      @keyframes pulseRing { 0% { box-shadow: 0 0 0 0 rgba(88,101,242,0.6);} 70% { box-shadow: 0 0 0 16px rgba(88,101,242,0);} 100% { box-shadow: 0 0 0 0 rgba(88,101,242,0);} }
      
      .control-btn.video {
        background: #ed4245a9;
        color: white;
      }
      
      .control-btn.video.enabled {
        background: transparent;
        color: white;
      }
      
      .control-btn.mic {
        background: #ed4245;
        color: white;
      }
      
      .control-btn.mic.enabled {
        background: #3c6426b5;
        color: white;
      }
      
      .control-btn.join {
        background: transparent;
        color: white;
        width: 36px;
        height: 36px;
      }
      
      .control-btn.join:hover {
        background: var(--m3-primary-variant);
      }
      
      .control-btn.settings {
        background: transparent;
        color: white;
      }
      
      .control-btn.screen-share {
        background: transparent;
        color: white;
      }
      
      .control-btn.screen-share.active {
        background: #ed4245;
        color: white;
      }
      
      .control-btn.video {
        background: #ed4245a9;
        color: white;
      }
      
      .control-btn.video.enabled {
        background: transparent;
        color: white;
      }
      
      .control-btn.mic {
        background: #ed4245;
        color: white;
      }
      
      .control-btn.mic.enabled {
        background: #3c6426b5;
        color: white;
      }
      
      .settings-pill.active {
        background: #ffd700;
        color: #000;
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
      }
      
      /* Подсветка только внутри секции видео */
      .video-section.flashlight-on {
        background: #ffffff !important;
      }
      .video-section.flashlight-on * {
        background: #ffffff !important;
      }

      /* Дополнительно красим фон страницы под фиксированными контролами */
      body.flashlight-bg, .wrap.flashlight-bg { background: #ffffff !important; }
      /* Сохраняем правую колонку тёмной */
      .wrap.flashlight-bg .participants-section { background: #00000056 !important; }
      
      .control-btn.leave {
        background: #ed4245;
        color: white;
      }
      
      .control-btn.copy-link {
        background: transparent;
        color: white;
      }
      
      .control-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }
      
      .call-button-container {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
      }
      
      .call-button {
        background: #515c30;
        color: var(--m3-on-primary);
        border: none;
        border-radius: 50px;
        padding: 16px 32px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 0 4px 20px rgba(103, 80, 164, 0.4);
        transition: all 0.2s ease;
      }
      
      .call-button:hover {
        background: #616f34;
        transform: translateY(-2px);
        box-shadow: 0 6px 25px rgba(103, 80, 164, 0.5);
      }
      
      .call-button svg {
        width: 24px;
        height: 24px;
      }
      .call-button img {
        display: block;
        width: 24px;
        height: 24px;
      }

      /* Модальное окно для ввода имени */
      .name-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none; /* скрыто по умолчанию */
        align-items: center;
        justify-content: center;
        z-index: 2000;
        backdrop-filter: blur(4px);
      }

      .name-modal-content {
        background: #1a1a1a;
        border: 1px solid #2a2a2a;
        border-radius: 16px;
        padding: 32px;
        max-width: 400px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(20px);
      }

      .name-modal-content h3 {
        margin: 0 0 8px 0;
        font-size: 24px;
        font-weight: 600;
        color: #ffffff;
      }

      .name-modal-content p {
        margin: 0 0 24px 0;
        color: #8a8a8a;
        font-size: 14px;
      }

      .name-modal-content input {
        width: 100%;
        padding: 16px 20px;
        border: 2px solid #3a3a3a;
        border-radius: 12px;
        background: #2a2a2a;
        color: #ffffff;
        font-size: 16px;
        margin-bottom: 24px;
        transition: all 0.2s ease;
        text-align: center;
      }

      .name-modal-content input:focus {
        outline: none;
        border-color: #0088cc;
        box-shadow: 0 0 0 4px rgba(0, 136, 204, 0.3);
        background: #323232;
      }

      .name-modal-content input::placeholder {
        color: #8a8a8a;
      }

      .name-modal-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .name-modal-buttons button {
        padding: 14px 28px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 12px;
        min-width: 120px;
      }

      @media (max-width: 480px) {
        .name-modal-content {
          padding: 24px;
          margin: 20px;
        }
        
        .name-modal-content h3 {
          font-size: 20px;
        }
        
        .name-modal-content input {
          padding: 14px 16px;
          font-size: 14px;
        }
        
        .name-modal-buttons button {
          padding: 12px 20px;
          font-size: 14px;
        }
      }

      /* Connection Type Selector - Adaptive Design */
      .connection-type-selector-compact {
        position: fixed;
        background: rgba(26, 26, 26, 0.95);
        border: 1px solid #2a2a2a;
        border-radius: 16px;
        backdrop-filter: blur(12px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
        z-index: 100;
        /* Desktop: по центру над кнопкой */
        bottom: 140px;
        left: 50%;
        transform: translateX(-50%);
        padding: 20px 24px;
        min-width: 400px;
      }

      /* Telegram WebApp: прижимаем селектор типа подключения */
      .tg-webapp .connection-type-selector-compact {
        top: 60px;
        right: 12px;
        bottom: auto;
        left: auto;
        transform: none;
        padding: 10px 12px;
        min-width: 180px;
        border-radius: 12px;
      }

      .connection-compact-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-bottom: 8px;
      }

      .connection-compact-label {
        font-size: 16px;
        font-weight: 600;
        color: #ffffff;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .connection-toggle-wrap {
        display: flex;
        align-items: center;
      }

      .connection-toggle {
        position: relative;
        width: 64px;
        height: 32px;
        background: #2a2a2a;
        border: 2px solid #3a3a3a;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s ease;
        padding: 0;
        outline: none;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
      }

      .connection-toggle:hover:not(.locked) {
        border-color: #515c30;
        box-shadow: 0 0 12px rgba(81, 92, 48, 0.3);
      }

      .connection-toggle.locked {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .toggle-slider {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 24px;
        height: 24px;
        background: #515c30;
        border-radius: 12px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      }

      .toggle-slider.direct {
        left: calc(100% - 26px);
        background: #616f34;
      }

      .toggle-icon {
        font-size: 14px;
        line-height: 1;
      }

      .connection-compact-hint {
        font-size: 13px;
        color: #8a8a8a;
        text-align: center;
        line-height: 1.3;
        padding: 8px 0 0 0;
      }

      /* Mobile: компактно в правом верхнем углу */
      /* E2EE Indicator */
      .e2ee-indicator {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(26, 26, 26, 0.95);
        border: 1px solid #16a34a;
        border-radius: 12px;
        padding: 8px 14px;
        display: flex;
        align-items: center;
        gap: 6px;
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 16px rgba(22, 163, 74, 0.2);
        z-index: 101;
        font-size: 13px;
        font-weight: 600;
        color: #16a34a;
        transition: all 0.3s ease;
      }

      /* Telegram WebApp: прижимаем к верху с учетом системной шапки */
      .tg-webapp .e2ee-indicator {
        top: 60px;
      }

      /* Connection Quality Indicator */
      .connection-quality-indicator {
        position: fixed;
        top: 60px; /* Смещаем вниз чтобы не перекрывать E2EE индикатор */
        left: 20px;
        background: rgba(26, 26, 26, 0.95);
        border: 1px solid #2a2a2a;
        border-radius: 12px;
        padding: 12px 16px;
        display: flex;
        align-items: center;
        gap: 12px;
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        z-index: 100;
        transition: all 0.3s ease;
      }

      /* Telegram WebApp: прижимаем индикатор качества */
      .tg-webapp .connection-quality-indicator {
        top: 100px;
      }

      .quality-icon {
        font-size: 20px;
        line-height: 1;
      }

      .quality-details {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .quality-text {
        font-size: 14px;
        font-weight: 600;
      }

      .quality-stats {
        font-size: 11px;
        color: #8a8a8a;
      }

      .quality-stats .ping {
        font-weight: 600;
      }

      .quality-stats .packet-loss {
        color: #dc2626;
      }

      /* Video Quality Settings */
      .video-quality-wrap {
        display: contents; /* Делаем обертку прозрачной для flex */
      }

      /* Варианты качества - темнее основных кнопок */
      .quality-option {
        background: #a8c98a !important; /* Темнее чем основной #d0f9bb */
        color: #2a3d1f !important;
      }

      .quality-option:hover {
        background: #96b878 !important;
      }

      .quality-option.active {
        background: #7a9960 !important;
        box-shadow: 0 0 16px rgba(122, 153, 96, 0.5) !important;
      }

      /* Кнопка "Назад" */
      .back-button {
        background: #c5e8a8 !important;
        color: #2a3d1f !important;
        border: 1px solid rgba(0,0,0,0.1) !important;
      }

      .back-button:hover {
        background: #b3d696 !important;
      }

      .back-button .icon {
        font-size: 18px;
        font-weight: bold;
      }

      /* Picture-in-Picture Button */
      .pip-button {
        position: absolute;
        top: 8px;
        right: 8px;
        background: rgba(26, 26, 26, 0.8);
        border: 1px solid #3a3a3a;
        border-radius: 8px;
        padding: 6px 10px;
        font-size: 16px;
        cursor: pointer;
        opacity: 0;
        transition: all 0.2s ease;
        z-index: 10;
        backdrop-filter: blur(8px);
      }

      .video-container.local-video:hover .pip-button {
        opacity: 1;
      }

      .pip-button:hover {
        background: rgba(81, 92, 48, 0.9);
        border-color: #515c30;
        transform: scale(1.05);
      }

      /* Settings Pill Group для вложенных элементов */
      .settings-pill-group {
        background: transparent;
        border: none;
        padding: 0;
        display: block;
      }

      @media (max-width: 768px) {
        .e2ee-indicator {
          top: 12px;
          left: 12px;
          padding: 6px 10px;
          font-size: 11px;
        }

        /* Telegram WebApp на мобильных: прижимаем к верху */
        .tg-webapp .e2ee-indicator {
          top: 60px;
        }

        .connection-quality-indicator {
          top: 50px; /* Смещаем вниз на мобильных */
          left: 12px;
          padding: 8px 12px;
          gap: 8px;
        }

        /* Telegram WebApp на мобильных: прижимаем индикатор качества */
        .tg-webapp .connection-quality-indicator {
          top: 100px;
        }

        .quality-icon {
          font-size: 16px;
        }

        .quality-text {
          font-size: 12px;
        }

        .quality-stats {
          font-size: 10px;
        }

        .pip-button {
          top: 6px;
          right: 6px;
          padding: 4px 8px;
          font-size: 14px;
        }

        .connection-type-selector-compact {
          /* Мобильная версия: правый верхний угол */
          top: 12px;
          right: 12px;
          bottom: auto;
          left: auto;
          transform: none;
          padding: 10px 12px;
          min-width: 180px;
          border-radius: 12px;
        }

        /* Telegram WebApp на мобильных: прижимаем селектор типа подключения */
        .tg-webapp .connection-type-selector-compact {
          top: 60px;
        }

        .connection-compact-row {
          justify-content: space-between;
          gap: 12px;
          margin-bottom: 6px;
        }

        .connection-compact-label {
          font-size: 13px;
          gap: 6px;
        }

        .connection-toggle {
          width: 50px;
          height: 26px;
          border-radius: 13px;
        }

        .toggle-slider {
          width: 18px;
          height: 18px;
          border-radius: 9px;
        }

        .toggle-slider.direct {
          left: calc(100% - 20px);
        }

        .toggle-icon {
          font-size: 11px;
        }

        .connection-compact-hint {
          font-size: 10px;
          padding: 4px 0 0 0;
        }
      }
